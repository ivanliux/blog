<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Android WebViewå¿…çŸ¥å¿…ä¼š(3)-WebChromeClient</title>
      <link href="/post/webview-learning-WebChromeClient/"/>
      <url>/post/webview-learning-WebChromeClient/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ğŸ˜€WebChromeClientï¼šå½“å½±å“â€æµè§ˆå™¨â€çš„äº‹ä»¶åˆ°æ¥æ—¶ï¼Œå°±ä¼šé€šè¿‡WebChromeClientä¸­çš„æ–¹æ³•å›è°ƒé€šçŸ¥ç”¨æ³•,æ‰€ä»¥WebChromeClientéƒ½æ˜¯å’Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨æµè§ˆå™¨éœ€è¦çš„ä¸€äº›äº¤äº’æœ‰å¯†åˆ‡çš„è”ç³»ã€‚</p><a id="more"></a><h2 id="1ã€è·å–ç½‘é¡µçš„åŠ è½½è¿›åº¦"><a href="#1ã€è·å–ç½‘é¡µçš„åŠ è½½è¿›åº¦" class="headerlink" title="1ã€è·å–ç½‘é¡µçš„åŠ è½½è¿›åº¦"></a>1ã€è·å–ç½‘é¡µçš„åŠ è½½è¿›åº¦</h2><ul><li><p>void  onProgressChanged(WebView view, int newProgress)  ï¼›</p><p>Tell the host application the current progress of loading a page. </p><p>newProgress: Current page loading progress, represented by an integer between 0 and 100.</p><p>å¤§å®¶ä¸€å®šè¦æ³¨æ„ï¼Œåº•å±‚å®ç°æ—¶ï¼Œæ˜¯åˆ©ç”¨handleræ¥å®šæ—¶è½®å¾ªå½“å‰è¿›åº¦çš„ï¼Œæ¯éš”ä¸€å®šæ—¶é—´æŸ¥è¯¢ä¸€æ¬¡ï¼Œæ‰€ä»¥æ¯æ¬¡æ‹¿åˆ°çš„è¿›åº¦æ•°æ®æ˜¯ä¸ä¸€æ ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœé¡µé¢è¾ƒç®€å•ï¼Œå¯èƒ½ä¼šç›´æ¥è¿”å›100ï¼Œè€Œè·³è¿‡ä¸­é—´çš„å„ä¸ªæ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™¤äº†100ï¼Œå…¶å®ƒä»»ä½•ä¸€ä¸ªæ•°å€¼ä¸æ˜¯ä¸€å®šè¿”å›çš„ã€‚æ‰€ä»¥å¤§å®¶å¦‚æœè¦ç”¨åˆ°è¿›åº¦ï¼Œé™¤äº†æ•°å€¼100å¯ä»¥ç”¨ç­‰å·æ¥åˆ¤æ–­ï¼Œå…¶å®ƒä¸€å®šè¦ç”¨å¤§äºå·æˆ–å°äºå·ï¼Œå¦‚æœç”¨äº†ç­‰å·ï¼Œå¯èƒ½æ°¸è¿œä¹Ÿä¸ä¼šæ‰§è¡Œåˆ°ã€‚</p></li></ul><h2 id="2ã€è·å–ç½‘é¡µä¸­çš„åŸºæœ¬ä¿¡æ¯"><a href="#2ã€è·å–ç½‘é¡µä¸­çš„åŸºæœ¬ä¿¡æ¯" class="headerlink" title="2ã€è·å–ç½‘é¡µä¸­çš„åŸºæœ¬ä¿¡æ¯"></a>2ã€è·å–ç½‘é¡µä¸­çš„åŸºæœ¬ä¿¡æ¯</h2><ul><li><p>void  onReceivedIcon(WebView view, Bitmap icon) </p><p>icon A Bitmap containing the favicon for the current page.ç½‘é¡µä¸­é¦–éƒ¨å›¾æ ‡</p></li><li><p>void  onReceivedTitle(WebView view, String title) </p><p>title: A String containing the new title of the document. ç½‘é¡µä¸­æ ‡é¢˜ä¸­çš„æ›´æ”¹ï¼Œé¦–éƒ¨æ ‡é¢˜</p><p>è·å–æ ‡é¢˜çš„æ—¶é—´ä¸»è¦å–å†³äºç½‘é¡µå‰ç«¯è®¾ç½®æ ‡é¢˜çš„ä½ç½®ï¼ŒJSä¸­çš„å‡½æ•°è®¾ç½®ä¹Ÿåœ¨è¿™é‡Œæ¥æ”¶</p></li><li><p>void  onReceivedTouchIconUrl(WebView view, String url, boolean precomposed)  Notify the host application of the url for an apple-touch-icon(è‹¹æœå›¾æ ‡). </p></li><li><p>è‹¹æœä¸ºiOSè®¾å¤‡é…å¤‡äº†apple-touch-iconç§æœ‰å±æ€§ï¼Œæ·»åŠ è¯¥å±æ€§ï¼Œåœ¨iPhone,iPad,iTouchçš„safariæµè§ˆå™¨ä¸Šå¯ä»¥ä½¿ç”¨æ·»åŠ åˆ°ä¸»å±æŒ‰é’®å°†ç½‘ç«™æ·»åŠ åˆ°ä¸»å±å¹•ä¸Šï¼Œæ–¹ä¾¿ç”¨æˆ·ä»¥åè®¿é—®ã€‚apple-touch-icon æ ‡ç­¾æ”¯æŒsizeså±æ€§ï¼Œå¯ä»¥ç”¨æ¥æ”¾ç½®å¯¹åº”ä¸åŒçš„è®¾å¤‡ã€‚</p><p>url: The icon url.å›¾ç‰‡åœ°å€</p><p>precomposed: True if the url is for a precomposed touch icon. æ ‡è®°ä¸ºTrueçš„è¯ä½¿ç”¨åŸå›¾</p></li></ul><h2 id="3ã€æ‹¦æˆªç½‘é¡µä¸­JSæ§åˆ¶å°æ¶ˆæ¯"><a href="#3ã€æ‹¦æˆªç½‘é¡µä¸­JSæ§åˆ¶å°æ¶ˆæ¯" class="headerlink" title="3ã€æ‹¦æˆªç½‘é¡µä¸­JSæ§åˆ¶å°æ¶ˆæ¯"></a>3ã€æ‹¦æˆªç½‘é¡µä¸­JSæ§åˆ¶å°æ¶ˆæ¯</h2><p>å½“htmlä¸­è°ƒç”¨consoleç›¸å…³è¾“å‡ºçš„æ—¶å€™ï¼Œå°±ä¼šé€šè¿‡onConsoleMessageè¿›è¡Œé€šçŸ¥</p><p>å’Œalert,prompt,confirmä¸åŒï¼Œæˆ‘ä»¬ä¸éœ€è¦å¼ºåˆ¶è®¾ç½®WebChromeClientï¼ˆä½†æ˜¯ä»éœ€è¦setJavaScriptEnabledä¸ºtrueï¼‰ï¼Œå½“ç‚¹å‡»logæŒ‰é’®æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨consoleç›¸åº”çš„å‡½æ•°æŠŠæ—¥å¿—æ‰“å°å‡ºæ¥ã€‚</p><p>å¯ä»¥è·å–åˆ°çš„ä¿¡æ¯æœ‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onConsoleMessage</span><span class="params">(ConsoleMessage consoleMessage)</span> </span>&#123;</div><div class="line">Log.e(<span class="string">"ncmon"</span>, <span class="string">"onConsoleMessage : "</span></div><div class="line">          + <span class="string">"\nmessage="</span> + consoleMessage.message()</div><div class="line">          + <span class="string">"\nlineNumber="</span> + consoleMessage.lineNumber()</div><div class="line">          + <span class="string">"\nmessageLevel="</span> + consoleMessage.messageLevel()</div><div class="line">          + <span class="string">"\nsourceId="</span> + consoleMessage.sourceId());</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onConsoleMessage(consoleMessage);</div><div class="line">&#125;</div><div class="line">ncmon : onConsoleMessage : </div><div class="line">    message=Uncaught TypeError: Cannot read property <span class="string">'getItem'</span> of <span class="keyword">null</span></div><div class="line">    lineNumber=<span class="number">2</span></div><div class="line">    messageLevel=ERROR</div><div class="line">    sourceId=https:<span class="comment">//m.baidu.com/?from=844b&amp;vit=fps</span></div><div class="line">chromium: [INFO:CONSOLE(<span class="number">2</span>)] <span class="string">"Uncaught TypeError: Cannot read property 'getItem' of null"</span>, source: https:<span class="comment">//m.baidu.com/?from=844b&amp;vit=fps (2)</span></div></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é™¤äº†æ¥¼ä¸»è¾“å‡ºçš„æ—¥å¿—å¤–ï¼Œè¿˜æœ‰chromiumçš„æ—¥å¿—ï¼Œè¿™é‡Œä¹Ÿå°±è¦ä½“ç°è¿”å›å€¼çš„ä½œç”¨ï¼Œå¦‚æœè¿”å›trueæ—¶ï¼Œå°±è¡¨ç¤ºæ‹¦æˆªäº†consoleè¾“å‡ºï¼Œç³»ç»Ÿå°±ä¸å†é€šè¿‡consoleè¾“å‡ºå‡ºæ¥äº†ï¼›å¦‚æœè¿”å›false(é»˜è®¤å€¼)ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰æ‹¦æˆªconsoleè¾“å‡ºï¼Œè°ƒç”¨ç³»ç»Ÿé»˜è®¤å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsoleMessage</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> MessageLevel mLevel;</div><div class="line">    <span class="keyword">private</span> String mMessage;</div><div class="line">    <span class="keyword">private</span> String mSourceId;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mLineNumber;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="4ã€æ‹¦æˆªç½‘é¡µä¸­JSå¼¹æ¡†"><a href="#4ã€æ‹¦æˆªç½‘é¡µä¸­JSå¼¹æ¡†" class="headerlink" title="4ã€æ‹¦æˆªç½‘é¡µä¸­JSå¼¹æ¡†"></a>4ã€æ‹¦æˆªç½‘é¡µä¸­JSå¼¹æ¡†</h2><p>ä¸‰ç§ç±»å‹çš„å¼¹æ¡†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsAlert</span><span class="params">(WebView view, String url, String message,</span></span></div><div class="line">        JsResult result) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å½“ç½‘é¡µè°ƒç”¨alert()æ¥å¼¹å‡ºalertå¼¹å‡ºæ¡†å‰å›è°ƒï¼Œç”¨ä»¥æ‹¦æˆªalert()å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsConfirm</span><span class="params">(WebView view, String url, String message,</span></span></div><div class="line">        JsResult result) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¸¦æœ‰ç¡®å®šå–æ¶ˆæç¤ºï¼Œå½“ç½‘é¡µè°ƒç”¨confirm()æ¥å¼¹å‡ºconfirmå¼¹å‡ºæ¡†å‰å›è°ƒï¼Œç”¨ä»¥æ‹¦æˆªconfirm()å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsPrompt</span><span class="params">(WebView view, String url, String message,</span></span></div><div class="line">        String defaultValue, JsPromptResult result) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¸¦æœ‰è¾“å…¥æ¡†çš„å¼¹çª—ï¼Œå½“ç½‘é¡µè°ƒç”¨prompt()æ¥å¼¹å‡ºpromptå¼¹å‡ºæ¡†å‰å›è°ƒï¼Œç”¨ä»¥æ‹¦æˆªprompt()å‡½æ•°</p><ul><li><p>å¤„ç†JSå¼¹æ¡†é¦–å…ˆéœ€è¦è®¾ç½®JavaScriptæ”¯æŒï¼Œä¹Ÿå¿…é¡»è®¾ç½®WebChromeClient.</p></li><li><p>å‚æ•°</p><p>url:page_with_curl:ï¼šå¼¹å‡ºå¯¹è¯æ¡†çš„ç½‘é¡µç½‘å€</p><p>message:speech_balloon::å¯¹è¯æ¡†çš„å†…å®¹</p><p>result:closed_umbrella:: è¿”å›ç»™JavaScriptçš„å“åº”ï¼ŒJsResult.confirm()è¡¨ç¤ºç‚¹å‡»äº†å¼¹å‡ºæ¡†çš„ç¡®å®šæŒ‰é’®ï¼ŒJsResult.cancel()åˆ™è¡¨ç¤ºç‚¹å‡»äº†å¼¹å‡ºæ¡†çš„å–æ¶ˆæŒ‰é’®ã€‚<font color="red">å…¶ä¸­JsPromptResultä¹Ÿæ˜¯ç»§æ‰¿JsResultçš„ï¼Œåªæ˜¯å¤šäº†è¾“å…¥çš„å†…å®¹å˜é‡ (String mStringResult)</font></p></li><li><p>è¿”å›å€¼ </p><p>true Native è‡ªè¡Œå¤„ç†å¼¹çª—é€»è¾‘ï¼Œä¸å¼¹å‡ºalertå¼¹çª—äº†</p><p>false WebView è‡ªè¡Œå¼¹å‡ºalertå¯¹è¯æ¡†å¤„ç†</p><p>å¦‚æœæ˜¯return trueï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨è°ƒç”¨JsResultçš„.confirm()æˆ–.cancel()æ–¹æ³•ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰è°ƒç”¨JsResultçš„confirm()æˆ–cancel()æ¥å‘Šè¯‰WebViewä½ çš„å¤„ç†ç»“æœï¼Œåˆ™WebViewå°±ä¼šè®¤ä¸ºè¿™ä¸ªå¼¹å‡ºæ¡†è¿˜ä¸€ç›´å¼¹åœ¨é‚£é‡Œï¼ˆè™½ç„¶æ­¤æ—¶æ ¹æœ¬æ²¡æœ‰å¼¹æ¡†å¼¹å‡ºï¼‰ï¼Œæ‰€ä»¥ä¹‹åä½ å†ç‚¹å‡»alertæŒ‰é’®æ—¶ï¼Œå°†ä¼šæ— æ•ˆã€‚è¿™ä¸€ç‚¹ä¸€å®šè¦æ³¨æ„ã€‚</p></li></ul><h2 id="5ã€æ‰“å¼€å’Œå…³é—­Window"><a href="#5ã€æ‰“å¼€å’Œå…³é—­Window" class="headerlink" title="5ã€æ‰“å¼€å’Œå…³é—­Window"></a>5ã€æ‰“å¼€å’Œå…³é—­Window</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateWindow</span><span class="params">(WebView view, <span class="keyword">boolean</span> isDialog,</span></span></div><div class="line">        <span class="keyword">boolean</span> isUserGesture, Message resultMsg) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•å›è°ƒçš„å‰æéœ€è¦è®¾ç½®WebViewå¤šçª—å£æ”¯æŒï¼Œå°±æ˜¯æµè§ˆå™¨çš„å¤šä¸ªtab</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webSettings.setSupportMultipleWindows(<span class="keyword">true</span>);<span class="comment">//æ”¯æŒå¤šçª—å£ã€‚å¦‚æœè®¾ç½®ä¸ºtrue</span></div></pre></td></tr></table></figure><p>åœ¨Htmlä¸­ï¼Œè¶…çº§é“¾æ¥æ ‡ç­¾aé‡Œæœ‰ä¸€ä¸ªtargetå±æ€§ï¼Œå…¶æ„ä¹‰æ˜¯å†³å®šâ€æ˜¯å¦åœ¨æ–°çª—å£/æ ‡ç­¾é¡µä¸­æ‰“å¼€é“¾æ¥â€ï¼Œå¦‚æœä¸å†™target=â€_blankâ€é‚£ä¹ˆå°±æ˜¯åœ¨ç›¸åŒçš„æ ‡ç­¾é¡µæ‰“å¼€ï¼Œå¦‚æœå†™äº†ï¼Œå°±æ˜¯åœ¨æ–°çš„ç©ºç™½æ ‡ç­¾é¡µä¸­æ‰“å¼€ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://www.taobao.com/"</span> <span class="attr">title</span>=<span class="string">"æ·˜å®"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>æ–°çª—å£æ‰“å¼€é“¾æ¥<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div></pre></td></tr></table></figure><p>WebViewé»˜è®¤æ˜¯ä¸æ”¯æŒtargetï¼Œç‚¹å‡»ä¸Šé¢çš„é“¾æ¥ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ã€‚</p><p>å®Œæ•´é€»è¾‘å¦‚ä¸‹</p><ul><li><p>æ²¡æœ‰è®¾ç½®setSupportMultipleWindowså±æ€§ä¸ºtrue</p><ul><li>æ²¡æœ‰setWebChromeClientï¼šç‚¹å‡»æ­¤é“¾æ¥ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥</li><li>æœ‰setWebChromeClientï¼šç‚¹å‡»æ­¤é“¾æ¥ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ï¼Œä¸ä¼šå›è°ƒonCreateWindowæ–¹æ³•</li></ul></li><li><p>æœ‰è®¾ç½®setSupportMultipleWindowså±æ€§ä¸ºtrue</p><ul><li><p>æ²¡æœ‰setWebChromeClientï¼šç‚¹å‡»æ­¤é“¾æ¥ä¸ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥</p></li><li><p>æœ‰setWebChromeClient</p><ul><li>æ²¡æœ‰é‡å†™onCreateWindowæ–¹æ³•ï¼šç‚¹å‡»æ­¤é“¾æ¥ä¸ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ï¼Œä¼šå›è°ƒonCreateWindowæ–¹æ³•</li><li>æœ‰é‡å†™onCreateWindowæ–¹æ³•ï¼šç‚¹å‡»æ­¤é“¾æ¥ä¸ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ï¼Œä¼šå›è°ƒonCreateWindowæ–¹æ³•ï¼Œä¼šåœ¨ä½ æ–°åˆ›å»ºçš„WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥</li></ul></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateWindow</span><span class="params">(WebView webView, <span class="keyword">boolean</span> isDialog, <span class="keyword">boolean</span> isUserGesture, Message resultMsg)</span> </span>&#123;</div><div class="line">    Log.i(<span class="string">"bqt"</span>, <span class="string">"ã€onCreateWindowã€‘ "</span> + isDialog + <span class="string">"  "</span> + isUserGesture + <span class="string">"\nè¯¦ç»†ä¿¡æ¯"</span> + resultMsg.toString());</div><div class="line">    <span class="keyword">if</span> (activity != <span class="keyword">null</span>) &#123;</div><div class="line">        WebView childView = <span class="keyword">new</span> WebView(activity);<span class="comment">//Parent WebView cannot host it's own popup window.</span></div><div class="line">        childView.setBackgroundColor(Color.GREEN);</div><div class="line">        childView.setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">                Log.i(<span class="string">"bqt"</span>, <span class="string">"ã€shouldOverrideUrlLoading-å­ã€‘"</span>);</div><div class="line">                activity.startActivity(<span class="keyword">new</span> Intent(Intent.ACTION_VIEW, Uri.parse(url)));</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        WebView.WebViewTransport transport = (WebView.WebViewTransport) resultMsg.obj;</div><div class="line">        transport.setWebView(childView);<span class="comment">//setWebViewå’ŒgetWebViewä¸¤ä¸ªæ–¹æ³•</span></div><div class="line">        resultMsg.sendToTarget();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">super</span>.onCreateWindow(webView, isDialog, isUserGesture, resultMsg);<span class="comment">//é»˜è®¤æ˜¯returns false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ„Ÿè§‰æµè§ˆå™¨æ‰ä¼šç”¨åˆ°è¿™ä¸ªAPI,å¸¸è§„åº”ç”¨åŸºæœ¬éƒ½æ˜¯æ‰“å¼€è‡ªå·±å®šåˆ¶çš„Htmlé¡µé¢</p><p>å¯¹åº”çš„è¿˜æœ‰ä¸€ä¸ªå…³é—­Windowçš„APIï¼Œåœ¨JSè°ƒç”¨window.close()æ–¹æ³•æ—¶ä¼šå›è°ƒæ­¤æ–¹æ³•ã€<button onclick="window.close()">å…³é—­çª—å£</button>ã€‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCloseWindow</span><span class="params">(WebView window)</span> </span>&#123;&#125;</div></pre></td></tr></table></figure><h2 id="6ã€æ–‡ä»¶é€‰æ‹©å™¨"><a href="#6ã€æ–‡ä»¶é€‰æ‹©å™¨" class="headerlink" title="6ã€æ–‡ä»¶é€‰æ‹©å™¨"></a>6ã€æ–‡ä»¶é€‰æ‹©å™¨</h2><p>è¿™ä¸ªæ–¹æ³•åœ¨é¡¹ç›®ä¸­å¾ˆå¸¸ç”¨ï¼ŒHtmlä¸­å¦‚æœéœ€è¦é€‰æ‹©æœ¬æœºæ–‡ä»¶å°±éœ€è¦æŠŠæ–‡ä»¶ä¼ è¿‡å»ã€‚åŸºæœ¬æ“ä½œä¸ºæ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨å†æŠŠé€‰æ‹©çš„æ–‡ä»¶ä¼ åˆ°ç½‘é¡µä¸­ã€‚æˆ‘ä¹Ÿæœ‰ç”¨åˆ°ï¼Œå°±è´´ä¸€ä¸‹å®Œæ•´çš„ä»£ç ç‰‡æ®µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//For Android  &gt;= 4.1</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openFileChooser</span><span class="params">(ValueCallback&lt;Uri&gt; valueCallback, String acceptType, String capture)</span> </span>&#123;</div><div class="line">    uploadMessage = valueCallback;</div><div class="line">    openImageChooserActivity();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// For Android &gt;= 5.0</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onShowFileChooser</span><span class="params">(WebView webView, ValueCallback&lt;Uri[]&gt; filePathCallback, WebChromeClient.FileChooserParams fileChooserParams)</span> </span>&#123;</div><div class="line">    uploadMessageAboveL = filePathCallback;</div><div class="line">    Intent i = <span class="keyword">new</span> Intent(Intent.ACTION_GET_CONTENT);</div><div class="line">    i.addCategory(Intent.CATEGORY_OPENABLE);</div><div class="line">    <span class="keyword">if</span> (fileChooserParams != <span class="keyword">null</span> &amp;&amp; fileChooserParams.getAcceptTypes() != <span class="keyword">null</span></div><div class="line">                &amp;&amp; fileChooserParams.getAcceptTypes().length &gt; <span class="number">0</span>) &#123;</div><div class="line">i.setType(fileChooserParams.getAcceptTypes()[<span class="number">0</span>]);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">i.setType(<span class="string">"*/*"</span>);</div><div class="line">    &#125;</div><div class="line">    startActivityForResult(Intent.createChooser(i, <span class="string">"File Chooser"</span>), FILECHOOSER_RESULTCODE);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"> <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</div><div class="line">        <span class="keyword">if</span> (requestCode == FILE_CHOOSER_RESULT_CODE) &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == uploadMessage &amp;&amp; <span class="keyword">null</span> == uploadMessageAboveL) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            Uri result = data == <span class="keyword">null</span> || resultCode != RESULT_OK ? <span class="keyword">null</span> : data.getData();</div><div class="line">            <span class="keyword">if</span> (uploadMessageAboveL != <span class="keyword">null</span>) &#123;</div><div class="line">                onActivityResultAboveL(requestCode, resultCode, data);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (uploadMessage != <span class="keyword">null</span>) &#123;</div><div class="line">                uploadMessage.onReceiveValue(result);</div><div class="line">                uploadMessage = <span class="keyword">null</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@TargetApi</span>(Build.VERSION_CODES.LOLLIPOP)</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onActivityResultAboveL</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent intent)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (requestCode != FILE_CHOOSER_RESULT_CODE || uploadMessageAboveL == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        Uri[] results = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span> (resultCode == Activity.RESULT_OK) &#123;</div><div class="line">            <span class="keyword">if</span> (intent != <span class="keyword">null</span>) &#123;</div><div class="line">                String dataString = intent.getDataString();</div><div class="line">                ClipData clipData = intent.getClipData();</div><div class="line">                <span class="keyword">if</span> (clipData != <span class="keyword">null</span>) &#123;</div><div class="line">                    results = <span class="keyword">new</span> Uri[clipData.getItemCount()];</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; clipData.getItemCount(); i++) &#123;</div><div class="line">                        ClipData.Item item = clipData.getItemAt(i);</div><div class="line">                        results[i] = item.getUri();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (dataString != <span class="keyword">null</span>) &#123;</div><div class="line">                    results = <span class="keyword">new</span> Uri[]&#123;Uri.parse(dataString)&#125;;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        uploadMessageAboveL.onReceiveValue(results);</div><div class="line">        uploadMessageAboveL = <span class="keyword">null</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p>@params filePathCallback:  æä¾›è¦ä¸Šä¼ çš„æ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨, or NULL to cancel. Must only be called if the showFileChooser implementations returns true.</p><p>@params fileChooserParams:  æè¿°è¦æ‰“å¼€çš„æ–‡ä»¶é€‰æ‹©å™¨çš„æ¨¡å¼ï¼Œä»¥åŠä¸ä¹‹ä¸€èµ·ä½¿ç”¨çš„é€‰é¡¹ã€‚</p><h2 id="7ã€è§†é¢‘-å…¨å±-æ’­æ”¾"><a href="#7ã€è§†é¢‘-å…¨å±-æ’­æ”¾" class="headerlink" title="7ã€è§†é¢‘(å…¨å±)æ’­æ”¾"></a>7ã€è§†é¢‘(å…¨å±)æ’­æ”¾</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Bitmap <span class="title">getDefaultVideoPoster</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Htmlä¸­ï¼Œè§†é¢‘ï¼ˆvideoï¼‰æ§ä»¶åœ¨æ²¡æœ‰æ’­æ”¾çš„æ—¶å€™å°†ç»™ç”¨æˆ·å±•ç¤ºä¸€å¼ â€œæµ·æŠ¥â€å›¾ç‰‡ï¼ˆé¢„è§ˆå›¾ï¼‰ã€‚å…¶é¢„è§ˆå›¾æ˜¯ç”±Htmlä¸­videoæ ‡ç­¾çš„<a href="http://www.w3school.com.cn/tags/att_video_poster.asp" target="_blank" rel="external">poster</a>å±æ€§æ¥æŒ‡å®šçš„ã€‚å¦‚æœå¼€å‘è€…æ²¡æœ‰è®¾ç½®posterå±æ€§, åˆ™å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è®¾ç½®é»˜è®¤çš„é¢„è§ˆå›¾ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">controls</span> <span class="attr">poster</span>=<span class="string">"/images/w3school.gif"</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"movie.mp4"</span> <span class="attr">type</span>=<span class="string">"video/mp4"</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"movie.ogg"</span> <span class="attr">type</span>=<span class="string">"video/ogg"</span>&gt;</span></div><div class="line">   Your browser does not support the video tag.</div><div class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> View <span class="title">getVideoLoadingProgressView</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ’­æ”¾è§†é¢‘æ—¶ï¼Œåœ¨ç¬¬ä¸€å¸§å‘ˆç°ä¹‹å‰ï¼Œéœ€è¦èŠ±ä¸€å®šçš„æ—¶é—´æ¥è¿›è¡Œæ•°æ®ç¼“å†²ã€‚ChromeClientå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥æä¾›ä¸€ä¸ªåœ¨æ•°æ®ç¼“å†²æ—¶æ˜¾ç¤ºçš„è§†å›¾ã€‚ ä¾‹å¦‚,ChromeClientå¯ä»¥åœ¨ç¼“å†²æ—¶æ˜¾ç¤ºä¸€ä¸ªè½¬è½®åŠ¨ç”»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onShowCustomView</span><span class="params">(View view, CustomViewCallback callback)</span> </span>&#123;&#125;;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onHideCustomView</span><span class="params">()</span> </span>&#123;&#125;</div></pre></td></tr></table></figure><p>é€šçŸ¥ä¸»æœºåº”ç”¨webviewéœ€è¦æ˜¾ç¤ºä¸€ä¸ªcustom viewï¼Œä¸»è¦æ˜¯ç”¨åœ¨è§†é¢‘å…¨å± HTML5 Video supportã€‚</p><p>ç½‘é¡µä¸­æœ‰H5æ’­æ”¾flash videoçš„æ—¶å€™æŒ‰ä¸‹å…¨å±æŒ‰é’®å°†ä¼šè°ƒç”¨åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œä¸€èˆ¬ç”¨ä½œè®¾ç½®ç½‘é¡µæ’­æ”¾å…¨å±æ“ä½œã€‚</p><h2 id="8ã€è·å–åœ°ç†ä½ç½®"><a href="#8ã€è·å–åœ°ç†ä½ç½®" class="headerlink" title="8ã€è·å–åœ°ç†ä½ç½®"></a>8ã€è·å–åœ°ç†ä½ç½®</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGeolocationPermissionsShowPrompt</span><span class="params">(String origin, GeolocationPermissions.Callback callback)</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGeolocationPermissionsHidePrompt</span><span class="params">()</span> </span>&#123;&#125;</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeolocationPermissions</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * A callback interface used by the host application to set the Geolocation</div><div class="line">     * permission state for an origin.</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callback</span> </span>&#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets the Geolocation permission state for the supplied origin.</div><div class="line">         *</div><div class="line">         * <span class="doctag">@param</span> origin the origin for which permissions are set</div><div class="line">         * <span class="doctag">@param</span> allow whether or not the origin should be allowed to use the</div><div class="line">         *              Geolocation API</div><div class="line">         * <span class="doctag">@param</span> retain whether the permission should be retained beyond the</div><div class="line">         *               lifetime of a page currently being displayed by a</div><div class="line">         *               WebView</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(String origin, <span class="keyword">boolean</span> allow, <span class="keyword">boolean</span> retain)</span></span>;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>JavaScriptä¸­æœ‰è°ƒç”¨å®šä½çš„APIæ—¶ä¼šè°ƒç”¨æœ¬æ–¹æ³•</p><p>@param origin æ¥æºï¼Œè°è°ƒç”¨çš„ï¼Œä¼ å›ç»™è°</p><p>@param allow æ˜¯å¦å…è®¸æœ¬æ¬¡å®šä½</p><p>@param retain æ˜¯å¦ä¿æŒå…è®¸å®šä½çŠ¶æ€ï¼Œä¼ é€’äº†trueåï¼Œæœ¬WebViewä¹‹åéƒ½å¯ä»¥è·å¾—å½“å‰ä½ç½®ä¿¡æ¯ã€‚</p><p>å¯¹åº”çš„onGeolocationPermissionsHidePromptï¼ˆï¼‰å°±æ˜¯é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåœ°ç†ä½ç½®æƒé™è¯·æ±‚å·²è¢«å–æ¶ˆ</p><h2 id="9ã€è¯·æ±‚æƒé™"><a href="#9ã€è¯·æ±‚æƒé™" class="headerlink" title="9ã€è¯·æ±‚æƒé™"></a>9ã€è¯·æ±‚æƒé™</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">    <span class="comment">/**</span></div><div class="line">     * Notify the host application that web content is requesting permission to</div><div class="line">     * access the specified resources and the permission currently isn't granted</div><div class="line">     * or denied. The host application must invoke &#123;<span class="doctag">@link</span> PermissionRequest#grant(String[])&#125;</div><div class="line">     * or &#123;<span class="doctag">@link</span> PermissionRequest#deny()&#125;.</div><div class="line">     *</div><div class="line">     * If this method isn't overridden, the permission is denied.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> request the PermissionRequest from current web content.</div><div class="line">     */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPermissionRequest</span><span class="params">(PermissionRequest request)</span> </span>&#123;</div><div class="line">    request.deny();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Notify the host application that the given permission request</div><div class="line"> * has been canceled. Any related UI should therefore be hidden.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> request the PermissionRequest that needs be canceled.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPermissionRequestCanceled</span><span class="params">(PermissionRequest request)</span> </span>&#123;&#125;</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionRequest</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String RESOURCE_VIDEO_CAPTURE = <span class="string">"android.webkit.resource.VIDEO_CAPTURE"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String RESOURCE_AUDIO_CAPTURE = <span class="string">"android.webkit.resource.AUDIO_CAPTURE"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String RESOURCE_PROTECTED_MEDIA_ID =</div><div class="line">            <span class="string">"android.webkit.resource.PROTECTED_MEDIA_ID"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String RESOURCE_MIDI_SYSEX = <span class="string">"android.webkit.resource.MIDI_SYSEX"</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Uri <span class="title">getOrigin</span><span class="params">()</span></span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String[] getResources();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">grant</span><span class="params">(String[] resources)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">deny</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>@method getorigin()è·å–æ¥æº</p><p>@method getResources()è·å–è¯·æ±‚çš„æƒé™åˆ—è¡¨</p><p>@method grant ()å…è®¸çš„æƒé™åˆ—è¡¨</p><p>@method deny()æ‹’ç»äº†æƒé™</p><p>éœ€è¦çš„å°±æ˜¯PermissRequestä¸­å®šä¹‰çš„å››ä¸ªå¸¸äº®ä»£è¡¨çš„æƒé™ï¼Œå…³äºæƒé™çš„ä½¿ç”¨æ˜¯å…¶ä»–çŸ¥è¯†ç‚¹ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹è¿™ä¸ª<a href="https://codeday.me/bug/20181125/420409.html" target="_blank" rel="external">æ —å­</a>ã€‚</p><h2 id="10ã€å…¶ä»–æ–¹æ³•"><a href="#10ã€å…¶ä»–æ–¹æ³•" class="headerlink" title="10ã€å…¶ä»–æ–¹æ³•"></a>10ã€å…¶ä»–æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> *è·å¾—æ‰€æœ‰è®¿é—®å†å²é¡¹ç›®çš„åˆ—è¡¨ï¼Œç”¨äºé“¾æ¥ç€è‰²ã€‚</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getVisitedHistory</span><span class="params">(ValueCallback&lt;String[]&gt; callback)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *webviewè¯·æ±‚å¾—åˆ°ç„¦ç‚¹ï¼Œå‘ç”Ÿè¿™ä¸ªä¸»è¦æ˜¯å½“å‰webviewä¸æ˜¯å‰å°çŠ¶æ€ï¼Œæ˜¯åå°webviewã€‚</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestFocus</span><span class="params">(WebView view)</span> </span>&#123;&#125;</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android WebViewå¿…çŸ¥å¿…ä¼š(2)-WebSettings</title>
      <link href="/post/webview-learning-WebSettings/"/>
      <url>/post/webview-learning-WebSettings/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>WebSettings çœ‹åç§°å°±æ˜æ˜¾äº†ï¼Œæ˜¯å¯¹WebViewçš„ä¸€äº›åŸºç¡€è®¾ç½®ï¼Œç½‘é¡µä¸­éœ€è¦çš„ä¸€äº›æ”¯æŒå‡éœ€è¦åœ¨WebSettings ä¸­è®¾ç½®ã€‚è·å–æ–¹å¼ä¹Ÿå¾ˆç®€å•,é€šè¿‡WebViewçš„æ–¹æ³•è·å¾—å³å¯ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> WebSettings <span class="title">getSettings</span><span class="params">()</span> </span>&#123;</div><div class="line">    checkThread();</div><div class="line">    <span class="keyword">return</span> mProvider.getSettings();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><a id="more"></a><p>è®°å½•ä¸‹å¯¹åº”çš„APIå«ä¹‰ï¼ŒåŸºæœ¬æ˜¯ç›´æ¥æ‰¾æ¥çš„ï¼Œå¤§éƒ¨åˆ†åœ¨é¡¹ç›®ç”¨æœ‰éªŒè¯ï¼Œå¦‚æœæœ‰ä½¿ç”¨åå·®ä¼šéšæ—¶å›æ¥ä¿®æ”¹ï¼Œå¤§å®¶å‚è€ƒä¸‹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦æ”¯æŒç¼©æ”¾ï¼Œé…åˆæ–¹æ³•setBuiltInZoomControlsä½¿ç”¨ï¼Œé»˜è®¤true</div><div class="line"> */</div><div class="line">setSupportZoom(<span class="keyword">boolean</span> support)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦éœ€è¦ç”¨æˆ·æ‰‹åŠ¿æ¥æ’­æ”¾Mediaï¼Œé»˜è®¤true</div><div class="line"> */</div><div class="line">setMediaPlaybackRequiresUserGesture(<span class="keyword">boolean</span> require)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦ä½¿ç”¨WebViewå†…ç½®çš„ç¼©æ”¾ç»„ä»¶ï¼Œç”±æµ®åŠ¨åœ¨çª—å£ä¸Šçš„ç¼©æ”¾æ§åˆ¶å’Œæ‰‹åŠ¿ç¼©æ”¾æ§åˆ¶ç»„æˆï¼Œé»˜è®¤false</div><div class="line"> */</div><div class="line">setBuiltInZoomControls(<span class="keyword">boolean</span> enabled)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦æ˜¾ç¤ºçª—å£æ‚¬æµ®çš„ç¼©æ”¾æ§åˆ¶ï¼Œé»˜è®¤true</div><div class="line"> */</div><div class="line">setDisplayZoomControls(<span class="keyword">boolean</span> enabled)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦å…è®¸è®¿é—®WebViewå†…éƒ¨æ–‡ä»¶ï¼Œé»˜è®¤true</div><div class="line"> */</div><div class="line">setAllowFileAccess(<span class="keyword">boolean</span> allow)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦å…è®¸è·å–WebViewçš„å†…å®¹URL ï¼Œå¯ä»¥è®©WebViewè®¿é—®ContentPrividerå­˜å‚¨çš„å†…å®¹ã€‚ é»˜è®¤true</div><div class="line"> */</div><div class="line">setAllowContentAccess(<span class="keyword">boolean</span> allow)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦å¯åŠ¨æ¦‚è¿°æ¨¡å¼æµè§ˆç•Œé¢ï¼Œå½“é¡µé¢å®½åº¦è¶…è¿‡WebViewæ˜¾ç¤ºå®½åº¦æ—¶ï¼Œç¼©å°é¡µé¢é€‚åº”WebViewã€‚é»˜è®¤false</div><div class="line"> */</div><div class="line">setLoadWithOverviewMode(<span class="keyword">boolean</span> overview)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦ä¿å­˜è¡¨å•æ•°æ®ï¼Œé»˜è®¤false</div><div class="line"> */</div><div class="line">setSaveFormData(<span class="keyword">boolean</span> save)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®é¡µé¢æ–‡å­—ç¼©æ”¾ç™¾åˆ†æ¯”ï¼Œé»˜è®¤100%</div><div class="line"> */</div><div class="line">setTextZoom(<span class="keyword">int</span> textZoom)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦æ”¯æŒViewPortçš„meta tagå±æ€§ï¼Œå¦‚æœé¡µé¢æœ‰ViewPort meta tag æŒ‡å®šçš„å®½åº¦ï¼Œåˆ™ä½¿ç”¨meta tagæŒ‡å®šçš„å€¼ï¼Œå¦åˆ™é»˜è®¤ä½¿ç”¨å®½å±çš„è§†å›¾çª—å£</div><div class="line"> */</div><div class="line">setUseWideViewPort(<span class="keyword">boolean</span> use)</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦æ”¯æŒå¤šçª—å£ï¼Œå¦‚æœè®¾ç½®ä¸ºtrue ï¼ŒWebChromeClient#onCreateWindowæ–¹æ³•å¿…é¡»è¢«ä¸»ç¨‹åºå®ç°ï¼Œé»˜è®¤false</div><div class="line"> */</div><div class="line">setSupportMultipleWindows(<span class="keyword">boolean</span> support)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æŒ‡å®šWebViewçš„é¡µé¢å¸ƒå±€æ˜¾ç¤ºå½¢å¼ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ä¼šå¼•èµ·é¡µé¢é‡ç»˜ã€‚é»˜è®¤LayoutAlgorithm#NARROW_COLUMNS</div><div class="line"> */</div><div class="line">setLayoutAlgorithm(LayoutAlgorithm l)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®æ ‡å‡†çš„å­—ä½“æ—ï¼Œé»˜è®¤â€sans-serifâ€ã€‚font-family è§„å®šå…ƒç´ çš„å­—ä½“ç³»åˆ—ã€‚</div><div class="line"> * font-family å¯ä»¥æŠŠå¤šä¸ªå­—ä½“åç§°ä½œä¸ºä¸€ä¸ªâ€œå›é€€â€ç³»ç»Ÿæ¥ä¿å­˜ã€‚å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒç¬¬ä¸€ä¸ªå­—ä½“ï¼Œ</div><div class="line"> * åˆ™ä¼šå°è¯•ä¸‹ä¸€ä¸ªã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œfont-family å±æ€§çš„å€¼æ˜¯ç”¨äºæŸä¸ªå…ƒç´ çš„å­—ä½“æ—åç§°æˆ–/åŠç±»æ—åç§°çš„ä¸€ä¸ª</div><div class="line"> * ä¼˜å…ˆè¡¨ã€‚æµè§ˆå™¨ä¼šä½¿ç”¨å®ƒå¯è¯†åˆ«çš„ç¬¬ä¸€ä¸ªå€¼ã€‚</div><div class="line"> */</div><div class="line">setStandardFontFamily(String font)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®æ··åˆå­—ä½“æ—ã€‚é»˜è®¤â€monospaceâ€</div><div class="line"> */</div><div class="line">setFixedFontFamily(String font)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®SansSerifå­—ä½“æ—ã€‚é»˜è®¤â€sans-serifâ€</div><div class="line"> */</div><div class="line">setSansSerifFontFamily(String font)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®SerifFontå­—ä½“æ—ï¼Œé»˜è®¤â€sans-serifâ€</div><div class="line"> */</div><div class="line">setSerifFontFamily(String font)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®CursiveFontå­—ä½“æ—ï¼Œé»˜è®¤â€cursiveâ€</div><div class="line"> */</div><div class="line">setCursiveFontFamily(String font)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®FantasyFontå­—ä½“æ—ï¼Œé»˜è®¤â€fantasyâ€</div><div class="line"> */</div><div class="line">setFantasyFontFamily(String font)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®æœ€å°å­—ä½“ï¼Œé»˜è®¤8. å–å€¼åŒºé—´[1-72]ï¼Œè¶…è¿‡èŒƒå›´ï¼Œä½¿ç”¨å…¶ä¸Šé™å€¼ã€‚</div><div class="line"> */</div><div class="line">setMinimumFontSize(<span class="keyword">int</span> size)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®æœ€å°é€»è¾‘å­—ä½“ï¼Œé»˜è®¤8. å–å€¼åŒºé—´[1-72]ï¼Œè¶…è¿‡èŒƒå›´ï¼Œä½¿ç”¨å…¶ä¸Šé™å€¼ã€‚</div><div class="line"> */</div><div class="line">setMinimumLogicalFontSize(<span class="keyword">int</span> size)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®é»˜è®¤å­—ä½“å¤§å°ï¼Œé»˜è®¤16ï¼Œå–å€¼åŒºé—´[1-72]ï¼Œè¶…è¿‡èŒƒå›´ï¼Œä½¿ç”¨å…¶ä¸Šé™å€¼ã€‚</div><div class="line"> */</div><div class="line">setDefaultFontSize(<span class="keyword">int</span> size)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®é»˜è®¤å¡«å……å­—ä½“å¤§å°ï¼Œé»˜è®¤16ï¼Œå–å€¼åŒºé—´[1-72]ï¼Œè¶…è¿‡èŒƒå›´ï¼Œä½¿ç”¨å…¶ä¸Šé™å€¼ã€‚</div><div class="line"> */</div><div class="line">setDefaultFixedFontSize(<span class="keyword">int</span> size)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®æ˜¯å¦åŠ è½½å›¾ç‰‡èµ„æºï¼Œæ³¨æ„ï¼šæ–¹æ³•æ§åˆ¶æ‰€æœ‰çš„èµ„æºå›¾ç‰‡æ˜¾ç¤ºï¼ŒåŒ…æ‹¬åµŒå…¥çš„æœ¬åœ°å›¾ç‰‡èµ„æºã€‚</div><div class="line"> * ä½¿ç”¨æ–¹æ³•setBlockNetworkImageåˆ™åªé™åˆ¶ç½‘ç»œèµ„æºå›¾ç‰‡çš„æ˜¾ç¤ºã€‚å€¼è®¾ç½®ä¸ºtrueåï¼Œ</div><div class="line"> * webviewä¼šè‡ªåŠ¨åŠ è½½ç½‘ç»œå›¾ç‰‡ã€‚é»˜è®¤true</div><div class="line"> */</div><div class="line">setLoadsImagesAutomatically(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦åŠ è½½ç½‘ç»œå›¾ç‰‡èµ„æºã€‚æ³¨æ„å¦‚æœgetLoadsImagesAutomaticallyè¿”å›falseï¼Œåˆ™è¯¥æ–¹æ³•æ²¡æœ‰æ•ˆæœã€‚</div><div class="line"> * å¦‚æœä½¿ç”¨setBlockNetworkLoadsè®¾ç½®ä¸ºfalseï¼Œè¯¥æ–¹æ³•è®¾ç½®ä¸ºfalseï¼Œä¹Ÿä¸ä¼šæ˜¾ç¤ºç½‘ç»œå›¾ç‰‡ã€‚</div><div class="line"> * å½“å€¼ä»trueæ”¹ä¸ºfalseæ—¶ã€‚WebViewä¼šè‡ªåŠ¨åŠ è½½ç½‘ç»œå›¾ç‰‡ã€‚</div><div class="line"> */</div><div class="line">setBlockNetworkImage(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®æ˜¯å¦åŠ è½½ç½‘ç»œèµ„æºã€‚æ³¨æ„å¦‚æœå€¼ä»trueåˆ‡æ¢ä¸ºfalseåï¼ŒWebViewä¸ä¼šè‡ªåŠ¨åŠ è½½ï¼Œ</div><div class="line"> * é™¤éè°ƒç”¨WebView#reload().å¦‚æœæ²¡æœ‰android.Manifest.permission#INTERNETæƒé™ï¼Œ</div><div class="line"> * å€¼è®¾ä¸ºfalseï¼Œåˆ™ä¼šæŠ›å‡ºjava.lang.SecurityExceptionå¼‚å¸¸ã€‚</div><div class="line"> * é»˜è®¤å€¼ï¼šæœ‰android.Manifest.permission#INTERNETæƒé™æ—¶ä¸ºfalseï¼Œå…¶ä»–ä¸ºtrueã€‚</div><div class="line"> */</div><div class="line">setBlockNetworkLoads(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®æ˜¯å¦å…è®¸æ‰§è¡ŒJSã€‚</div><div class="line"> */</div><div class="line">setJavaScriptEnabled(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦å…è®¸Jsè®¿é—®ä»»ä½•æ¥æºçš„å†…å®¹ã€‚åŒ…æ‹¬è®¿é—®file schemeçš„URLsã€‚è€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œ</div><div class="line"> * é™åˆ¶Jsè®¿é—®èŒƒå›´é»˜è®¤ç¦ç”¨ã€‚æ³¨æ„ï¼šè¯¥æ–¹æ³•åªå½±å“file schemeç±»å‹çš„èµ„æºï¼Œå…¶ä»–ç±»å‹èµ„æºå¦‚å›¾ç‰‡ç±»å‹çš„ï¼Œ</div><div class="line"> * ä¸ä¼šå—åˆ°å½±å“ã€‚ICE_CREAM_SANDWICH_MR1ç‰ˆæœ¬ä»¥åŠä»¥ä¸‹é»˜è®¤ä¸ºtrueï¼ŒJELLY_BEANç‰ˆæœ¬</div><div class="line"> * ä»¥ä¸Šé»˜è®¤ä¸ºfalse</div><div class="line"> */</div><div class="line">setAllowUniversalAccessFromFileURLs(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦å…è®¸Jsè®¿é—®å…¶ä»–file schemeçš„URLsã€‚åŒ…æ‹¬è®¿é—®file schemeçš„èµ„æºã€‚è€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œ</div><div class="line"> * é™åˆ¶Jsè®¿é—®èŒƒå›´é»˜è®¤ç¦ç”¨ã€‚æ³¨æ„ï¼šè¯¥æ–¹æ³•åªå½±å“file schemeç±»å‹çš„èµ„æºï¼Œå…¶ä»–ç±»å‹èµ„æºå¦‚å›¾ç‰‡ç±»å‹çš„ï¼Œ</div><div class="line"> * ä¸ä¼šå—åˆ°å½±å“ã€‚å¦‚æœgetAllowUniversalAccessFromFileURLsä¸ºtrueï¼Œåˆ™è¯¥æ–¹æ³•è¢«å¿½ç•¥ã€‚</div><div class="line"> * ICE_CREAM_SANDWICH_MR1ç‰ˆæœ¬ä»¥åŠä»¥ä¸‹é»˜è®¤ä¸ºtrueï¼ŒJELLY_BEANç‰ˆæœ¬ä»¥ä¸Šé»˜è®¤ä¸ºfalse</div><div class="line"> */</div><div class="line">setAllowFileAccessFromFileURLs(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®å­˜å‚¨å®šä½æ•°æ®åº“çš„ä½ç½®ï¼Œè€ƒè™‘åˆ°ä½ç½®æƒé™å’ŒæŒä¹…åŒ–Cacheç¼“å­˜ï¼ŒApplicationéœ€è¦æ‹¥æœ‰æŒ‡å®šè·¯å¾„çš„</div><div class="line"> * writeæƒé™</div><div class="line"> */</div><div class="line">setGeolocationDatabasePath(String databasePath)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦å…è®¸Cacheï¼Œé»˜è®¤falseã€‚è€ƒè™‘éœ€è¦å­˜å‚¨ç¼“å­˜ï¼Œåº”è¯¥ä¸ºç¼“å­˜æŒ‡å®šå­˜å‚¨è·¯å¾„setAppCachePath</div><div class="line"> */</div><div class="line">setAppCacheEnabled(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®Cache APIç¼“å­˜è·¯å¾„ã€‚ä¸ºäº†ä¿è¯å¯ä»¥è®¿é—®Cacheï¼ŒApplicationéœ€è¦æ‹¥æœ‰æŒ‡å®šè·¯å¾„çš„writeæƒé™ã€‚</div><div class="line"> * è¯¥æ–¹æ³•åº”è¯¥åªè°ƒç”¨ä¸€æ¬¡ï¼Œå¤šæ¬¡è°ƒç”¨è‡ªåŠ¨å¿½ç•¥ã€‚</div><div class="line"> */</div><div class="line">setAppCachePath(String appCachePath)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦å…è®¸æ•°æ®åº“å­˜å‚¨ã€‚é»˜è®¤falseã€‚æŸ¥çœ‹setDatabasePath API å¦‚ä½•æ­£ç¡®è®¾ç½®æ•°æ®åº“å­˜å‚¨ã€‚</div><div class="line"> * è¯¥è®¾ç½®æ‹¥æœ‰å…¨å±€ç‰¹æ€§ï¼ŒåŒä¸€è¿›ç¨‹æ‰€æœ‰WebViewå®ä¾‹å…±ç”¨åŒä¸€é…ç½®ã€‚æ³¨æ„ï¼šä¿è¯åœ¨åŒä¸€è¿›ç¨‹çš„ä»»ä¸€WebView</div><div class="line"> * åŠ è½½é¡µé¢ä¹‹å‰ä¿®æ”¹è¯¥å±æ€§ï¼Œå› ä¸ºåœ¨è¿™ä¹‹åè®¾ç½®WebViewå¯èƒ½ä¼šå¿½ç•¥è¯¥é…ç½®</div><div class="line"> */</div><div class="line">setDatabaseEnabled(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦å­˜å‚¨é¡µé¢DOMç»“æ„ï¼Œé»˜è®¤falseã€‚</div><div class="line"> */</div><div class="line">setDomStorageEnabled(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦å…è®¸å®šä½ï¼Œé»˜è®¤trueã€‚æ³¨æ„ï¼šä¸ºäº†ä¿è¯å®šä½å¯ä»¥ä½¿ç”¨ï¼Œè¦ä¿è¯ä»¥ä¸‹å‡ ç‚¹ï¼š</div><div class="line"> * Application éœ€è¦æœ‰android.Manifest.permission#ACCESS_COARSE_LOCATIONçš„æƒé™</div><div class="line"> * Application éœ€è¦å®ç°WebChromeClient#onGeolocationPermissionsShowPromptçš„å›è°ƒï¼Œ</div><div class="line"> * æ¥æ”¶Jså®šä½è¯·æ±‚è®¿é—®åœ°ç†ä½ç½®çš„é€šçŸ¥</div><div class="line"> */</div><div class="line">setGeolocationEnabled(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ˜¯å¦å…è®¸JSè‡ªåŠ¨æ‰“å¼€çª—å£ã€‚é»˜è®¤false</div><div class="line"> */</div><div class="line">setJavaScriptCanOpenWindowsAutomatically(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®é¡µé¢çš„ç¼–ç æ ¼å¼ï¼Œé»˜è®¤UTF-8</div><div class="line"> */</div><div class="line">setDefaultTextEncodingName(String encoding)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®WebViewä»£ç†ï¼Œé»˜è®¤ä½¿ç”¨é»˜è®¤å€¼</div><div class="line"> */</div><div class="line">setUserAgentString(String ua)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * é€šçŸ¥WebViewæ˜¯å¦éœ€è¦è®¾ç½®ä¸€ä¸ªèŠ‚ç‚¹è·å–ç„¦ç‚¹å½“</div><div class="line"> * WebView#requestFocus(int,android.graphics.Rect)è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œé»˜è®¤true</div><div class="line"> */</div><div class="line">setNeedInitialFocus(<span class="keyword">boolean</span> flag)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * åŸºäºWebViewå¯¼èˆªçš„ç±»å‹ä½¿ç”¨ç¼“å­˜ï¼šæ­£å¸¸é¡µé¢åŠ è½½ä¼šåŠ è½½ç¼“å­˜å¹¶æŒ‰éœ€åˆ¤æ–­å†…å®¹æ˜¯å¦éœ€è¦é‡æ–°éªŒè¯ã€‚</div><div class="line"> * å¦‚æœæ˜¯é¡µé¢è¿”å›ï¼Œé¡µé¢å†…å®¹ä¸ä¼šé‡æ–°åŠ è½½ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­æ¢å¤ã€‚setCacheModeå…è®¸å®¢æˆ·ç«¯æ ¹æ®æŒ‡å®šçš„æ¨¡å¼æ¥</div><div class="line"> * ä½¿ç”¨ç¼“å­˜ã€‚</div><div class="line"> * LOAD_DEFAULT é»˜è®¤åŠ è½½æ–¹å¼</div><div class="line"> * LOAD_CACHE_ELSE_NETWORK æŒ‰ç½‘ç»œæƒ…å†µä½¿ç”¨ç¼“å­˜</div><div class="line"> * LOAD_NO_CACHE ä¸ä½¿ç”¨ç¼“å­˜</div><div class="line"> * LOAD_CACHE_ONLY åªä½¿ç”¨ç¼“å­˜</div><div class="line"> */</div><div class="line">setCacheMode(<span class="keyword">int</span> mode)</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®åŠ è½½ä¸å®‰å…¨èµ„æºçš„WebViewåŠ è½½è¡Œä¸ºã€‚KITKATç‰ˆæœ¬ä»¥åŠä»¥ä¸‹é»˜è®¤ä¸ºMIXED_CONTENT_ALWAYS_ALLOWæ–¹</div><div class="line"> * å¼ï¼ŒLOLLIPOPé»˜è®¤MIXED_CONTENT_NEVER_ALLOWã€‚å¼ºçƒˆå»ºè®®ï¼šä½¿ç”¨MIXED_CONTENT_NEVER_ALLOW</div><div class="line"> */</div><div class="line">setMixedContentMode(<span class="keyword">int</span> mode)</div></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¾®åšç™»é™†ï¼ŒQQç™»å½•é”™è¯¯ç </title>
      <link href="/post/threee-way-login-errorcode/"/>
      <url>/post/threee-way-login-errorcode/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹ç¬¬ä¸‰æ–¹ç™»å½•çš„é”™è¯¯ç ï¼Œé‡åˆ°çš„æ€»ç»“èµ·æ¥ï¼Œä»¥ä¾¿æ’æŸ¥é—®é¢˜ã€‚</p><a id="more"></a><h2 id="Weibo-Login-OAuth2-0"><a href="#Weibo-Login-OAuth2-0" class="headerlink" title="Weibo Login OAuth2.0"></a>Weibo Login OAuth2.0</h2><div class="article-bounded"><div class="article-table"><table><thead><tr><th>é”™è¯¯ç (error)</th><th>é”™è¯¯ç¼–å·(error_code)</th><th>é”™è¯¯æè¿°(error_description)</th></tr></thead><tbody><tr><td>redirect_uri_mismatch</td><td>21322</td><td>é‡å®šå‘åœ°å€ä¸åŒ¹é… </td></tr><tr><td>invalid_request</td><td>21323</td><td>è¯·æ±‚ä¸åˆæ³• </td></tr><tr><td>invalid_client</td><td>21324</td><td>client_idæˆ–client_secretå‚æ•°æ— æ•ˆ</td></tr><tr><td>invalid_grant</td><td>21325</td><td>æä¾›çš„Access Grantæ˜¯æ— æ•ˆçš„ã€è¿‡æœŸçš„æˆ–å·²æ’¤é”€çš„</td></tr><tr><td>unauthorized_client</td><td>21326</td><td>å®¢æˆ·ç«¯æ²¡æœ‰æƒé™</td></tr><tr><td>expired_token</td><td>21327</td><td>tokenè¿‡æœŸ</td></tr><tr><td>unsupported_grant_type</td><td>21328</td><td>ä¸æ”¯æŒçš„ GrantType</td></tr><tr><td>unsupported_response_type</td><td>21329</td><td>ä¸æ”¯æŒçš„ ResponseType</td></tr><tr><td>access_denied</td><td>21330</td><td>ç”¨æˆ·æˆ–æˆæƒæœåŠ¡å™¨æ‹’ç»æˆäºˆæ•°æ®è®¿é—®æƒé™</td></tr><tr><td>temporarily_unavailable</td><td>21331</td><td>æœåŠ¡æš‚æ—¶æ— æ³•è®¿é—®</td></tr><tr><td>appkey permission denied</td><td>21337</td><td>åº”ç”¨æƒé™ä¸è¶³</td></tr></tbody></table></div></div><h2 id="QQ-Login-OAuth2-0"><a href="#QQ-Login-OAuth2-0" class="headerlink" title="QQ Login OAuth2.0"></a>QQ Login OAuth2.0</h2><div class="article-bounded"><div class="article-table"><table><thead><tr><th>é”™è¯¯ç </th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td>0</td><td>æˆåŠŸã€‚</td></tr><tr><td>100000</td><td>ç¼ºå°‘å‚æ•°response_typeæˆ–response_typeéæ³•ã€‚</td></tr><tr><td>100001</td><td>ç¼ºå°‘å‚æ•°client_idã€‚100002ç¼ºå°‘å‚æ•°client_secretã€‚</td></tr><tr><td>100003</td><td>http headä¸­ç¼ºå°‘Authorizationã€‚</td></tr><tr><td>100004</td><td>ç¼ºå°‘å‚æ•°grant_typeæˆ–grant_typeéæ³•ã€‚</td></tr><tr><td>100005</td><td>ç¼ºå°‘å‚æ•°codeã€‚</td></tr><tr><td>100006</td><td>ç¼ºå°‘refresh tokenã€‚</td></tr><tr><td>100007</td><td>ç¼ºå°‘access tokenã€‚</td></tr><tr><td>100008</td><td>è¯¥appidä¸å­˜åœ¨ã€‚</td></tr><tr><td>100009</td><td>client_secretï¼ˆå³appkeyï¼‰éæ³•ã€‚</td></tr><tr><td>100010</td><td>å›è°ƒåœ°å€ä¸åˆæ³•ï¼Œå¸¸è§åŸå› è¯·è§ï¼šå›è°ƒåœ°å€å¸¸è§é—®é¢˜åŠä¿®æ”¹æ–¹æ³•100011APPä¸å¤„äºä¸Šçº¿çŠ¶æ€ã€‚</td></tr><tr><td>100012</td><td>HTTPè¯·æ±‚épostæ–¹å¼ã€‚</td></tr><tr><td>100013</td><td>access tokenéæ³•ã€‚</td></tr><tr><td>100014</td><td>access tokenè¿‡æœŸã€‚ tokenè¿‡æœŸæ—¶é—´ä¸º3ä¸ªæœˆã€‚å¦‚æœå­˜å‚¨çš„access tokenè¿‡æœŸï¼Œè¯·é‡æ–°èµ°ç™»å½•æµç¨‹ï¼Œæ ¹æ®ä½¿ç”¨Authorization_Codeè·å–Access_Tokenæˆ–ä½¿ç”¨Implicit_Grantæ–¹å¼è·å–Access_Tokenè·å–æ–°çš„access tokenå€¼ã€‚</td></tr><tr><td>100015</td><td>access tokenåºŸé™¤ã€‚ tokenè¢«å›æ”¶ï¼Œæˆ–è€…è¢«ç”¨æˆ·åˆ é™¤ã€‚è¯·é‡æ–°èµ°ç™»å½•æµç¨‹ï¼Œæ ¹æ®ä½¿ç”¨Authorization_Codeè·å–Access_Tokenæˆ–ä½¿ç”¨Implicit_Grantæ–¹å¼è·å–Access_Tokenè·å–æ–°çš„access tokenå€¼ã€‚</td></tr><tr><td>100016</td><td>access tokenéªŒè¯å¤±è´¥ã€‚</td></tr><tr><td>100017</td><td>è·å–appidå¤±è´¥ã€‚</td></tr><tr><td>100018</td><td>è·å–codeå€¼å¤±è´¥ã€‚</td></tr><tr><td>100019</td><td>ç”¨codeæ¢å–access tokenå€¼å¤±è´¥ã€‚</td></tr><tr><td>100020</td><td>codeè¢«é‡å¤ä½¿ç”¨ã€‚</td></tr><tr><td>100021</td><td>è·å–access tokenå€¼å¤±è´¥ã€‚</td></tr><tr><td>100022</td><td>è·å–refresh tokenå€¼å¤±è´¥ã€‚</td></tr><tr><td>100023</td><td>è·å–appå…·æœ‰çš„æƒé™åˆ—è¡¨å¤±è´¥ã€‚</td></tr><tr><td>100024</td><td>è·å–æŸOpenIDå¯¹æŸappidçš„æƒé™åˆ—è¡¨å¤±è´¥ã€‚</td></tr><tr><td>100025</td><td>è·å–å…¨é‡apiä¿¡æ¯ã€å…¨é‡åˆ†ç»„ä¿¡æ¯ã€‚</td></tr><tr><td>100026</td><td>è®¾ç½®ç”¨æˆ·å¯¹æŸappæˆæƒapiåˆ—è¡¨å¤±è´¥ã€‚</td></tr><tr><td>100027</td><td>è®¾ç½®ç”¨æˆ·å¯¹æŸappæˆæƒæ—¶é—´å¤±è´¥ã€‚</td></tr><tr><td>100028</td><td>ç¼ºå°‘å‚æ•°whichã€‚</td></tr><tr><td>100029</td><td>é”™è¯¯çš„httpè¯·æ±‚ã€‚</td></tr><tr><td>100030</td><td>ç”¨æˆ·æ²¡æœ‰å¯¹è¯¥apiè¿›è¡Œæˆæƒï¼Œæˆ–ç”¨æˆ·åœ¨è…¾è®¯ä¾§åˆ é™¤äº†è¯¥apiçš„æƒé™ã€‚è¯·ç”¨æˆ·é‡æ–°èµ°ç™»å½•ã€æˆæƒæµç¨‹ï¼Œå¯¹è¯¥apiè¿›è¡Œæˆæƒã€‚</td></tr><tr><td>100031</td><td>ç¬¬ä¸‰æ–¹åº”ç”¨æ²¡æœ‰å¯¹è¯¥apiæ“ä½œçš„æƒé™ã€‚è¯·å‘é€é‚®ä»¶è¿›è¡ŒOpenAPIæƒé™ç”³è¯·ã€‚</td></tr><tr><td>100032</td><td>è¿‡è½½ï¼Œä¸€å¼€å§‹æœªç»†åˆ†æ—¶å¯ä»¥ç”¨ã€‚</td></tr><tr><td>100033</td><td>ç¼ºå°‘UINå‚æ•°ã€‚</td></tr><tr><td>100034</td><td>ç¼ºå°‘skeyå‚æ•°</td></tr><tr><td>100035</td><td>ç”¨æˆ·æœªç™»é™†ã€‚</td></tr><tr><td>100036</td><td>RefreshTokenå¤±æ•ˆã€‚</td></tr><tr><td>100037</td><td>RefreshTokenå·²è¿‡æœŸ</td></tr><tr><td>100038</td><td>RefreshTokenå·²åºŸé™¤</td></tr><tr><td>100039</td><td>RefreshTokenåˆ°è¾¾è°ƒç”¨ä¸Šé™ã€‚</td></tr><tr><td>100040</td><td>RefreshTokençš„AppKeyéæ³•ã€‚</td></tr><tr><td>100041</td><td>RefreshToken,AppIDéæ³•ã€‚</td></tr><tr><td>100042</td><td>RefreshTokenéæ³•ã€‚</td></tr><tr><td>100043</td><td>APPå¤„äºæš‚åœçŠ¶æ€ã€‚</td></tr><tr><td>100044</td><td>é”™è¯¯çš„signï¼ŒMd5æ ¡éªŒå¤±è´¥ï¼Œè¯·æ±‚ç­¾åä¸å®˜ç½‘å¡«å†™çš„ç­¾åä¸ä¸€è‡´ã€‚</td></tr><tr><td>100045</td><td>ç”¨æˆ·æ”¹å¯†tokenå¤±æ•ˆã€‚</td></tr><tr><td>100046</td><td>g_tkæ ¡éªŒå¤±è´¥ã€‚</td></tr><tr><td>100048</td><td>æ²¡æœ‰è®¾ç½®companyIDã€‚</td></tr><tr><td>100049</td><td>APPIDæ²¡æœ‰æƒé™(get_unionid)ã€‚</td></tr><tr><td>100050</td><td>OPENIDè§£å¯†å¤±è´¥ï¼Œä¸€èˆ¬æ˜¯openidå’Œappidä¸åŒ¹é…ã€‚</td></tr><tr><td>100051</td><td>è°ƒè¯•æ¨¡å¼æ— æƒé™ã€‚</td></tr><tr><td>110401</td><td>è¯·æ±‚çš„åº”ç”¨ä¸å­˜åœ¨ã€‚</td></tr><tr><td>110404</td><td>è¯·æ±‚å‚æ•°ç¼ºå°‘appidã€‚</td></tr><tr><td>110405</td><td>ç™»å½•è¯·æ±‚è¢«é™åˆ¶ï¼Œè¯·ç¨ååœ¨ç™»å½•ã€‚</td></tr><tr><td>110406</td><td>åº”ç”¨æ²¡æœ‰é€šè¿‡å®¡æ ¸ã€‚</td></tr><tr><td>110500</td><td>è·å–ç”¨æˆ·æˆæƒä¿¡æ¯å¤±è´¥ã€‚</td></tr><tr><td>110501</td><td>è·å–åº”ç”¨çš„æˆæƒä¿¡æ¯å¤±è´¥</td></tr><tr><td>110502</td><td>è®¾ç½®ç”¨æˆ·æˆæƒå¤±è´¥</td></tr><tr><td>110503</td><td>è·å–tokenå¤±è´¥</td></tr><tr><td>110504</td><td>ç³»ç»Ÿå†…éƒ¨é”™è¯¯</td></tr><tr><td>110505</td><td>å‚æ•°é”™è¯¯</td></tr><tr><td>110506</td><td>è·å–APP infoä¿¡æ¯å¤±è´¥</td></tr><tr><td>110506</td><td>æ ¡éªŒAPP info ç­¾åä¿¡æ¯å¤±è´¥</td></tr><tr><td>110508</td><td>è·å–codeå¤±è´¥</td></tr><tr><td>110509</td><td>SKEYæ ¡éªŒå¤±è´¥</td></tr><tr><td>110510</td><td>Disable</td></tr></tbody></table></div></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android WebViewå¿…çŸ¥å¿…ä¼š(1)-WebViewClient</title>
      <link href="/post/webview-learning-WebViewClient/"/>
      <url>/post/webview-learning-WebViewClient/</url>
      
        <content type="html"><![CDATA[<p>é¡¹ç›®ä¸­é‡åˆ°äº†æ··åˆå¼€å‘æ€ä¹ˆåŠï¼Œä¸éœ€è¦æ…Œï¼ŒAndroidæä¾›çš„WebViewå·²ç»éå¸¸å¼ºå¤§ï¼Œå¯ä»¥å’Œå‰ç«¯åŒå­¦é…åˆå¥½å®Œæˆéå¸¸å¤šçš„äº‹æƒ…ã€‚é…åˆä¹‹å‰å‘¢å°±éœ€è¦å¯¹WebViewåšä¸€ä¸ªå…¨é¢çš„äº†è§£ï¼Œçœ‹çœ‹WebViewèƒ½åšäº›ä»€ä¹ˆï¼Œåˆæ€ä¹ˆå»åšè¿™äº›äº‹æƒ…ï¼Œåˆä¼šé‡åˆ°å“ªäº›é—®é¢˜ã€‚</p><h2 id="WebViewç®€ä»‹"><a href="#WebViewç®€ä»‹" class="headerlink" title="WebViewç®€ä»‹"></a>WebViewç®€ä»‹</h2><p>ä»Android4.4ç³»ç»Ÿå¼€å§‹ï¼ŒChromiumå†…æ ¸å–ä»£äº†Webkitå†…æ ¸ï¼Œæ­£å¼åœ°æ¥ç®¡äº†WebViewçš„æ¸²æŸ“å·¥ä½œã€‚Chromiumæ˜¯ä¸€ä¸ªå¼€æºçš„æµè§ˆå™¨å†…æ ¸é¡¹ç›®ï¼ŒåŸºäºChromiumå¼€æºé¡¹ç›®ä¿®æ”¹å®ç°çš„æµè§ˆå™¨éå¸¸å¤šï¼ŒåŒ…æ‹¬æœ€è‘—åçš„Chromeæµè§ˆå™¨ï¼Œä»¥åŠä¸€ä¼—å›½å†…æµè§ˆå™¨ï¼ˆ360æµè§ˆå™¨ã€QQæµè§ˆå™¨ç­‰ï¼‰ã€‚å…¶ä¸­Chromiumåœ¨Androidä¸Šé¢çš„å®ç°æ˜¯<code>Android System WebView</code>ã€‚</p><a id="more"></a><p>ä»Android5.0ç³»ç»Ÿå¼€å§‹ï¼ŒWebViewç§»æ¤æˆäº†ä¸€ä¸ªç‹¬ç«‹çš„apkï¼Œå¯ä»¥ä¸ä¾èµ–ç³»ç»Ÿè€Œç‹¬ç«‹å­˜åœ¨å’Œæ›´æ–°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>ç³»ç»Ÿ-&gt;è®¾ç½®-&gt;Android System WebView</code>çœ‹åˆ°WebViewçš„å½“å‰ç‰ˆæœ¬ã€‚</p><p>ä»Android7.0ç³»ç»Ÿå¼€å§‹ï¼Œå¦‚æœç³»ç»Ÿå®‰è£…äº†Chrome (version&gt;51)ï¼Œé‚£ä¹ˆChromeå°†ä¼šç›´æ¥ä¸ºåº”ç”¨çš„WebViewæä¾›æ¸²æŸ“ï¼ŒWebViewç‰ˆæœ¬ä¼šéšç€Chromeçš„æ›´æ–°è€Œæ›´æ–°ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€‰æ‹©WebViewçš„æœåŠ¡æä¾›æ–¹ï¼ˆåœ¨å¼€å‘è€…é€‰é¡¹-&gt;WebView Implementationé‡Œï¼‰ï¼ŒWebViewå¯ä»¥è„±ç¦»åº”ç”¨ï¼Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ²™ç›’è¿›ç¨‹ä¸­æ¸²æŸ“é¡µé¢ï¼ˆéœ€è¦åœ¨å¼€å‘è€…é€‰é¡¹é‡Œæ‰“å¼€ï¼‰ã€‚</p><p>ä»Android8.0ç³»ç»Ÿå¼€å§‹ï¼Œé»˜è®¤å¼€å¯WebViewå¤šè¿›ç¨‹æ¨¡å¼ï¼Œå³WebViewè¿è¡Œåœ¨ç‹¬ç«‹çš„æ²™ç›’è¿›ç¨‹ä¸­ã€‚</p><h2 id="WebViewClient"><a href="#WebViewClient" class="headerlink" title="WebViewClient"></a>WebViewClient</h2><h3 id="æŠ›ç –"><a href="#æŠ›ç –" class="headerlink" title="æŠ›ç –"></a>æŠ›ç –</h3><p>WebViewåŠ è½½åœ¨çº¿ç½‘é¡µå¿…å¤‡ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œä¼šç›´æ¥è·³è½¬æ‰“å¼€æµè§ˆå™¨åº”ç”¨åŠ è½½ç½‘é¡µï¼åŒæ—¶åŒ…å«å¾ˆå¤šæœ‰ç”¨çš„å›è°ƒå‡½æ•°ã€‚</p><p>ä¸¾ä¸€ä¸ªå°æ —å­ï¼š</p><p>é€šå¸¸åŠ è½½ä¸€ä¸ªç½‘é¡µéƒ½éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¸€ä¸ªloadingå‹å¥½æç¤ºä¸€ä¸‹ç”¨æˆ·ï¼Œæ­£åœ¨åŠ è½½ï¼ŒåŠ è½½å®Œæˆåéšè—å®ƒã€‚è¿™ä¸ªæ€ä¹ˆå®ç°å‘¢ï¼Œå°±éœ€è¦ç”¨åˆ°WebViewClientäº†ï¼ŒWebViewClientåŒ…å«äº†å¾ˆå¤šç½‘é¡µåŠ è½½éœ€è¦ç”¨åˆ°çš„å›è°ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient()&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onPageStarted(view, url, favicon);</div><div class="line">        Log.d(TAG,<span class="string">"onPageStarted"</span>);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onPageFinished(view, url);</div><div class="line">        Log.d(TAG,<span class="string">"onPageFinished"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>WebView.setWebViewClientæ–¹æ³•è®¾ç½®WebViewClientå›è°ƒï¼Œé‡å†™äº†ä¸¤ä¸ªæ–¹æ³•ï¼ŒonPageStartedä¼šåœ¨åŠ è½½ç½‘é¡µæ—¶è°ƒç”¨ï¼ŒonPageFinishedå°±ä»£è¡¨åŠ è½½å®Œæˆäº†ã€‚åˆ©ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•å°±èƒ½å®Œæˆloadingçš„æ§åˆ¶ã€‚åœ¨onPageFinishedä¸­ä¹Ÿå¯ä»¥é€šè¿‡WebView.getTitleï¼ˆï¼‰å¯è·å¾—å½“å‰ç½‘é¡µåŠ è½½å®Œæ—¶çš„title(è¿™é‡ŒæŒ‡Htmlæ–‡ä»¶ä¸­headä¸­çš„title)ç­‰ï¼Œå½“ç„¶å¯¹æŸäº›ç½‘é¡µæ—¶ä¸å‡†çš„ï¼Œå› ä¸ºç½‘é¡µä¸­å¯èƒ½ä¼šé€šè¿‡JSä»£ç åŠ¨æ€çš„ä¿®æ”¹title,è¿™ä¸ªæ“ä½œæ˜¯åœ¨onPageFinish()ä¹‹åè¿›è¡Œçš„ï¼Œè¿™ä¸ªtitleåœ¨å¦å¤–çš„å‡½æ•°å¯ä»¥è·å–åˆ°ï¼Œæ€»ç»“WebChromeClientçš„æ—¶å€™ä¼šè®²åˆ°ã€‚</p><h3 id="å¸¸ç”¨å‡½æ•°ç®€ä»‹"><a href="#å¸¸ç”¨å‡½æ•°ç®€ä»‹" class="headerlink" title="å¸¸ç”¨å‡½æ•°ç®€ä»‹"></a>å¸¸ç”¨å‡½æ•°ç®€ä»‹</h3><p>ä¸ä¸€å®šå…¨éƒ½ä¼šç”¨åˆ°ï¼Œå…ˆå­¦ä¹ ä¸€ä¸‹ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ï¼Œä¼šæŒ‘å‡ ä¸ªéå¸¸å¸¸ç”¨çš„æ€»ç»“ä¸‹ä½¿ç”¨åœºæ™¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * åœ¨å¼€å§‹åŠ è½½ç½‘é¡µæ—¶ä¼šå›è°ƒ</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * åœ¨ç»“æŸåŠ è½½ç½‘é¡µæ—¶ä¼šå›è°ƒ</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView view, String url)</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ‹¦æˆª url è·³è½¬,åœ¨é‡Œè¾¹æ·»åŠ ç‚¹å‡»é“¾æ¥è·³è½¬æˆ–è€…æ“ä½œ</div><div class="line"> */</div><div class="line">@Deprecated</div><div class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span></div><div class="line"><span class="comment">//sdk&gt;=24    </span></div><div class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, WebResourceRequest request)</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * åœ¨æ¯ä¸€æ¬¡è¯·æ±‚èµ„æºæ—¶ï¼Œéƒ½ä¼šé€šè¿‡è¿™ä¸ªå‡½æ•°æ¥å›è°ƒ,è¯·æ±‚èµ„æºçš„ä¸»æœºåº”ç”¨ç¨‹åºå…è®¸åº”ç”¨ç¨‹åºè¿”å›æ•°æ®ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›</div><div class="line"> * nullï¼ŒWebViewå°†ä¼šæŒ‰ç…§å¹³å¸¸ä¸€æ ·ç»§ç»­åŠ è½½ï¼›å¦åˆ™ï¼Œè¿”å›çš„å†…å®¹å°†ä¼šè¢«ä½¿ç”¨ã€‚è¯¥æ–¹æ³•åœ¨ç‹¬ç«‹çº¿ç¨‹è€ŒéUIçº¿ç¨‹ä¸­å›</div><div class="line"> * è°ƒï¼Œå› æ­¤è®¿é—®ç§æœ‰æ•°æ®æˆ–ç³»ç»Ÿè§†å›¾æ—¶åº”è¯¥è°¨æ…è¡Œäº‹ã€‚</div><div class="line"> */</div><div class="line">@Deprecated</div><div class="line"><span class="keyword">public</span> WebResourceResponse <span class="title">shouldInterceptRequest</span><span class="params">(WebView view,String url)</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> WebResourceResponse <span class="title">shouldInterceptRequest</span><span class="params">(WebView view,WebResourceRequest request)</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> shouldInterceptRequest(view, request.getUrl().toString());</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> *åŠ è½½èµ„æºå®Œæˆï¼ˆä¸shouldInterceptRequestå¯¹åº”ï¼‰</div><div class="line"> */</div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadResource</span><span class="params">(WebView view, String url)</span> </span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * åŠ è½½é”™è¯¯çš„æ—¶å€™ä¼šå›è°ƒï¼Œåœ¨å…¶ä¸­å¯åšé”™è¯¯å¤„ç†ï¼Œæ¯”å¦‚å†è¯·æ±‚åŠ è½½ä¸€æ¬¡ï¼Œæˆ–è€…æç¤ºè‡ªå®šä¹‰çš„ç½‘è·¯é—®é¢˜é¡µé¢</div><div class="line"> */</div><div class="line">@Deprecated</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, <span class="keyword">int</span> errorCode,String description, String failingUrl)</span></div><div class="line"><span class="comment">//sdk&gt;=23 </span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, WebResourceRequest request, WebResourceError error)</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * å½“æ¥æ”¶åˆ°httpsé”™è¯¯æ—¶ï¼Œä¼šå›è°ƒæ­¤å‡½æ•°ï¼Œåœ¨å…¶ä¸­å¯ä»¥åšé”™è¯¯å¤„ç†</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedSslError</span><span class="params">(WebView view, SslErrorHandler handler,SslError error)</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * å›è°ƒè¯¥æ–¹æ³•ï¼Œå¤„ç†SSLè®¤è¯è¯·æ±‚</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedClientCertRequest</span><span class="params">(WebView view, ClientCertRequest request)</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * é¡µé¢å¤§å°æ”¹å˜åå›è°ƒè¯¥æ–¹æ³•ï¼Œè·å–ç¼©æ”¾å‰åå¤§å°</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScaleChanged</span><span class="params">(WebView view, <span class="keyword">float</span> oldScale, <span class="keyword">float</span> newScale)</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * æ›´æ–°å†å²è®°å½•</div><div class="line"> * @param isReload ä»£è¡¨Urlæ˜¯é‡æ–°è½½å…¥çš„</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doUpdateVisitedHistory</span><span class="params">(WebView view, String url, <span class="keyword">boolean</span> isReload)</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * è´¦æˆ·è‡ªåŠ¨ç™»å½•</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedLoginRequest</span><span class="params">(WebView view, String realm,String account, String args)</span> </div><div class="line"><span class="comment">/**</span></div><div class="line"> * é€šçŸ¥ä¸»ç¨‹åºè¾“å…¥äº‹ä»¶ä¸æ˜¯ç”±WebViewè°ƒç”¨ã€‚æ˜¯å¦è®©ä¸»ç¨‹åºå¤„ç†WebViewæœªå¤„ç†çš„Input Eventã€‚</div><div class="line"> * é™¤äº†ç³»ç»ŸæŒ‰é”®ï¼ŒWebViewæ€»æ˜¯æ¶ˆè€—æ‰è¾“å…¥äº‹ä»¶æˆ–shouldOverrideKeyEventè¿”å›trueã€‚</div><div class="line"> * è¯¥æ–¹æ³•ç”±event åˆ†å‘å¼‚æ­¥è°ƒç”¨ã€‚æ³¨æ„ï¼šå¦‚æœäº‹ä»¶ä¸ºMotionEventï¼Œåˆ™äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªå­˜åœ¨æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œ</div><div class="line"> * å¦‚æœWebViewClientæƒ³è¦ä½¿ç”¨è¿™ä¸ªEventï¼Œåˆ™éœ€è¦å¤åˆ¶Eventå¯¹è±¡ã€‚</div><div class="line"> */</div><div class="line"><span class="title">onUnhandledInputEvent</span><span class="params">(WebView view, InputEvent event)</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * å¦‚æœæµè§ˆå™¨éœ€è¦é‡æ–°å‘é€POSTè¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ—¶æœºæ¥å¤„ç†ã€‚é»˜è®¤æ˜¯ä¸é‡æ–°å‘é€æ•°æ®ã€‚ å‚æ•°è¯´æ˜</div><div class="line"> * @param dontResend æµè§ˆå™¨ä¸éœ€è¦é‡æ–°å‘é€çš„å‚æ•°</div><div class="line"> * @param resendæµè§ˆå™¨éœ€è¦é‡æ–°å‘é€çš„å‚æ•°</div><div class="line"> */</div><div class="line">@Override</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFormResubmission</span><span class="params">(WebView view, Message dontResend,Message resend)</span>ï¼</div></pre></td></tr></table></figure><h4 id="shouldOverrideUrlLoading"><a href="#shouldOverrideUrlLoading" class="headerlink" title="shouldOverrideUrlLoading"></a>shouldOverrideUrlLoading</h4><p>éå¸¸é‡è¦çš„æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå°±éœ€è¦è¯´æ˜ï¼Œé‡å®šå‘ï¼Œè¶…é“¾æ¥éƒ½ä¼šç”¨çš„æ–¹æ³•ï¼Œè¿™ä¸ªå‡½æ•°åœ¨åŠ è½½è¶…é“¾æ¥æ—¶ä¼šå›è°ƒï¼Œç”±äºè¿™ä¸ªå‡½æ•°æ˜¯åœ¨åŠ è½½Urlä¹‹å‰è°ƒç”¨ï¼Œè¿”å›å€¼trueä»£è¡¨æ‹¦æˆªå¤„ç†å°±ä¸å†ç»§ç»­åŠ è½½äº†ï¼Œè¿”å›falseåˆ™ç»§ç»­åŠ è½½ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦åšä¸€äº›ç™½åå•é»‘åå•æ“ä½œå¯ä»¥åœ¨è¿™é‡Œå¤„ç†å®ƒä»¬ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>é»˜è®¤æ—¢è¿”å›falseã€‚æ‰€ä»¥å¦‚æœæ²¡æœ‰å…¶ä»–è®¾ç½®éœ€æ±‚å¯ä»¥é‡‡ç”¨è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„WebViewClientæ—¢èƒ½ä¿æŒæ­£å¸¸åŠ è½½ç½‘é¡µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient());</div></pre></td></tr></table></figure><p>æœ‰é‡è½½æ–¹æ³•ï¼Œåœ¨SDK&gt;=24è°ƒç”¨ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦å¤„ç†ï¼Œéœ€è¦ä¸¤ä¸ªå‡½æ•°éƒ½é‡å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, WebResourceRequest request)</span></span></div></pre></td></tr></table></figure><h4 id="onReceivedError"><a href="#onReceivedError" class="headerlink" title="onReceivedError"></a>onReceivedError</h4><p>æ¥æ”¶ç½‘ç»œé”™è¯¯ï¼Œå…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯åŠ è½½404é¡µé¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, WebResourceRequest request, WebResourceError error)</span> </span>&#123;</div><div class="line">        <span class="comment">//å¦‚æœæ˜¯ä¸»frameçš„è¯å°±æ‰§è¡Œæ–¹æ³•ï¼Œè¦æ˜¯åœ¨å…¶ä»–æ¯”å¦‚iframeså°±ä¼šä¸æ‰§è¡Œ</span></div><div class="line"><span class="keyword">if</span> (request.isForMainFrame()) &#123;</div><div class="line">onReceivedError(view,error.getErrorCode(), rror.getDescription().toString(),request.getUrl().toString());</div><div class="line">&#125;</div><div class="line">    <span class="comment">//å¤„ç†åŠ è½½æœ¬åœ°é”™è¯¯é¡µé¢</span></div><div class="line">    mWebView.loadUrl(<span class="string">"file:///android_asset/http_error.html"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>WebResourceErroråŒ…å«äº†é”™è¯¯ä¿¡æ¯,å…¶ä¸­çš„ErrorCodeå¯¹åº”WebViewClientä¸­çš„å¸¸é‡ERROR_*å¯ä»¥åšå¯¹åº”å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">WebResourceError</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getErrorCode</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> CharSequence <span class="title">getDescription</span><span class="params">()</span></span>;</div><div class="line">    <span class="meta">@SystemApi</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WebResourceError</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="onReceivedSslError"><a href="#onReceivedSslError" class="headerlink" title="onReceivedSslError"></a>onReceivedSslError</h4><p>å¾ˆå¤šå¸–å­éƒ½ä»‹ç»äº†è¿™ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ä¸å¤„ç†SSLé”™è¯¯æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯å¤„ç†httpsçš„è¯·æ±‚æ—¶éªŒè¯å‡ºé”™ï¼Œçœ‹åˆ°çš„å¾ˆå¤šä¾‹å­éƒ½æ˜¯ä»¥ä»¥å‰çš„12306ç½‘ç«™ä¸ºä¾‹ï¼Œä»¥å‰çš„12306æ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œæ‰€ä»¥ç”¨chromeæ‰“å¼€æ—¶ä¼šå‡ºç°è­¦å‘Šï¼Œå¦‚æœç”¨WebViewåŠ è½½è¿™é‡Œå°±ä¼šå›è°ƒonReceivedSslErrorå‡½æ•°ï¼Œç¬”è€…å†™è¿™ç¯‡ç¬”è®°æ—¶12306å·²ç»æ˜¯å…¬å…±è¯ä¹¦äº†ï¼Œä¹Ÿå°±æ²¡æœ‰è¿™ä¸ªé”™è¯¯éªŒè¯äº†ã€‚æš‚æ—¶ä½¿ç”¨è‡ªå·±çš„ç†è§£ä»‹ç»ä¸€ä¸‹ï¼Œä»¥åå‘ç°å¯ç”¨ç½‘ç«™å†éªŒè¯ï¼š</p><p>è¯¥å‡½æ•°çš„é»˜è®¤å®ç°ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedSslError</span><span class="params">(WebView view, SslErrorHandler handler,SslError error)</span> </span>&#123;</div><div class="line">handler.cancel();</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>SslErrorHandler.cancel()å°±æ˜¯ç»“æŸäº†Sslå¤„ç†ï¼Œä¹Ÿå°±ä¸ä¼šç»§ç»­åŠ è½½äº†ï¼Œè¿™é‡Œå­ç±»å¯ä»¥é‡å†™å¤„ç†é€»è¾‘ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedSslError</span><span class="params">(WebView view, SslErrorHandler handler,SslError error)</span> </span>&#123;</div><div class="line">    <span class="comment">//super.onReceivedSslError(view, handler, error);</span></div><div class="line">handler.proceed();</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ”¹å˜äº†SslErrorHandlerçš„å¤„ç†ï¼Œä½¿å…¶èƒ½ç»§ç»­éªŒè¯è¯ä¹¦ï¼Œæ­£å¸¸æ‰“å¼€è¯¥ç½‘é¡µã€‚</p><p><code>éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæœ‰å›è°ƒäº†onReceivedSslErrorï¼Œæ˜¯ä¸ä¼šåŒæ—¶å›è°ƒonReceivedErrorçš„</code></p><p>WebViewClientè¿˜æœ‰å¾ˆå¤šæ²¡æœ‰ä»‹ç»åˆ°çš„æ–¹æ³•ï¼Œæœ‰æœºä¼šè¿˜æ˜¯æ‰¾ä¸€äº›åº”ç”¨åœºæ™¯è¯•éªŒä¸‹å†è¡Œè¡¥å……ï¼Œè¿™ç¯‡æ–‡ç« å…ˆåˆ°è¿™é‡Œå§ï¼Œä¹‹åå†æ€»ç»“ä¸‹å¸¸ç”¨è®¾ç½®å’ŒWebChromeClientç›¸å…³ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> WebView </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>NestedScrollViewåµŒå¥—RecyclerViewæ»‘åŠ¨å†²çª</title>
      <link href="/post/design-clear-of-mines-2/"/>
      <url>/post/design-clear-of-mines-2/</url>
      
        <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>Androidä½¿ç”¨disign ä¸­æ§ä»¶NestedScrollView+RecyclerViewåµŒå¥—æ—¶ä¸Šä¸‹æ»‘åŠ¨ä¼šæœ‰æ˜æ˜¾çš„é˜»å¡æ„Ÿï¼Œæ˜¾ç„¶æ˜¯é‡åˆ°äº†æ»‘åŠ¨å†²çª<br><a id="more"></a><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:fillViewport</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">app:layout_behavior</span>=<span class="string">"@string/appbar_scrolling_view_behavior"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/recycler_view"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_marginTop</span>=<span class="string">"2dp"</span></div><div class="line">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">"@id/space1"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></div></pre></td></tr></table></figure></p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨XMLä¸­ å¯ä»¥å¯¹RecyclerView è®¾ç½® android:nestedScrollingEnabled=â€falseâ€ä¸è¿‡è¿™æ ·åªæ”¯æŒAndroid 21ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œ<br>å¯¹åº”çš„è®¾ç½®RecyclerViewçš„å±æ€§mRecyclerView.setNestedScrollingEnabled(false)ç”±äºæ˜¯supportæ”¯æŒåº“ä¸­çš„æ–¹æ³•å³å¯å…¼å®¹ä½ç‰ˆæœ¬ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é”™è¯¯å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Design </tag>
            
            <tag> error </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>NestedScrollViewåµŒå¥—ViewPager æ˜¾ç¤ºå†²çª</title>
      <link href="/post/design-clear-of-mines-1/"/>
      <url>/post/design-clear-of-mines-1/</url>
      
        <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>Androidä½¿ç”¨disignä¸­è‡ªå¸¦æ§ä»¶CoordinatorLayout+TabLayout+NestedScrollView+ViewPageræ¥å®ç°å¯æŠ˜å å¤´éƒ¨çš„ä¹Ÿå¯æ¨ªä¸‹æ»‘åŠ¨çš„åˆ—è¡¨çš„é¡µé¢<br>NestedScrollViewä¸­åµŒå¥—äº†ViewPageræ¥å±•ç¤ºä¸åŒçš„Tabæ»‘åŠ¨å±•ç¤ºï¼ŒViewPageræ˜¾ç¤ºçš„é«˜åº¦ä¸º0ï¼Œä»AndroidStudioé¢„è§ˆé¡µé¢å³å¯çœ‹åˆ°ã€‚<br><a id="more"></a></p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ä¸ºNestedScrollViewè®¾ç½® android:fillViewport=â€trueâ€ è§£å†³<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:fillViewport</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">app:layout_behavior</span>=<span class="string">"@string/appbar_scrolling_view_behavior"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v4.view.ViewPager</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/viewpager"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></div></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> é”™è¯¯å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Design </tag>
            
            <tag> error </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android Jetpack Architectureä¹‹ViewModel</title>
      <link href="/post/Jetpack-Architecture-ViewModel/"/>
      <url>/post/Jetpack-Architecture-ViewModel/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><br>&ensp;&ensp;Jetpackå·²ç»å‡ºäº†å¾ˆä¹…å¾ˆä¹…äº†ï¼Œè¿‘å‡ å¹´çš„GDDå‡ ä¹æ¯æ¬¡éƒ½ä¼šä»‹ç»æ–°çš„ç»„ä»¶ï¼Œè¯´æ¥æƒ­æ„§ï¼Œä¸€ç›´æ²¡æœ‰å¥½å¥½å­¦ä¹ ï¼Œçœ‹è¿‘å¹´çš„Google çš„å¾ˆå¤šDemoä¸­å…¶å®éƒ½æœ‰æ‰€ä½“ç°ï¼Œä¹‹å‰éƒ½æ˜¯å¤§æ¦‚çš„äº†è§£äº†ä¸€éã€‚æœ€è¿‘å†³å®šï¼Œå¥½å¥½æ¢³ç†ä¸€éï¼Œæ—¢å­¦ä¹ å…¶ç”¨æ³•ï¼Œä¹Ÿå°è¯•å­¦ä¹ ä¸‹å…¶è®¾è®¡æ€æƒ³ã€‚ä¹Ÿæ˜¯æ—¶å€™è¯¥è¡¥å……ä¸€ä¸‹äº†ã€‚è¿›å…¥æ­£é¢˜â€“ViewModel<br><br>&ensp;&ensp;é¦–å…ˆéƒ½æ˜¯çœ‹å®˜æ–¹çš„ä¾‹å­ï¼Œ<a href="https://developer.android.google.cn/topic/libraries/architecture/viewmodel" title="Jetpack-ViewModel" target="_blank" rel="external">ViewModel</a>å®˜æ–¹çš„çš„ä¾‹å­æ˜¯ä¼šå’Œå¦ä¸€ä¸ªæ¶æ„åº“LiveDataå†™åœ¨ä¸€èµ·ï¼Œå¾ˆå¤šçš„åšå®¢ä¹Ÿæ˜¯ç…§å®˜æ–¹çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå¼€å§‹æ¥è§¦æ—¶ç”šè‡³ç»™äº†æˆ‘ä¸€ç§å‡è±¡ï¼šViewModeléƒ½æ˜¯å’ŒLiveDataä¸€èµ·ä½¿ç”¨çš„ã€‚åæ¥é˜…è¯»æ‰äº†è§£ï¼ŒViewModelå’ŒLiveDataèŒè´£åˆ†å·¥è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä½¿ç”¨LiveData Demoä¸»è¦ä½¿ç”¨å…¶observeåŠŸèƒ½ï¼ŒLiveDateçš„ä½¿ç”¨åŠåŸç†ä¹‹åå†åˆ†æï¼Œç”šè‡³åœ¨appcompat-v7:27.1.1ä¸­ç›´æ¥å•ç‹¬é›†æˆäº†ViewModel.æ‰€ä»¥ï¼Œæ•…ä¸ºæ’é™¤å¹²æ‰°ï¼Œä»Šå¤©ä¸ä¼šä½¿ç”¨å®˜æ–¹çš„ä¸»æµDemoç”¨æ³•ï¼Œå…ˆæ¥çœ‹ViewModelã€‚<br><a id="more"></a></p><h1 id="ViewModelç®€ä»‹"><a href="#ViewModelç®€ä»‹" class="headerlink" title="ViewModelç®€ä»‹"></a>ViewModelç®€ä»‹</h1><p><br>&ensp;&ensp;Androidçš„UIæ§åˆ¶å™¨ï¼ˆActivityå’ŒFragmentï¼‰ä»åˆ›å»ºåˆ°é”€æ¯æ‹¥æœ‰è‡ªå·±å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“ç³»ç»Ÿé…ç½®å‘ç”Ÿæ”¹å˜æ—¶ï¼ˆ(Configuration changes)ï¼‰ï¼Œç³»ç»Ÿå°±ä¼šé”€æ¯Activityå’Œä¸ä¹‹å…³è”çš„Fragmentç„¶åå†æ¬¡é‡å»º<font color="#FFA500">ï¼ˆå¯é€šè¿‡åœ¨AndroidManifast.xmlä¸­é…ç½®android:configChangesä¿®æ”¹æŸäº›è¡Œä¸ºï¼Œè¿™é‡Œä¸è®¨è®ºï¼‰</font>,é‚£ä¹ˆå­˜å‚¨åœ¨å½“å‰UIä¸­çš„ä¸´æ—¶æ•°æ®ä¹Ÿä¼šè¢«æ¸…ç©ºï¼Œä¾‹å¦‚ï¼Œç™»é™†è¾“å…¥æ¡†ï¼Œè¾“å…¥è´¦å·æˆ–å¯†ç åæ—‹è½¬å±å¹•ï¼Œè§†å›¾è¢«é‡å»ºï¼Œè¾“å…¥è¿‡çš„æ•°æ®ä¹Ÿæ¸…ç©ºäº†ï¼Œè¿™æ— ç–‘æ˜¯ä¸€ç§ä¸å‹å¥½çš„ç”¨æˆ·ä½“éªŒã€‚å¯¹äºå°‘é‡çš„å¯åºåˆ—åŒ–æ•°æ®å¯ä»¥ä½¿ç”¨onSaveInstanceState()æ–¹æ³•ä¿å­˜ç„¶ååœ¨onCreate()æ–¹æ³•ä¸­é‡æ–°æ¢å¤ï¼Œæ­£å¦‚æ‰€è¯´onSaveInstanceStateå¯¹äºå¤§é‡çš„æ•°æ®ç¼“å­˜æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå¤§é‡çš„æ•°æ®ç¼“å­˜åˆ™å¯ä»¥ä½¿ç”¨<a href="https://developer.android.com/reference/android/support/v4/app/Fragment" title="Fragment-reference" target="_blank" rel="external">Fragment</a>.setRetainInstance(true)æ¥ä¿å­˜æ•°æ®ã€‚ViewModelä¹Ÿæ˜¯æä¾›äº†ç›¸åŒçš„åŠŸèƒ½ï¼Œç”¨æ¥å­˜å‚¨å’Œç®¡ç†ä¸UIç›¸å…³çš„æ•°æ®ï¼Œå…è®¸æ•°æ®åœ¨ç³»ç»Ÿé…ç½®å˜åŒ–åå­˜æ´»ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹è¿™ä¸ªViewModelçš„ç¼“å­˜æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p><h2 id="ViewModelä½¿ç”¨æ–¹å¼"><a href="#ViewModelä½¿ç”¨æ–¹å¼" class="headerlink" title="ViewModelä½¿ç”¨æ–¹å¼"></a>ViewModelä½¿ç”¨æ–¹å¼</h2><p><br>å…ˆä¸Šæ•ˆæœå›¾<br><img src="https://ncmon-blog.oss-cn-beijing.aliyuncs.com/device-2018-09-27-224647_20180927224809.gif" width="300" div="" align="center"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewModel</span> <span class="keyword">extends</span> <span class="title">ViewModel</span> </span>&#123;</div><div class="line">   String name;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCleared</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCleared();</div><div class="line">    name = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p><p>&nbsp;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewModelActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"ViewModelActivity"</span>;</div><div class="line">    TextView textView;</div><div class="line">    <span class="keyword">private</span> MyViewModel myViewModel;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_viewmodel);</div><div class="line">        textView = findViewById(R.id.textView);</div><div class="line">        textView.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        ViewModelProvider.Factory factory = ViewModelProvider.AndroidViewModelFactory.getInstance(getApplication());</div><div class="line"><span class="comment">/*</span></div><div class="line">*è¿™é‡Œçš„thisæ˜¯ViewModelStoreOwneræ¥å£åœ¨appcompat-v7:27.1.1æ”¯æŒåº“ä¸­AppCompatActivityå·²ç»å®ç°äº†ï¼Œ</div><div class="line">*å¦‚æœæ˜¯è¾ƒä½ç‰ˆæœ¬ï¼Œéœ€è¦æ›´æ–°æ”¯æŒåŒ…æˆ–è€…å‚è€ƒå…¶å®ç°å¯¹æœ¬æ¥ç»§æ‰¿çš„Activityåšå¯¹åº”å®ç°ã€‚</div><div class="line">*/</div><div class="line">        ViewModelProvider provider = <span class="keyword">new</span> ViewModelProvider(<span class="keyword">this</span>, factory);<span class="comment">//</span></div><div class="line">        myViewModel = provider.get(MyViewModel.class);</div><div class="line">        Log.e(TAG, <span class="string">"onCreate: "</span> + myViewModel.getName() );</div><div class="line">        <span class="keyword">if</span> (myViewModel.getName() != <span class="keyword">null</span>) &#123;</div><div class="line">            textView.setText(myViewModel.getName());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (v.getId())&#123;</div><div class="line">            <span class="keyword">case</span> R.id.textView:</div><div class="line">                myViewModel.setName(<span class="string">"MyViewModel Test"</span>);</div><div class="line">                textView.setText(myViewModel.getName());</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>&nbsp;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/textView"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_marginStart</span>=<span class="string">"8dp"</span></div><div class="line">        <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span></div><div class="line">        <span class="attr">android:layout_marginEnd</span>=<span class="string">"8dp"</span></div><div class="line">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"8dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"default"</span></div><div class="line">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></div><div class="line">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></div></pre></td></tr></table></figure></p><p>éå¸¸ç®€å•çš„ä¸€ä¸ªä¾‹å­ï¼Œè¿™å°±æ˜¯ViewModelæœ€ç®€å•çš„ä½¿ç”¨äº†ï¼Œå°±æ˜¯TextViewä¸­æ˜¾ç¤ºViewModelçš„æ•°æ®ã€‚ViewModeléœ€è¦ç”±ViewModelProvider.get(Class<t>)æ¥å–å¾—ï¼Œæ—‹è½¬å±å¹•é”€æ¯åï¼Œä¹‹å‰æ”¹å˜çš„æ•°æ®è¿˜åœ¨ã€‚<br>æ¥ä¸‹æ¥å°±æ˜¯è¿›å…¥ä¸»é¢˜åˆ†æä¸‹ViewModelåˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ<br>å¸¦ç€é—®é¢˜çœ‹æºç ï¼š  </t></p><h1 id="å¸¦ç»™æˆ‘ä»¬çš„ç–‘é—®"><a href="#å¸¦ç»™æˆ‘ä»¬çš„ç–‘é—®" class="headerlink" title="å¸¦ç»™æˆ‘ä»¬çš„ç–‘é—®"></a>å¸¦ç»™æˆ‘ä»¬çš„ç–‘é—®</h1><ul><li>ViewModelProvideræ˜¯å¹²å•¥çš„ï¼Ÿ</li><li>AndroidViewModelFactory è¿™å‘½åä¸€çœ‹å°±æ˜¯åº”è¯¥æ˜¯å·¥å‚æ¨¡å¼ï¼Œå·¥å‚åˆ›å»ºäº†ä»€ä¹ˆï¼Ÿ</li><li>provider.get(MyViewModel.class) è¿™é‡Œç›´æ¥ä½¿ç”¨çš„getå‘½åå°±å¾—åˆ°äº†éœ€è¦çš„å”¯ä¸€æ•°æ®</li><li>æ³¨é‡Šä¸­ViewModelStoreOwneråˆæ˜¯ä»€ä¹ˆè§’è‰²ï¼Ÿ<br>å…ˆçœ‹ViewModelç±»ï¼Œæ²¡ä»€ä¹ˆè¯´çš„ï¼Œå°±æ˜¯ä¸€ä¸ªä¹ˆæœ‰ä»»ä½•çœŸæ­£å®ç°çš„æŠ½è±¡ç±»ï¼Œåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•onCleared()</li></ul><h1 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewModel</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * This method will be called when this ViewModel is no longer used and will be destroyed.</div><div class="line">     * &lt;p&gt;</div><div class="line">     * It is useful when ViewModel observes some data and you need to clear this subscription to</div><div class="line">     * prevent a leak of this ViewModel.</div><div class="line">     */</div><div class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"WeakerAccess"</span>)</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCleared</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ¥ç€çœ‹ä¸‹ViewModelFactoryï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åˆ¶é€ ViewModelçš„ã€‚<br>AndroidViewModelFactoryçš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹:</p><blockquote><p>android.arch.lifecycle.ViewModelProvider.Factory</p><blockquote><p>android.arch.lifecycle.ViewModelProvider.NewInstanceFactory</p><blockquote><p>android.arch.lifecycle.ViewModelProvider.AndroidViewModelFactory</p></blockquote></blockquote></blockquote><p>Factoryæ˜¯ä¸€ä¸ªåªåŒ…å«ä¸€ä¸ªcreateçš„interfaceï¼ŒNewInstanceFactoryå®ç°äº†è¯¥æ–¹æ³•ä¼ å…¥Class<t>ä¼šåˆ©ç”¨ViewModelçš„é»˜è®¤æ— å‚æ„é€ å™¨åˆ›å»ºä¸€ä¸ªå¯¹åº”ViewModelçš„å®ä¾‹ï¼Œè€ŒAndroidViewModelFactoryå¢åŠ äº†ä¸€ä¸ªå±æ€§å°±æ˜¯åº”ç”¨çš„Applicaion,åŒæ—¶é‡å†™createæ–¹æ³•ï¼ŒæŸ¥çœ‹ViewModelæ˜¯å¦æœ‰åŒ…å«Applicaionå‚æ•°çš„æ„é€ æ–¹æ³•ä»è€Œä½¿ç”¨ï¼Œå¯¹åº”çš„å…¶å®è¿˜æœ‰ä¸€ä¸ªAndroidViewModelæ˜¯ViewModelçš„å­ç±»ï¼Œé»˜è®¤å·²ç»å®ç°äº†å¸¦æœ‰Applicationå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œéœ€è¦ä½¿ç”¨åœ¨ViewModelä¸­ä½¿ç”¨applicationçš„ç›´æ¥ç»§æ‰¿AndroidViewModelå°±å¯ä»¥ï¼Œçœ‹åˆ°è¿™é‡Œå…¶å®æœ€ä¸Šé¢çš„ä¾‹å­æœ‰ä¸ªä¸æ˜¯é—®é¢˜çš„é—®é¢˜ï¼Œå…¶å®ä¸Šé¢çš„Factoryç›´æ¥ä½¿ç”¨NewInstanceFactoryå°±å¯ä»¥åˆ›å»ºå‡ºå¯¹åº”çš„ViewModelå®ä¾‹äº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Implementations of &#123;<span class="doctag">@code</span> Factory&#125; interface are responsible to instantiate ViewModels.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Creates a new instance of the given &#123;<span class="doctag">@code</span> Class&#125;.</div><div class="line">     * &lt;p&gt;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> modelClass a &#123;<span class="doctag">@code</span> Class&#125; whose instance is requested</div><div class="line">     * <span class="doctag">@param</span> &lt;T&gt;        The type parameter for the ViewModel.</div><div class="line">     * <span class="doctag">@return</span> a newly created ViewModel</div><div class="line">     */</div><div class="line">    <span class="meta">@NonNull</span></div><div class="line">    &lt;T extends ViewModel&gt; <span class="function">T <span class="title">create</span><span class="params">(@NonNull Class&lt;T&gt; modelClass)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></t></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Simple factory, which calls empty constructor on the give class.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NewInstanceFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"ClassNewInstance"</span>)</div><div class="line">    <span class="meta">@NonNull</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> &lt;T extends ViewModel&gt; <span class="function">T <span class="title">create</span><span class="params">(@NonNull Class&lt;T&gt; modelClass)</span> </span>&#123;</div><div class="line">        <span class="comment">//noinspection TryWithIdenticalCatches</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> modelClass.newInstance();</div><div class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Cannot create an instance of "</span> + modelClass, e);</div><div class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Cannot create an instance of "</span> + modelClass, e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * &#123;<span class="doctag">@link</span> Factory&#125; which may create &#123;<span class="doctag">@link</span> AndroidViewModel&#125; and</div><div class="line"> * &#123;<span class="doctag">@link</span> ViewModel&#125;, which have an empty constructor.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AndroidViewModelFactory</span> <span class="keyword">extends</span> <span class="title">ViewModelProvider</span>.<span class="title">NewInstanceFactory</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AndroidViewModelFactory sInstance;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Retrieve a singleton instance of AndroidViewModelFactory.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> application an application to pass in &#123;<span class="doctag">@link</span> AndroidViewModel&#125;</div><div class="line">     * <span class="doctag">@return</span> A valid &#123;<span class="doctag">@link</span> AndroidViewModelFactory&#125;</div><div class="line">     */</div><div class="line">    <span class="meta">@NonNull</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AndroidViewModelFactory <span class="title">getInstance</span><span class="params">(@NonNull Application application)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</div><div class="line">            sInstance = <span class="keyword">new</span> AndroidViewModelFactory(application);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sInstance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Application mApplication;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Creates a &#123;<span class="doctag">@code</span> AndroidViewModelFactory&#125;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> application an application to pass in &#123;<span class="doctag">@link</span> AndroidViewModel&#125;</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AndroidViewModelFactory</span><span class="params">(@NonNull Application application)</span> </span>&#123;</div><div class="line">        mApplication = application;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@NonNull</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> &lt;T extends ViewModel&gt; <span class="function">T <span class="title">create</span><span class="params">(@NonNull Class&lt;T&gt; modelClass)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (AndroidViewModel.class.isAssignableFrom(modelClass)) &#123;</div><div class="line">            <span class="comment">//noinspection TryWithIdenticalCatches</span></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">return</span> modelClass.getConstructor(Application.class).newInstance(mApplication);</div><div class="line">            &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Cannot create an instance of "</span> + modelClass, e);</div><div class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Cannot create an instance of "</span> + modelClass, e);</div><div class="line">            &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Cannot create an instance of "</span> + modelClass, e);</div><div class="line">            &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Cannot create an instance of "</span> + modelClass, e);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.create(modelClass);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä¹‹åé€šè¿‡ViewModelStoreOwnerå’Œåˆšåˆšåˆ›å»ºçš„Factoryåˆ›å»ºå‡ºViewModelPrividerå®ä¾‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates &#123;<span class="doctag">@code</span> ViewModelProvider&#125;, which will create &#123;<span class="doctag">@code</span> ViewModels&#125; via the given</div><div class="line"> * &#123;<span class="doctag">@code</span> Factory&#125; and retain them in a store of the given &#123;<span class="doctag">@code</span> ViewModelStoreOwner&#125;.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> owner   a &#123;<span class="doctag">@code</span> ViewModelStoreOwner&#125; whose &#123;<span class="doctag">@link</span> ViewModelStore&#125; will be used to</div><div class="line"> *                retain &#123;<span class="doctag">@code</span> ViewModels&#125;</div><div class="line"> * <span class="doctag">@param</span> factory a &#123;<span class="doctag">@code</span> Factory&#125; which will be used to instantiate</div><div class="line"> *                new &#123;<span class="doctag">@code</span> ViewModels&#125;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ViewModelProvider</span><span class="params">(@NonNull ViewModelStoreOwner owner, @NonNull Factory factory)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(owner.getViewModelStore(), factory);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates &#123;<span class="doctag">@code</span> ViewModelProvider&#125;, which will create &#123;<span class="doctag">@code</span> ViewModels&#125; via the given</div><div class="line"> * &#123;<span class="doctag">@code</span> Factory&#125; and retain them in the given &#123;<span class="doctag">@code</span> store&#125;.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> store   &#123;<span class="doctag">@code</span> ViewModelStore&#125; where ViewModels will be stored.</div><div class="line"> * <span class="doctag">@param</span> factory factory a &#123;<span class="doctag">@code</span> Factory&#125; which will be used to instantiate</div><div class="line"> *                new &#123;<span class="doctag">@code</span> ViewModels&#125;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ViewModelProvider</span><span class="params">(@NonNull ViewModelStore store, @NonNull Factory factory)</span> </span>&#123;</div><div class="line">    mFactory = factory;</div><div class="line">    <span class="keyword">this</span>.mViewModelStore = store;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * A scope that owns &#123;<span class="doctag">@link</span> ViewModelStore&#125;.</div><div class="line"> * &lt;p&gt;</div><div class="line"> * A responsibility of an implementation of this interface is to retain owned ViewModelStore</div><div class="line"> * during the configuration changes and call &#123;<span class="doctag">@link</span> ViewModelStore#clear()&#125;, when this scope is</div><div class="line"> * going to be destroyed.</div><div class="line"> */</div><div class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"WeakerAccess"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ViewModelStoreOwner</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns owned &#123;<span class="doctag">@link</span> ViewModelStore&#125;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> a &#123;<span class="doctag">@code</span> ViewModelStore&#125;</div><div class="line">     */</div><div class="line">    <span class="meta">@NonNull</span></div><div class="line">    <span class="function">ViewModelStore <span class="title">getViewModelStore</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ViewModelStoreOwner ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£æ˜¯FragmentActivityå®ç°äº†è¯¥æ¥å£å¹¶å®ç°äº†å…¶ä¸­çš„getViewModelStore()æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FragmentActivity</span> <span class="keyword">extends</span> <span class="title">BaseFragmentActivityApi16</span> <span class="keyword">implements</span></span></div><div class="line">        <span class="title">ViewModelStoreOwner</span>...&#123;</div><div class="line">    <span class="keyword">private</span> ViewModelStore mViewModelStore;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        mFragments.attachHost(<span class="keyword">null</span> <span class="comment">/*parent*/</span>);</div><div class="line"></div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">        NonConfigurationInstances nc =</div><div class="line">                (NonConfigurationInstances) getLastNonConfigurationInstance();</div><div class="line">        <span class="keyword">if</span> (nc != <span class="keyword">null</span>) &#123;</div><div class="line">            mViewModelStore = nc.viewModelStore;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the &#123;<span class="doctag">@link</span> ViewModelStore&#125; associated with this activity</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> a &#123;<span class="doctag">@code</span> ViewModelStore&#125;</div><div class="line">     */</div><div class="line">    <span class="meta">@NonNull</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ViewModelStore <span class="title">getViewModelStore</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (getApplication() == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Your activity is not yet attached to the "</span></div><div class="line">                    + <span class="string">"Application instance. You can't request ViewModel before onCreate call."</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (mViewModelStore == <span class="keyword">null</span>) &#123;</div><div class="line">            mViewModelStore = <span class="keyword">new</span> ViewModelStore();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> mViewModelStore;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>è¿™ä¸ªViewModelStoreåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Œå…¶å®å°±æ˜¯çœŸæ­£åˆ©ç”¨HashMapå­˜å‚¨ViewModelçš„åœ°æ–¹äº†ï¼Œçœ‹ä¸‹ä»£ç åœ¨å­˜å‚¨å’ŒclearåŒæ—¶ä¼šè°ƒç”¨ViewModeléœ€è¦å®ç°çš„æŠ½è±¡æ–¹æ³•onClear()<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewModelStore</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;String, ViewModel&gt; mMap = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, ViewModel viewModel)</span> </span>&#123;</div><div class="line">        ViewModel oldViewModel = mMap.put(key, viewModel);</div><div class="line">        <span class="keyword">if</span> (oldViewModel != <span class="keyword">null</span>) &#123;</div><div class="line">            oldViewModel.onCleared();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">final</span> ViewModel <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mMap.get(key);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     *  Clears internal storage and notifies ViewModels that they are no longer used.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (ViewModel vm : mMap.values()) &#123;</div><div class="line">            vm.onCleared();</div><div class="line">        &#125;</div><div class="line">        mMap.clear();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>è¿™æ ·ViewModelProviderå°±æ˜¯æœ‰äº†ä¸€ä¸ªViewModelçš„å®¹å™¨ï¼Œè¿™æ—¶å»è°ƒç”¨ViewModelProviderçš„get(Class<t>)æ–¹æ³•å°±æ˜¯å»è°ƒç”¨mViewModelStore<br>çš„get()æ–¹æ³•å–å‡ºå¯¹åº”çš„ViewModelæ‰€ä»¥è¿™é‡Œåªè¦æŒæœ‰çš„ViewModelStoreæ˜¯æœ‰ç¼“å­˜çš„ï¼Œé‚£ä¹ˆå–å‡ºçš„ViewModelå°±æ˜¯ç›¸åŒçš„ç¼“å­˜äº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Returns an existing ViewModel or creates a new one in the scope (usually, a fragment or</div><div class="line"> * an activity), associated with this &#123;<span class="doctag">@code</span> ViewModelProvider&#125;.</div><div class="line"> * &lt;p&gt;</div><div class="line"> * The created ViewModel is associated with the given scope and will be retained</div><div class="line"> * as long as the scope is alive (e.g. if it is an activity, until it is</div><div class="line"> * finished or process is killed).</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> modelClass The class of the ViewModel to create an instance of it if it is not</div><div class="line"> *                   present.</div><div class="line"> * <span class="doctag">@param</span> &lt;T&gt;        The type parameter for the ViewModel.</div><div class="line"> * <span class="doctag">@return</span> A ViewModel that is an instance of the given type &#123;<span class="doctag">@code</span> T&#125;.</div><div class="line"> */</div><div class="line"><span class="meta">@NonNull</span></div><div class="line"><span class="meta">@MainThread</span></div><div class="line"><span class="keyword">public</span> &lt;T extends ViewModel&gt; <span class="function">T <span class="title">get</span><span class="params">(@NonNull Class&lt;T&gt; modelClass)</span> </span>&#123;</div><div class="line">    String canonicalName = modelClass.getCanonicalName();</div><div class="line">    <span class="keyword">if</span> (canonicalName == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Local and anonymous classes can not be ViewModels"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> get(DEFAULT_KEY + <span class="string">":"</span> + canonicalName, modelClass);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@NonNull</span></div><div class="line"><span class="meta">@MainThread</span></div><div class="line"><span class="keyword">public</span> &lt;T extends ViewModel&gt; <span class="function">T <span class="title">get</span><span class="params">(@NonNull String key, @NonNull Class&lt;T&gt; modelClass)</span> </span>&#123;</div><div class="line">    ViewModel viewModel = mViewModelStore.get(key);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (modelClass.isInstance(viewModel)) &#123;</div><div class="line">        <span class="comment">//noinspection unchecked</span></div><div class="line">        <span class="keyword">return</span> (T) viewModel;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">//noinspection StatementWithEmptyBody</span></div><div class="line">        <span class="keyword">if</span> (viewModel != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// <span class="doctag">TODO:</span> log a warning.</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    viewModel = mFactory.create(modelClass);</div><div class="line">    mViewModelStore.put(key, viewModel);</div><div class="line">    <span class="comment">//noinspection unchecked</span></div><div class="line">    <span class="keyword">return</span> (T) viewModel;</div><div class="line">&#125;</div></pre></td></tr></table></figure></t></p><p>çœ‹åˆ°è¿™é‡Œå°±ä¼šå‘ç°ViewModelStoreçš„ç¼“å­˜å…¶å®æ˜¯é€šè¿‡NonConfigurationInstancesçš„ç¼“å­˜æ¥å®ç°çš„ï¼Œè¿™æ ·å°±å®Œæˆäº†Activityé”€æ¯é‡å»ºåViewModelè¿˜ä¿å­˜åŸæ¥çš„æ•°æ®çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆNonConfigurationInstances æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæœ‰äº†è§£è¿‡ä½¿ç”¨åœ¨Activityä¸­ä½¿ç”¨onRetainNonConfigurationInstance()ä¿å­˜ç¼“å­˜æ•°æ®ï¼Œåœ¨onCreate()ä¸­é€šè¿‡getLastNonConfigurationInstance()æ¢å¤ä¹‹å‰çš„æ•°æ®çŠ¶æ€çš„åŒå­¦å¯èƒ½ä¼šå¾ˆç†Ÿæ‚‰è¿™é‡Œçš„å†™æ³•ï¼Œæ˜¯çš„ï¼Œè¿™é‡ŒFragmentActivityå°±æ˜¯ä½¿ç”¨çš„è¿™ç§æ–¹å¼æ¥ä¿å­˜ä¹‹å‰çš„ViewModelStore,çœ‹ä¸‹FragmentActivityçš„onRetainNonConfigurationInstance()æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Retain all appropriate fragment state.  You can NOT</div><div class="line"> * override this yourself!  Use &#123;<span class="doctag">@link</span> #onRetainCustomNonConfigurationInstance()&#125;</div><div class="line"> * if you want to retain your own state.</div><div class="line"> */</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title">onRetainNonConfigurationInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mStopped) &#123;</div><div class="line">        doReallyStop(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Object custom = onRetainCustomNonConfigurationInstance();</div><div class="line"></div><div class="line">    FragmentManagerNonConfig fragments = mFragments.retainNestedNonConfig();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (fragments == <span class="keyword">null</span> &amp;&amp; mViewModelStore == <span class="keyword">null</span> &amp;&amp; custom == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NonConfigurationInstances nci = <span class="keyword">new</span> NonConfigurationInstances();</div><div class="line">    nci.custom = custom;</div><div class="line">    nci.viewModelStore = mViewModelStore;<span class="comment">//å°±æ˜¯è¿™é‡Œäº†ï¼Œä¼šæŠŠä¹‹å‰çš„VeiwmodelStroeå­˜å‚¨åˆ°NonConfigurationInstancesä¸­ä»¥ä¾›åç»­æ¢å¤ä½¿ç”¨</span></div><div class="line">    nci.fragments = fragments;</div><div class="line">    <span class="keyword">return</span> nci;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>è¿™é‡Œå…¶å®å†æ¬¡å‡ºç°äº†ä¸€ä¸ªé—®é¢˜  onRetainNonConfigurationInstance()å’ŒgetLastNonConfigurationInstance()åˆæ˜¯æ€ä¹ˆæ¢å¤æ•°æ®å‘¢?â€¦è¿™ä¸ªå…¶å®å’ŒActivityçš„å¯åŠ¨æµç¨‹ç›¸å…³ï¼Œè¿™é‡Œä¹Ÿä»‹ç»ä¸€ä¸‹å§ï¼Œä¹‹åçš„å†…å®¹å…¶å®æ˜¯Activityçš„å†…å®¹äº†ï¼Œè¶è¿™æ¬¡çœ‹ViwModelä¹Ÿè·Ÿç€çœ‹äº†ä¸€éï¼Œæœ‰äº†è§£è¿‡Activityå¯åŠ¨æµç¨‹çš„åŒå­¦æ›´å®¹æ˜“ç†è§£çš„å¤šï¼Œå¤§å®¶é…Œæƒ…è§‚çœ‹ã€‚</p><p>ä¹Ÿä¸èƒ½ä»å¤´å¼€å§‹è¯´èµ·ï¼Œå†ä»å¤´å°±è¦è¶Šæ‰¯è¶Šè¿œäº†ï¼Œå°±ä»ActivityThread.javaä¸­çš„scheduleLaunchActivityå¼€å§‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">scheduleLaunchActivity</span><span class="params">(Intent intent, IBinder token, <span class="keyword">int</span> ident,</span></span></div><div class="line">        ActivityInfo info, Configuration curConfig, Configuration overrideConfig,</div><div class="line">        CompatibilityInfo compatInfo, String referrer, IVoiceInteractor voiceInteractor,</div><div class="line">        <span class="keyword">int</span> procState, Bundle state, PersistableBundle persistentState,</div><div class="line">        List&lt;ResultInfo&gt; pendingResults, List&lt;ReferrerIntent&gt; pendingNewIntents,</div><div class="line">        <span class="keyword">boolean</span> notResumed, <span class="keyword">boolean</span> isForward, ProfilerInfo profilerInfo) &#123;</div><div class="line"></div><div class="line">    updateProcessState(procState, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">    ActivityClientRecord r = <span class="keyword">new</span> ActivityClientRecord();</div><div class="line"></div><div class="line">    r.token = token;</div><div class="line">    r.ident = ident;</div><div class="line">    r.intent = intent;</div><div class="line">    r.referrer = referrer;</div><div class="line">    r.voiceInteractor = voiceInteractor;</div><div class="line">    r.activityInfo = info;</div><div class="line">    r.compatInfo = compatInfo;</div><div class="line">    r.state = state;</div><div class="line">    r.persistentState = persistentState;</div><div class="line"></div><div class="line">    r.pendingResults = pendingResults;</div><div class="line">    r.pendingIntents = pendingNewIntents;</div><div class="line"></div><div class="line">    r.startsNotResumed = notResumed;</div><div class="line">    r.isForward = isForward;</div><div class="line"></div><div class="line">    r.profilerInfo = profilerInfo;</div><div class="line"></div><div class="line">    r.overrideConfig = overrideConfig;</div><div class="line">    updatePendingConfiguration(curConfig);</div><div class="line"></div><div class="line">    sendMessage(H.LAUNCH_ACTIVITY, r);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>ä»ActivityThread.javaä¸­Hï¼ˆextents Handlerï¼‰æ¥æ”¶åˆ°LAUNCH_ACTIVITYï¼Œå¹¶ä¸”ä¼šæ¥æ”¶ActivityClientRecordï¼Œå…¶ä¸­ä¼šè°ƒç”¨ActivityThreadçš„handleLaunchActivityæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ActivityThread.java</span></div><div class="line"><span class="comment">//æ²¡æœ‰å‰åæ–‡çš„Hä¸­çš„handleMessage~~~</span></div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">           <span class="keyword">if</span> (DEBUG_MESSAGES) Slog.v(TAG, <span class="string">"&gt;&gt;&gt; handling: "</span> + codeToString(msg.what));</div><div class="line">           <span class="keyword">switch</span> (msg.what) &#123;</div><div class="line">               <span class="keyword">case</span> LAUNCH_ACTIVITY: &#123;</div><div class="line">                   Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityStart"</span>);</div><div class="line">                   <span class="keyword">final</span> ActivityClientRecord r = (ActivityClientRecord) msg.obj;</div><div class="line"><span class="comment">//ActivityClientRecord æ˜¯apkè¿›ç¨‹ä¸­ä¸€ä¸ªActivityçš„ä»£è¡¨ï¼Œè¿™ä¸ªå¯¹è±¡çš„activityæˆå‘˜å¼•ç”¨çœŸæ­£çš„Activityç»„ä»¶,åé¢çš„éƒ½å’Œå®ƒæœ‰å…³ç³»</span></div><div class="line">                   r.packageInfo = getPackageInfoNoCheck(</div><div class="line">                           r.activityInfo.applicationInfo, r.compatInfo);</div><div class="line">                   handleLaunchActivity(r, <span class="keyword">null</span>, <span class="string">"LAUNCH_ACTIVITY"</span>);<span class="comment">///è¿™é‡Œ~è¿™é‡Œ~</span></div><div class="line">                   Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">               &#125; <span class="keyword">break</span>;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleLaunchActivity</span><span class="params">(ActivityClientRecord r, Intent customIntent, String reason)</span> </span>&#123;</div><div class="line">        ...</div><div class="line">        Activity a = performLaunchActivity(r, customIntent);</div><div class="line"> ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> Activity <span class="title">performLaunchActivity</span><span class="params">(ActivityClientRecord r, Intent customIntent)</span> </span>&#123;</div><div class="line">...</div><div class="line">    <span class="keyword">if</span> (activity != <span class="keyword">null</span>) &#123;</div><div class="line">            CharSequence title = r.activityInfo.loadLabel(appContext.getPackageManager());</div><div class="line">            Configuration config = <span class="keyword">new</span> Configuration(mCompatConfiguration);</div><div class="line">            <span class="keyword">if</span> (r.overrideConfig != <span class="keyword">null</span>) &#123;</div><div class="line">                config.updateFrom(r.overrideConfig);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (DEBUG_CONFIGURATION) Slog.v(TAG, <span class="string">"Launching activity "</span></div><div class="line">                    + r.activityInfo.name + <span class="string">" with config "</span> + config);</div><div class="line">            Window window = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">if</span> (r.mPendingRemoveWindow != <span class="keyword">null</span> &amp;&amp; r.mPreserveWindow) &#123;</div><div class="line">                window = r.mPendingRemoveWindow;</div><div class="line">                r.mPendingRemoveWindow = <span class="keyword">null</span>;</div><div class="line">                r.mPendingRemoveWindowManager = <span class="keyword">null</span>;</div><div class="line">            &#125;</div><div class="line">            appContext.setOuterContext(activity);</div><div class="line">            activity.attach(appContext, <span class="keyword">this</span>, getInstrumentation(), r.token,</div><div class="line">                    r.ident, app, r.intent, r.activityInfo, title, r.parent,</div><div class="line">                    r.embeddedID, r.lastNonConfigurationInstances, config, <span class="comment">//çœ‹åˆ°è¿™ä¸ªr.lastNonConfigurationInstances å°±æ˜¯åœ¨Activityæ–¹æ³•ä¸­è°ƒç”¨getLastNonConfigurationInstance()è·å–åˆ°çš„Objectäº†ã€‚</span></div><div class="line">                    r.referrer, r.voiceInteractor, window, r.configCallback);</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ³¨é‡Šä¸­çš„åœ°æ–¹å°±æ˜¯lastNonConfigurationInstancesçš„èµ‹å€¼çš„åœ°æ–¹ï¼Œå¯èƒ½ä¼šå‘ç°åœ¨scheduleLaunchActivityå¹¶æ²¡æœ‰å¯¹lastNonConfigurationInstancesèµ‹å€¼ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡å¯åŠ¨Activityæ—¶ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯nullçš„ï¼Œé‚£ä¹ˆèµ‹å€¼çš„åœ°æ–¹åœ¨å“ªé‡Œå‘¢ï¼Œæ—¢ç„¶æ˜¯é”€æ¯åä¼šæ¢å¤æ•°æ®ï¼Œè¿½è¸ªå‘ç°åœ¨performDestroyActivity()ä¹Ÿå°±æ˜¯åœ¨è°ƒç”¨onDestroyç”Ÿå‘½å‘¨æœŸä¹‹å‰æœ‰è¿™æ ·ä¸€æ®µä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> ActivityClientRecord <span class="title">performDestroyActivity</span><span class="params">(IBinder token, <span class="keyword">boolean</span> finishing,</span></span></div><div class="line">            <span class="keyword">int</span> configChanges, <span class="keyword">boolean</span> getNonConfigInstance) &#123;</div><div class="line">        ActivityClientRecord r = mActivities.get(token);</div><div class="line">        ...æ— å…³ä»£ç çœç•¥</div><div class="line">            <span class="keyword">if</span> (getNonConfigInstance) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    r.lastNonConfigurationInstances</div><div class="line">                            = r.activity.retainNonConfigurationInstances();<span class="comment">///å°±æ˜¯è¿™é‡Œå‡ºç°äº†æƒ³è¦æ‰¾çš„NonConfigurationInstances</span></div><div class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                    <span class="keyword">if</span> (!mInstrumentation.onException(r.activity, e)) &#123;</div><div class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">                                <span class="string">"Unable to retain activity "</span></div><div class="line">                                + r.intent.getComponent().toShortString()</div><div class="line">                                + <span class="string">": "</span> + e.toString(), e);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                r.activity.mCalled = <span class="keyword">false</span>;</div><div class="line">                mInstrumentation.callActivityOnDestroy(r.activity);</div><div class="line">...æ— å…³ä»£ç çœç•¥</div><div class="line">        <span class="keyword">return</span> r;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p><p>åœ¨performDestroyActivity()è°ƒç”¨äº†Activity.retainNonConfigurationInstances()æ–¹æ³•äº†ï¼Œæ‰€ä»¥é€»è¾‘åˆ‡æ¢å›Activityä¸­â€¦<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/**</span></div><div class="line"> * This method is similar to &#123;<span class="doctag">@link</span> #onRetainNonConfigurationInstance()&#125; except that</div><div class="line"> * it should return either a mapping from  child activity id strings to arbitrary objects,</div><div class="line"> * or null.  This method is intended to be used by Activity framework subclasses that control a</div><div class="line"> * set of child activities, such as ActivityGroup.  The same guarantees and restrictions apply</div><div class="line"> * as for &#123;<span class="doctag">@link</span> #onRetainNonConfigurationInstance()&#125;.  The default implementation returns null.</div><div class="line"> */</div><div class="line"><span class="meta">@Nullable</span></div><div class="line"><span class="function">HashMap&lt;String,Object&gt; <span class="title">onRetainNonConfigurationChildInstances</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">NonConfigurationInstances <span class="title">retainNonConfigurationInstances</span><span class="params">()</span> </span>&#123;</div><div class="line">    Object activity = onRetainNonConfigurationInstance();<span class="comment">///ç†Ÿæ‚‰çš„ä»£ç ï¼ŒåŸæ¥çš„é…æ–¹ï¼Œå’Œåˆ†æActivityThreadä¹‹å‰è”ç³»èµ·æ¥äº†ï¼Œåœ¨Activityä¸­æ˜¯ç©ºå®ç°ï¼Œè¿™é‡Œå°±æ˜¯è·å–å­ç±»çš„NonConfigurationInstance()ï¼Œä¹‹å‰çš„ä¾‹å­å°±æ˜¯çš„å¾—FragmentActivityä¸­çš„å…·ä½“å®ç°ï¼Œä¸Šæ–‡ä¸­å·²ç»åœ¨åˆ†æActivityThread.javaå·²ç»æŒ‡å‡ºã€‚</span></div><div class="line">    HashMap&lt;String, Object&gt; children = onRetainNonConfigurationChildInstances();</div><div class="line">    FragmentManagerNonConfig fragments = mFragments.retainNestedNonConfig();</div><div class="line"></div><div class="line">    <span class="comment">// We're already stopped but we've been asked to retain.</span></div><div class="line">    <span class="comment">// Our fragments are taken care of but we need to mark the loaders for retention.</span></div><div class="line">    <span class="comment">// In order to do this correctly we need to restart the loaders first before</span></div><div class="line">    <span class="comment">// handing them off to the next activity.</span></div><div class="line">    mFragments.doLoaderStart();</div><div class="line">    mFragments.doLoaderStop(<span class="keyword">true</span>);</div><div class="line">    ArrayMap&lt;String, LoaderManager&gt; loaders = mFragments.retainLoaderNonConfig();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (activity == <span class="keyword">null</span> &amp;&amp; children == <span class="keyword">null</span> &amp;&amp; fragments == <span class="keyword">null</span> &amp;&amp; loaders == <span class="keyword">null</span></div><div class="line">            &amp;&amp; mVoiceInteractor == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NonConfigurationInstances nci = <span class="keyword">new</span> NonConfigurationInstances();</div><div class="line">    nci.activity = activity;</div><div class="line">    nci.children = children;</div><div class="line">    nci.fragments = fragments;</div><div class="line">    nci.loaders = loaders;</div><div class="line">    <span class="keyword">if</span> (mVoiceInteractor != <span class="keyword">null</span>) &#123;</div><div class="line">        mVoiceInteractor.retainInstance();</div><div class="line">        nci.voiceInteractor = mVoiceInteractor;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> nci;<span class="comment">//è¿™é‡Œè¿”å›çš„æ˜¯Activityä¸­çš„NonConfigurationInstanceså°±ä¿å­˜åœ¨äº†ActivityClientRecordä¸­äº†</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>è‡³æ­¤ï¼ŒActivityClientRecordå°±ä¸å†æ·±å…¥äº†ï¼Œå¯ä»¥çœ‹åˆ°åœ¨Activityä¸­æ˜¯ä»¥ä¸€ä¸ªArrayMapæ¥ä¿å­˜Activityçš„è®°å½•ï¼Œè®°å½•çš„å°±æ˜¯Activityçš„çŠ¶æ€ï¼Œæ‰€ä»¥è¿™é‡Œå°±å®ç°äº†å¯¹NonConfigurationInstancesçš„ä¿å­˜ã€‚</p><hr><p><strong>ç»“è¯­ï¼šè‡³æ­¤å°±åŸºæœ¬çœ‹å®Œäº†ViewModelåœ¨Activityä¸­çš„ä½¿ç”¨å’ŒåŸç†ï¼Œåœ¨Fragmentä¸­çš„å®ç°ä¸»è¦æ˜¯ä½¿ç”¨setRetainInstance(true)çš„æ–¹å¼å»ä¿å­˜ï¼Œè·Ÿä»Šå¤©çš„åˆ†æä¹Ÿæœ‰å…³è”ï¼Œåˆ†ææºç çš„è¿‡ç¨‹æ€»æ˜¯çœ‹ç€å°±æœ‰æ–°çš„é—®é¢˜ï¼Œå†æ¬¡å¸¦ç€é—®é¢˜å»è§£å†³ä¼šå†æ¬¡æœ‰ä¸åŒçš„æ”¶è·ï¼Œæœ¬æ–‡çš„ç†è§£ä¹Ÿå¯èƒ½æœ‰åå·®ï¼Œå¦‚æœ‰é”™è¯¯å’Œæƒ³è¦äº¤æµçš„ä¹Ÿæ¬¢è¿æŒ‡æ­£æ²Ÿé€šã€‚</strong>  </p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Jetpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ubuntuæ­å»ºNginxå›¾ç‰‡æœåŠ¡å™¨</title>
      <link href="/post/build-an-image-server/"/>
      <url>/post/build-an-image-server/</url>
      
        <content type="html"><![CDATA[<p>ä¹Ÿè®¸ç®—ä½œæ˜¯å»ºç«™ä»¥æ¥çš„ç¬¬ä¸€ç¯‡çœŸæ­£æ„ä¹‰ä¸Šçš„æ€»ç»“åšå®¢ã€‚  </p><p>é¦–å…ˆæ„Ÿè°¢å¼€æºæœ¬ä¸»é¢˜çš„vioseyåŒå­¦å’Œè¾›è‹¦ç»´æŠ¤æœ¬ä¸»é¢˜çš„neoFelhzåŒå­¦ï¼Œå¯¹æ­¤ä¸»é¢˜æä¸ºå–œæ¬¢ã€‚</p><p>æ–°å‘ç°äº†å½“å‰çš„è¿™ä¸ªMeterialä¸»é¢˜åå‘ç°å±…ç„¶æœ‰ä¸€ä¸ªGalleryæ¨¡æ¿å¯ä»¥å±•ç¤ºç…§ç‰‡ï¼Œå¹³æ—¶çš„åšå®¢ä½¿ç”¨å›¾ç‰‡éœ€è¦å­˜æ”¾åœ¨ä¸€ä¸ªä½ç½®ä¸Šï¼Œå¹³æ—¶ä¹Ÿæœ‰ä¸€äº›ä¸šä½™çš„æ‘„å½±çˆ±å¥½éœ€è¦åˆšå¥½å¯ä»¥å­˜æ”¾ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨å¦‚ä¹‹å‰ä½¿ç”¨è¿‡çš„ä¸ƒç‰›äº‘ç­‰äº‘å¯¹è±¡å­˜å‚¨å¹³å°å­˜å‚¨ä½¿ç”¨ï¼Œæˆ‘è¿™é‡Œä¹Ÿæ˜¯åˆšå¥½æœ‰ä¸ªäº‘æœåŠ¡å™¨å¯ä»¥åšå­˜å‚¨å°±æƒ³ç€è‡ªå·±æ­å»ºä¸€ä¸ªå›¾ç‰‡æœåŠ¡å™¨æ–¹ä¾¿ç®¡ç†ï¼Œä¹Ÿåˆšå¥½èƒ½å­¦ä¹ ä¸€ä¸‹æœåŠ¡å™¨æ–¹é¢çš„ä¸€äº›çŸ¥è¯†ï¼Œç»å¤šæ¬¡å°è¯•ï¼Œæ•…æ€»ç»“ä¸€ä¸‹,è¯ä¸å¤šè¯´ï¼Œå¼€å§‹è¡ŒåŠ¨.</p><a id="more"></a><h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><p>Ubuntuç‰ˆæœ¬Ubuntu 16.04.3</p><h1 id="å®‰è£…Nginx"><a href="#å®‰è£…Nginx" class="headerlink" title="å®‰è£…Nginx"></a>å®‰è£…Nginx</h1><p>é¦–å…ˆæ˜¯å‡†å¤‡ç¼–è¯‘Nginxçš„å‰æœŸå‡†å¤‡å·¥ä½œ  </p><h2 id="å…ˆæ›´æ–°ä¸€ä¸‹æº"><a href="#å…ˆæ›´æ–°ä¸€ä¸‹æº" class="headerlink" title="å…ˆæ›´æ–°ä¸€ä¸‹æº"></a>å…ˆæ›´æ–°ä¸€ä¸‹æº</h2><pre><code>&gt; apt-get update</code></pre><h2 id="å®‰è£…gcc-g-ä¾èµ–åº“"><a href="#å®‰è£…gcc-g-ä¾èµ–åº“" class="headerlink" title="å®‰è£…gcc g++ä¾èµ–åº“"></a>å®‰è£…gcc g++ä¾èµ–åº“</h2><pre><code>&gt; apt-get install build-essential&gt; apt-get install libtool</code></pre><h2 id="å®‰è£…prceä¾èµ–åº“"><a href="#å®‰è£…prceä¾èµ–åº“" class="headerlink" title="å®‰è£…prceä¾èµ–åº“"></a>å®‰è£…prceä¾èµ–åº“</h2><pre><code>&gt; apt-get install libpcre3 libpcre3-dev</code></pre><h2 id="å®‰è£…-zlibä¾èµ–åº“"><a href="#å®‰è£…-zlibä¾èµ–åº“" class="headerlink" title="å®‰è£… zlibä¾èµ–åº“"></a>å®‰è£… zlibä¾èµ–åº“</h2><pre><code>&gt; apt-get install zlib1g-dev</code></pre><h2 id="å®‰è£…-sslä¾èµ–åº“"><a href="#å®‰è£…-sslä¾èµ–åº“" class="headerlink" title="å®‰è£… sslä¾èµ–åº“"></a>å®‰è£… sslä¾èµ–åº“</h2><pre><code>&gt; apt-get install openssl</code></pre><h2 id="ç¼–è¯‘Nginx"><a href="#ç¼–è¯‘Nginx" class="headerlink" title="ç¼–è¯‘Nginx"></a>ç¼–è¯‘Nginx</h2><p>ä¸‹è½½<a href="http://nginx.org/en/download.html" target="_blank" rel="external">Nginx</a>æœ‰å¯¹åº”çš„ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œä¸‹è½½æ˜¯å½“å‰çš„æœ€æ–°ç‰ˆæœ¬1.13.8</p><pre><code>&gt; #è§£å‹ä¸‹è½½ä¸‹æ¥çš„å‹ç¼©åŒ…&gt; tar -zxvf nginx-1.13.8.tar.gz&gt; #è¿›å…¥è§£å‹ç›®å½•&gt; cd nginx-1.13.8&gt; #é…ç½®å¹¶ç”Ÿæˆmakefile&gt; ./configure --prefix=/usr/local/nginx &gt; #ç¼–è¯‘&gt; make&gt; #å®‰è£…&gt; make install&gt; #å¯åŠ¨Nginx&gt; /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</code></pre><p>æ­¤æ—¶Nginxå°±å®‰è£…å®Œæˆäº†ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„80ç«¯å£å¯åŠ¨ï¼Œå¦‚æœæœ‰å¯åŠ¨apache2æœåŠ¡çš„è¿™é‡Œä¼šç”¨å†²çªï¼Œè¿™é‡Œä¸æ˜¯é‡ç‚¹ï¼Œå¯æŸ¥è¯¢è§£å†³ï¼Œå¯åŠ¨å®Œæˆå¯ç›´æ¥é€šè¿‡æœåŠ¡å™¨ipæˆ–è€…äº‘è§£æçš„åŸŸåæŸ¥çœ‹é»˜è®¤ç½‘é¡µ  </p><p>é»˜è®¤çš„ç½‘é¡µé•¿è¿™ä¸ªæ ·å­<br><img src="https://ncmon-blog.oss-cn-beijing.aliyuncs.com/image6.png" alt="Nginx-default-index"></p><h1 id="å®‰è£…ä¸é…ç½®vsftpd"><a href="#å®‰è£…ä¸é…ç½®vsftpd" class="headerlink" title="å®‰è£…ä¸é…ç½®vsftpd"></a>å®‰è£…ä¸é…ç½®vsftpd</h1><h2 id="å®‰è£…vsftpd"><a href="#å®‰è£…vsftpd" class="headerlink" title="å®‰è£…vsftpd"></a>å®‰è£…vsftpd</h2><pre><code>&gt; apt-get install vsftpd</code></pre><h2 id="å¯åŠ¨vsftpdæœåŠ¡"><a href="#å¯åŠ¨vsftpdæœåŠ¡" class="headerlink" title="å¯åŠ¨vsftpdæœåŠ¡"></a>å¯åŠ¨vsftpdæœåŠ¡</h2><pre><code>&gt;service vsftpd start</code></pre><h2 id="æ–°å»ºftpuserç›®å½•ä½œä¸ºftpä¸»ç›®å½•-ï¼ˆftpuserä¸ºç›®å½•åï¼Œéšä¸ªäººå–œå¥½åˆ›å»ºï¼‰"><a href="#æ–°å»ºftpuserç›®å½•ä½œä¸ºftpä¸»ç›®å½•-ï¼ˆftpuserä¸ºç›®å½•åï¼Œéšä¸ªäººå–œå¥½åˆ›å»ºï¼‰" class="headerlink" title="æ–°å»ºftpuserç›®å½•ä½œä¸ºftpä¸»ç›®å½• ï¼ˆftpuserä¸ºç›®å½•åï¼Œéšä¸ªäººå–œå¥½åˆ›å»ºï¼‰"></a>æ–°å»ºftpuserç›®å½•ä½œä¸ºftpä¸»ç›®å½• ï¼ˆftpuserä¸ºç›®å½•åï¼Œéšä¸ªäººå–œå¥½åˆ›å»ºï¼‰</h2><pre><code>&gt;mkdir /home/ftpuser</code></pre><h2 id="æ–°å»ºftpuserç”¨æˆ·æŒ‡å®šç”¨æˆ·ä¸»ç›®å½•å’Œè®¾ç½®ç”¨æˆ·å¯†ç -ï¼ˆftpuserä¸ºç”¨æˆ·åï¼Œéšä¸ªäººå–œå¥½åˆ›å»ºï¼‰"><a href="#æ–°å»ºftpuserç”¨æˆ·æŒ‡å®šç”¨æˆ·ä¸»ç›®å½•å’Œè®¾ç½®ç”¨æˆ·å¯†ç -ï¼ˆftpuserä¸ºç”¨æˆ·åï¼Œéšä¸ªäººå–œå¥½åˆ›å»ºï¼‰" class="headerlink" title="æ–°å»ºftpuserç”¨æˆ·æŒ‡å®šç”¨æˆ·ä¸»ç›®å½•å’Œè®¾ç½®ç”¨æˆ·å¯†ç  ï¼ˆftpuserä¸ºç”¨æˆ·åï¼Œéšä¸ªäººå–œå¥½åˆ›å»ºï¼‰"></a>æ–°å»ºftpuserç”¨æˆ·æŒ‡å®šç”¨æˆ·ä¸»ç›®å½•å’Œè®¾ç½®ç”¨æˆ·å¯†ç  ï¼ˆftpuserä¸ºç”¨æˆ·åï¼Œéšä¸ªäººå–œå¥½åˆ›å»ºï¼‰</h2><pre><code>&gt;useradd -d /home/ftpuser -s /bin/bash ftpuser&gt;passwd ftpuser</code></pre><h2 id="åˆ¶å®šç”¨æˆ·ç»„"><a href="#åˆ¶å®šç”¨æˆ·ç»„" class="headerlink" title="åˆ¶å®šç”¨æˆ·ç»„"></a>åˆ¶å®šç”¨æˆ·ç»„</h2><pre><code>&gt;chown ftpuser:ftpuser /home/ftpuser</code></pre><h2 id="æ–°å»ºæ–‡ä»¶-etc-vsftpd-user-listï¼Œç”¨äºå­˜æ”¾å…è®¸è®¿é—®ftpçš„ç”¨æˆ·"><a href="#æ–°å»ºæ–‡ä»¶-etc-vsftpd-user-listï¼Œç”¨äºå­˜æ”¾å…è®¸è®¿é—®ftpçš„ç”¨æˆ·" class="headerlink" title="æ–°å»ºæ–‡ä»¶/etc/vsftpd.user_listï¼Œç”¨äºå­˜æ”¾å…è®¸è®¿é—®ftpçš„ç”¨æˆ·"></a>æ–°å»ºæ–‡ä»¶/etc/vsftpd.user_listï¼Œç”¨äºå­˜æ”¾å…è®¸è®¿é—®ftpçš„ç”¨æˆ·</h2><pre><code>&gt;vim /etc/vsftpd.user_list</code></pre><div class="article-img"><p><img src="https://ncmon-blog.oss-cn-beijing.aliyuncs.com/image7.png" alt="ftp-user_list"></p></div><h2 id="ç¼–è¾‘vsftpdé…ç½®æ–‡ä»¶"><a href="#ç¼–è¾‘vsftpdé…ç½®æ–‡ä»¶" class="headerlink" title="ç¼–è¾‘vsftpdé…ç½®æ–‡ä»¶"></a>ç¼–è¾‘vsftpdé…ç½®æ–‡ä»¶</h2><pre><code>&gt;vim /etc/vsftpd.confåšå¦‚ä¸‹ä¿®æ”¹ï¼š   ã€€ã€€æ‰“å¼€æ³¨é‡Š write_enable=YES   ã€€ã€€æ·»åŠ ä¿¡æ¯ userlist_file=/etc/vsftpd.user_list   ã€€ã€€æ·»åŠ ä¿¡æ¯ userlist_enable=YES   ã€€ã€€æ·»åŠ ä¿¡æ¯ userlist_deny=NO ã€€ã€€ä¿®æ”¹å®Œæˆåä¿å­˜é€€å‡ºã€‚</code></pre><h2 id="é‡å¯vsftpdæœåŠ¡"><a href="#é‡å¯vsftpdæœåŠ¡" class="headerlink" title="é‡å¯vsftpdæœåŠ¡"></a>é‡å¯vsftpdæœåŠ¡</h2><pre><code>&gt;service vsftpd restart</code></pre><p>è¿™æ˜¯å¯ä»¥ä½¿ç”¨filezillaç­‰ftpè½¯ä»¶ä½¿ç”¨åˆšåˆšæ–°å»ºçš„ç”¨æˆ·åå’Œå¯†ç è®¿é—®æµ‹è¯•æ˜¯å¦æˆåŠŸ</p><p>OKï¼Œå‡†å¤‡å·¥ä½œå®Œæˆå¼€å§‹ä¸Šä¼ å›¾ç‰‡ï¼Œå¼€å§‹æ­£å¼å›¾ç‰‡æœåŠ¡å™¨å·¥ä½œ</p><h2 id="åˆ›å»ºå­˜å‚¨å›¾ç‰‡çš„æ ¹ç›®å½•-ï¼ˆåœ¨ftpuserç›®å½•ä¸‹-æˆ‘è¿™é‡Œä½¿ç”¨www-imagesï¼‰"><a href="#åˆ›å»ºå­˜å‚¨å›¾ç‰‡çš„æ ¹ç›®å½•-ï¼ˆåœ¨ftpuserç›®å½•ä¸‹-æˆ‘è¿™é‡Œä½¿ç”¨www-imagesï¼‰" class="headerlink" title="åˆ›å»ºå­˜å‚¨å›¾ç‰‡çš„æ ¹ç›®å½• ï¼ˆåœ¨ftpuserç›®å½•ä¸‹,æˆ‘è¿™é‡Œä½¿ç”¨www/imagesï¼‰"></a>åˆ›å»ºå­˜å‚¨å›¾ç‰‡çš„æ ¹ç›®å½• ï¼ˆåœ¨ftpuserç›®å½•ä¸‹,æˆ‘è¿™é‡Œä½¿ç”¨www/imagesï¼‰</h2><pre><code>&gt;cd /home/ftpuser&gt;mkdir -p www/images</code></pre><h2 id="åœ¨nginxç›®å½•ä¸‹åˆ›å»ºimagesç›®å½•"><a href="#åœ¨nginxç›®å½•ä¸‹åˆ›å»ºimagesç›®å½•" class="headerlink" title="åœ¨nginxç›®å½•ä¸‹åˆ›å»ºimagesç›®å½•"></a>åœ¨nginxç›®å½•ä¸‹åˆ›å»ºimagesç›®å½•</h2><pre><code>&gt;mkdir /usr/local/nginx/html/images</code></pre><h2 id="ä¿®æ”¹nginx-conf-nginx-confåœ¨é»˜è®¤çš„serveré‡Œå†æ·»åŠ ä¸€ä¸ªlocationå¹¶æŒ‡å®šå®é™…è·¯å¾„"><a href="#ä¿®æ”¹nginx-conf-nginx-confåœ¨é»˜è®¤çš„serveré‡Œå†æ·»åŠ ä¸€ä¸ªlocationå¹¶æŒ‡å®šå®é™…è·¯å¾„" class="headerlink" title="ä¿®æ”¹nginx/conf/nginx.confåœ¨é»˜è®¤çš„serveré‡Œå†æ·»åŠ ä¸€ä¸ªlocationå¹¶æŒ‡å®šå®é™…è·¯å¾„:"></a>ä¿®æ”¹nginx/conf/nginx.confåœ¨é»˜è®¤çš„serveré‡Œå†æ·»åŠ ä¸€ä¸ªlocationå¹¶æŒ‡å®šå®é™…è·¯å¾„:</h2><pre><code>location /images/ {    root  /home/ftpuser/www/;    autoindex on;}  </code></pre><div class="article-img"><p><img src="https://ncmon-blog.oss-cn-beijing.aliyuncs.com/image8.png" alt="images_nginx_conf"></p></div><h2 id="ä¿®æ”¹ç”¨æˆ·è®¿é—®æƒé™"><a href="#ä¿®æ”¹ç”¨æˆ·è®¿é—®æƒé™" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·è®¿é—®æƒé™"></a>ä¿®æ”¹ç”¨æˆ·è®¿é—®æƒé™</h2><pre><code>&gt;chmod 755 /home/ftpuser/www/images</code></pre><p>ä½¿ç”¨filezilla ç­‰ftpå·¥å…·ä½¿ç”¨ftpuserç”¨æˆ·ç™»å½•å³å¯ä¸Šä¼ å›¾ç‰‡</p><h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><p><img src="https://ncmon-blog.oss-cn-beijing.aliyuncs.com/image9.png" alt="ftp_upload_test"><br>é€ä¸Šä¸€å¼ æœ€è¿‘çš„é•¿å®‰è¡—æ…¢é—¨æ•ˆæœç…§ç‰‡<em>â˜…,Â°</em>:.â˜†(ï¿£â–½ï¿£)/$:<em>.Â°â˜…</em>ã€‚å¤§åŠŸå‘Šæˆï¼ æ’’èŠ±ï¼<br><img src="https://ncmon-blog.oss-cn-beijing.aliyuncs.com/image10.png" alt="image_test_result"></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> FTP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android Studio import project å‡ºç°Erroré”™è¯¯ ç¨‹åºåŒ…org.apache.httpä¸å­˜åœ¨</title>
      <link href="/post/Android-Studio-Error-2/"/>
      <url>/post/Android-Studio-Error-2/</url>
      
        <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>é‡åˆ°æ–°çš„äº§å“å½¢æ€ã€æ ·å¼éœ€æ±‚æˆ‘ä»¬ç»å¸¸ä¼šåœ¨Githubæœç´¢å¼€æºé¡¹ç›®ï¼Œæœ‰äº›é¡¹ç›®æ˜¯æ—©æœŸAndroidç‰ˆæœ¬ä¸­å¼€å‘è€Œæˆï¼Œåç»­Googleä¼šæœ‰éƒ¨åˆ†APIåœ¨æ–°ç‰ˆæœ¬ä¸­çš„SDKæ”¾å¼ƒé›†æˆï¼Œè¿™æ¬¡æˆ‘å¯¼å…¥ä¸€ä¸ªé¡¹ç›®æ—¶å°±é‡åˆ°è¿™æ ·ä¸€ä¸ªé”™è¯¯</p><div class="article-img"><p><img src="https://ncmon-blog.oss-cn-beijing.aliyuncs.com/image4.png" alt="Error Imag"></p></div><h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><p>å¦‚æœç»å†è¿‡Android 4.4 æ—¶æœŸçš„åŒå­¦åº”è¯¥ä¼šè§‰å¾—org.apache.httpè¿™ä¸ªåŒ…å¾ˆç†Ÿæ‚‰ï¼Œè¿™é‡Œæ˜¾ç¤ºé”™è¯¯æ˜¯å› ä¸ºåœ¨targetsdkï¼š23ä»¥ä¸Šç‰ˆæœ¬SDKä¸­å·²ç»ä¸å†é›†æˆæ­¤åŒ…ï¼Œå¦‚éœ€ä½¿ç”¨å¯æ·»åŠ useLibrary â€œorg.apache.http.legacyâ€ä¾èµ–å³å¯ ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></div><div class="line">android &#123;</div><div class="line">   compileSdkVersion <span class="number">23</span></div><div class="line">    buildToolsVersion <span class="string">"23.0.3"</span></div><div class="line">    useLibrary <span class="string">"org.apache.http.legacy"</span></div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é”™è¯¯å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> IDEError </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>RecyclerViewæ’é›·--notifyItemRemovedä¸‹æ ‡ï¼ˆpositionï¼‰ä¸èƒ½æ›´æ–°</title>
      <link href="/post/RecyclerView-clear-of-mines-1/"/>
      <url>/post/RecyclerView-clear-of-mines-1/</url>
      
        <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>ç”¨ä»¥æ˜¾ç¤ºåˆ—è¡¨ç±»å‹çš„UIæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ListViewï¼ŒGridViewï¼ŒGoogleæ¨å‡ºRecyclerViewä¹‹åï¼Œå¤§éƒ¨åˆ†çš„ä½¿ç”¨å‡è½¬æ¢åˆ°äº†RecyclerViewä¸­ï¼Œå¯å®šåˆ¶åŒ–ååˆ†å¼ºï¼Œä½†æ˜¯ä½¿ç”¨è¿‡ç¨‹ä¸­éš¾å…ç¢°åˆ°ä¸€äº›é—®é¢˜ï¼Œä»¥å‰ä½¿ç”¨ListViewå¤šæ˜¯ä½¿ç”¨notifyDataSetChangedï¼ˆï¼‰æ›´æ–°æ•°æ®ï¼Œä½¿ç”¨RecyclerViewåˆ é™¤æ—¶ï¼Œä¸ºäº†ä½¿ç”¨å…¶è‡ªèº«çš„åˆ é™¤è¿‡æ¸¡åŠ¨ç”»ä½¿ç”¨notifyItemRemovedåˆ é™¤ï¼Œé‚£ä¹ˆå°±ç¢°åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå†onBindViewHolderä¸­è®¾ç½®äº†setTagï¼ˆpositionï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(RecyclerView.ViewHolder holder,<span class="keyword">int</span> position)</span></span>&#123;</div><div class="line">...</div><div class="line">holder.itemView.setTag(position)</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>ç›´æ¥ä½¿ç”¨notifyItemRemoved(posiaon)åˆ é™¤ä¼šå¯¼è‡´è¯¥ä¸‹æ ‡ä¸èƒ½æ›´æ–°å°±å¯¼è‡´ä¸€ç³»åˆ—çš„Bugï¼ˆ/è¡°ï¼‰</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æŸ¥è¯¢åˆ°äº†è§£å†³åŠæ³•ç‰¹æ­¤è®°å½•ä¸€ä¸‹:ä¸ºäº†ä¿®å¤è¯¥é—®é¢˜åˆ é™¤ä¹‹åéœ€è¦è°ƒç”¨notifyItenRangeChangedæ–¹æ³•ï¼Œä½¿ä¸‹é¢çš„itemviewé‡æ–°onBind:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteItem</span><span class="params">(<span class="keyword">int</span> position)</span></span>&#123;</div><div class="line">  mDataList.remove(position);</div><div class="line">  notifyItemRemoved(position);</div><div class="line">  <span class="keyword">if</span>(position != mDataList.size())&#123; <span class="comment">// å¦‚æœç§»é™¤çš„æ˜¯æœ€åä¸€ä¸ªï¼Œå¿½ç•¥</span></div><div class="line">      notifyItemRangeChanged(position, mDataList.size() - position);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>å¦‚æœä¸éœ€è¦ä½¿ç”¨åŠ¨ç”»æˆ–æ›´æ”¹è‡ªå®šä¹‰çš„åŠ¨ç”»æ•ˆæœå¯ä»¥æ·»åŠ ä¸€ä¸‹ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mRecyclerView.setItemAnimator(newDefaultItemAnimator());</div></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Android Studio æ›´æ–°åå‡ºç°Error:No service of type Factory  available in ProjectScopeServices.è§£å†³åŠæ³•</title>
      <link href="/post/Android-Studio-Error-1/"/>
      <url>/post/Android-Studio-Error-1/</url>
      
        <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>ä»Šå¤©æ›´æ–°Android Studioå ä¹‹å‰èƒ½è¿è¡Œçš„é¡¹ç›®å‡ºç°é”™è¯¯:<br><img src="https://ncmon-blog.oss-cn-beijing.aliyuncs.com/image1.png" alt=""></p><h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><p>æŸ¥æ‰¾åˆ°è§£å†³æ–¹æ¡ˆåœ¨æ­¤è®°å½•ä¸€ä¸‹ï¼š<br>æ˜¯githubçš„ è‡ªåŠ¨åŒ–æ‰“åŒ…æ’ä»¶maven ç‰ˆæœ¬éœ€è¦æ›´æ–°å¯¼è‡´<br><img src="https://ncmon-blog.oss-cn-beijing.aliyuncs.com/image2.png" alt=""><br><img src="https://ncmon-blog.oss-cn-beijing.aliyuncs.com/image3.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> é”™è¯¯å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> IDEError </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
