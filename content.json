{"meta":{"title":"ncnom's blog","subtitle":null,"description":null,"author":"ncmon","url":"http://ncmon.com"},"pages":[{"title":"","slug":"about","date":"2019-03-02T15:29:06.768Z","updated":"2019-03-02T15:29:06.768Z","comments":true,"path":"about/index.html","link":"http://ncmon.com/about/","permalink":"http://ncmon.com/about/index.html","excerpt":"","text":"å…³äºæˆ‘ncmon å¹¸è¿çš„ç”Ÿæ´»åœ¨äº’è”ç½‘æ—¶ä»£çš„Androidç¨‹åºçŒ¿ï¼Œæ­£åœ¨Androidå­¦ä¹ çš„è·¯ä¸Šä¸æ–­æ‘¸ç´¢ï¼› é‡åˆ°æœ‰æ„æ€çš„å­¦ä¹ æ¡ˆä¾‹ä¹Ÿå¸Œæœ›èƒ½åœ¨æ­¤åˆ†äº«ã€‚ å»ºç«™åˆè¡·ä¹Ÿè®¸è¯´è®°å½•å­¦ä¹ ç¬”è®°æ›´è´´è¿‘ä¸€äº›å®é™…ï¼Œå½“ç„¶åœ¨è¿™ä¸ªè¡Œä¸šå¾…å¾—æ—¶é—´è¶Šä¹…è¶Šä¼šè§‰å¾—å¼€æºæŠ€æœ¯ã€åˆ†äº«è¿‡ç¨‹çš„äººå¯¹æ–°äººæ¥è¯´æ˜¯å¤šä¹ˆé‡è¦ï¼Œè™½ç„¶ä¹Ÿæ˜¯ä¸ªæ–°äººï¼ŒæŠŠè‡ªå·±çš„å­¦ä¹ è·¯ç¨‹åˆ†äº«å‡ºæ¥æ—¢å¯¹æ‰€å¾—çŸ¥è¯†è¿›è¡Œä¸€æ¬¡å·©å›ºï¼Œä¹Ÿå¸Œæœ›èƒ½å¸®åŠ©éœ€è¦çš„äººè®©åˆ†äº«æˆä¸ºä¸€ç§ä¹è¶£ã€‚ è”ç³»æˆ‘Email: ncmonlx@outlook.comLocation: ä¸­å›½åŒ—äº¬"},{"title":"åˆ†ç±»","slug":"categories","date":"2018-09-30T14:58:00.677Z","updated":"2018-09-30T14:58:00.677Z","comments":true,"path":"categories/index.html","link":"http://ncmon.com/categories/","permalink":"http://ncmon.com/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"å…³äºgetDeviceIdå’ŒgetImeiè·å–å€¼ä¸åŒçš„åˆ†æ","slug":"android-get-imei","date":"2020-03-22T13:29:09.000Z","updated":"2020-03-22T13:39:14.338Z","comments":true,"path":"post/android-get-imei/","link":"http://ncmon.com/post/android-get-imei/","permalink":"http://ncmon.com/post/android-get-imei/","excerpt":"é—®é¢˜èƒŒæ™¯éœ€è¦è·å–imeiçš„å€¼ï¼Œå¾ˆå®¹æ˜“æŸ¥è¯¢åˆ°ä½¿ç”¨TelephonyManagerçš„getDeviceId()ï¼ˆåœ¨API Level 26 ä»¥ä¸Šå·²æ ‡è®°ä¸º@Deprecatedï¼Œåœ¨å¾ˆå¤šAndroid 26ä»¥ä¸Šè®¾å¤‡ä¸Šä¹Ÿå¯ç»§ç»­ä½¿ç”¨ï¼‰æ–¹æ³•å’ŒgetImei()æ–¹æ³•ï¼ˆæ³¨é‡Šæ ‡è®°è¯¥æ–¹æ³•éœ€åœ¨API Level 26 ä»¥ä¸Šè°ƒç”¨ï¼Œä¸è¿‡å®æµ‹åœ¨æœ‰äº›26ä»¥ä¸‹è®¾å¤‡ä¹Ÿå¯ä»¥è°ƒç”¨åˆ°ï¼‰Tips:Android Q ä»¥ä¸Šè·å–imeiçš„éœ€è¦READ_PRIVILEGED_PHONE_STATE æƒé™ï¼Œè¯¥æƒé™åªæœ‰ç³»ç»Ÿåº”ç”¨å¯ä»¥è·å–ï¼Œæ™®é€šåº”ç”¨ä½¿ç”¨ä»¥ä¸Šä¸¤ç§æ–¹æ³•è·å–å‡ä¼šæŠ›å‡ºå¼‚å¸¸SecurityExceptionï¼Œä¸è¿‡æœ¬æ–‡è¿™ä¸æ˜¯é‡ç‚¹ï¼Œæ‰€ä»¥æœ¬æ–‡æŒ‡çš„æ˜¯Android Qä»¥ä¸‹ç›¸å…³è®¾å¤‡ã€‚ç½‘ä¸Šçš„è¯´æ³•è¿™ä¸¤ä¸ªéƒ½æ˜¯è·å–imeiçš„æ–¹æ³•ï¼Œæ˜¯ä½¿ç”¨çš„API Levelä¸åŒï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶ä¸€ç›´ä»¥ä¸ºå¦‚æœé‡åˆ°ä¸¤ä¸ªæ–¹æ³•éƒ½èƒ½è·å–åˆ°å€¼çš„æƒ…å†µï¼Œä¸¤ä¸ªå€¼åº”è¯¥ç›¸åŒï¼Œéƒ½æ˜¯imeiçš„å€¼ã€‚è¿‘æœŸå‘ç°getDeviceId()å’ŒgetImei()åŒæ—¶å¯ç”¨æ—¶è·å–åˆ°çš„å€¼æœ‰æ—¶ä¼šä¸åŒï¼Œæ•…è·Ÿè¸ªä¸€ä¸‹æºç æŸ¥çœ‹ä¸€ä¸‹åŒºåˆ«ï¼Œåœ¨æ­¤è®°å½•ã€‚ é—®é¢˜åˆ†æè·Ÿè¸ªTelephonyManagerçš„getDeviceId()å’ŒgetImei()å®ç°æ–¹æ³•","text":"é—®é¢˜èƒŒæ™¯éœ€è¦è·å–imeiçš„å€¼ï¼Œå¾ˆå®¹æ˜“æŸ¥è¯¢åˆ°ä½¿ç”¨TelephonyManagerçš„getDeviceId()ï¼ˆåœ¨API Level 26 ä»¥ä¸Šå·²æ ‡è®°ä¸º@Deprecatedï¼Œåœ¨å¾ˆå¤šAndroid 26ä»¥ä¸Šè®¾å¤‡ä¸Šä¹Ÿå¯ç»§ç»­ä½¿ç”¨ï¼‰æ–¹æ³•å’ŒgetImei()æ–¹æ³•ï¼ˆæ³¨é‡Šæ ‡è®°è¯¥æ–¹æ³•éœ€åœ¨API Level 26 ä»¥ä¸Šè°ƒç”¨ï¼Œä¸è¿‡å®æµ‹åœ¨æœ‰äº›26ä»¥ä¸‹è®¾å¤‡ä¹Ÿå¯ä»¥è°ƒç”¨åˆ°ï¼‰Tips:Android Q ä»¥ä¸Šè·å–imeiçš„éœ€è¦READ_PRIVILEGED_PHONE_STATE æƒé™ï¼Œè¯¥æƒé™åªæœ‰ç³»ç»Ÿåº”ç”¨å¯ä»¥è·å–ï¼Œæ™®é€šåº”ç”¨ä½¿ç”¨ä»¥ä¸Šä¸¤ç§æ–¹æ³•è·å–å‡ä¼šæŠ›å‡ºå¼‚å¸¸SecurityExceptionï¼Œä¸è¿‡æœ¬æ–‡è¿™ä¸æ˜¯é‡ç‚¹ï¼Œæ‰€ä»¥æœ¬æ–‡æŒ‡çš„æ˜¯Android Qä»¥ä¸‹ç›¸å…³è®¾å¤‡ã€‚ç½‘ä¸Šçš„è¯´æ³•è¿™ä¸¤ä¸ªéƒ½æ˜¯è·å–imeiçš„æ–¹æ³•ï¼Œæ˜¯ä½¿ç”¨çš„API Levelä¸åŒï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶ä¸€ç›´ä»¥ä¸ºå¦‚æœé‡åˆ°ä¸¤ä¸ªæ–¹æ³•éƒ½èƒ½è·å–åˆ°å€¼çš„æƒ…å†µï¼Œä¸¤ä¸ªå€¼åº”è¯¥ç›¸åŒï¼Œéƒ½æ˜¯imeiçš„å€¼ã€‚è¿‘æœŸå‘ç°getDeviceId()å’ŒgetImei()åŒæ—¶å¯ç”¨æ—¶è·å–åˆ°çš„å€¼æœ‰æ—¶ä¼šä¸åŒï¼Œæ•…è·Ÿè¸ªä¸€ä¸‹æºç æŸ¥çœ‹ä¸€ä¸‹åŒºåˆ«ï¼Œåœ¨æ­¤è®°å½•ã€‚ é—®é¢˜åˆ†æè·Ÿè¸ªTelephonyManagerçš„getDeviceId()å’ŒgetImei()å®ç°æ–¹æ³• 123456789101112131415161718192021222324252627 //android/telephony/TelephonyManager.java public String getDeviceId() &#123; try &#123; ITelephony telephony = getITelephony(); if (telephony == null) return null; return telephony.getDeviceId(mContext.getOpPackageName()); &#125; catch (RemoteException ex) &#123; return null; &#125; catch (NullPointerException ex) &#123; return null; &#125; &#125;public String getImei() &#123; return getImei(getSlotIndex()); &#125; public String getImei(int slotIndex) &#123; ITelephony telephony = getITelephony(); if (telephony == null) return null; try &#123; return telephony.getImeiForSlot(slotIndex, getOpPackageName(), getFeatureId()); &#125; catch (RemoteException ex) &#123; return null; &#125; catch (NullPointerException ex) &#123; return null; &#125; &#125; æ¥ä¸‹æ¥çš„å·¥ä½œéƒ½æ˜¯è·Ÿè¸ªå¯¹åº”çš„ç±»è°ƒç”¨getDeviceId():PhoneInterfaceManager.java â€“&gt;getDeviceId(String callingPackage)â€“&gt; getDeviceIdWithFeature(String callingPackage, String callingFeatureId)â€“&gt; PhoneFactory.getPhone(0).getDeviceId()getImei():PhoneInterfaceManager.java â€“&gt; getImeiForSlot(int slotIndex, String callingPackage, String callingFeatureId)â€“&gt; PhoneFactory.getPhone(0).getImei()PhoneInterfaceManager ä½œä¸ºTelephonyManagerçš„ server ç«¯ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å†æ·±å…¥äº†è§£ã€‚æœ€ç»ˆè·å–çš„æ˜¯Phoneä¸­çš„å€¼ï¼ŒPhone phone = PhoneFactory.getPhone(0);frameworks/opt/telephony/src/java/com/android/internal/telephony/Phone.javaæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»,å¯¹åº”çš„å­ç±»åŒ…æ‹¬GsmCdmaPhone.javaã€ImsPhoneBase.java,SipPhoneBase.java,é€šè¿‡å‘½åå¤§æ¦‚èƒ½çœ‹å‡ºæ˜¯æ‰‹æœºåº”è¯¥ä½¿ç”¨çš„æ˜¯GsmCdmaPhone.java,ä¹Ÿå¯ä»¥çœ‹åˆ°ImsPhoneBase.java,SipPhoneBase.java å…³äºgetDeviceId()å’ŒgetImei()çš„è¿”å›å€¼å‡ä¸ºnull,æ•…åªéœ€å…³æ³¨GsmCdmaPhone.javaå³å¯ 1234567891011121314151617181920212223//frameworks/opt/telephony/src/java/com/android/internal/telephony/GsmCdmaPhone.java@Overridepublic String getDeviceId() &#123; if (isPhoneTypeGsm()) &#123; return mImei; &#125; else &#123; CarrierConfigManager configManager = (CarrierConfigManager) mContext.getSystemService(Context.CARRIER_CONFIG_SERVICE); boolean force_imei = configManager.getConfigForSubId(getSubId()) .getBoolean(CarrierConfigManager.KEY_FORCE_IMEI_BOOL); if (force_imei) return mImei; String id = getMeid(); if ((id == null) || id.matches(\"^0*$\")) &#123; loge(\"getDeviceId(): MEID is not initialized use ESN\"); id = getEsn(); &#125; return id; &#125;&#125;@Overridepublic String getImei() &#123; return mImei;&#125; ç»“è®ºå¾ˆæ˜æ˜¾ï¼ŒgetImei()æ˜¯çº¯ç²¹è·å–imeiå€¼çš„æ–¹æ³•ï¼ŒgetDeviceIdä¸­åŒ…å«åˆ¤æ–­ï¼Œå¦‚æœisPhoneTypeGsm() ==false &amp;&amp; force_imei = false ä¹Ÿå¯èƒ½è·å–meidæˆ–Esnä½œä¸ºè¿”å›å€¼ã€‚","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"}]},{"title":"Kotlinå­¦ä¹ ç¬”è®°-è¾ƒéš¾ç†è§£çš„çŸ¥è¯†ç‚¹ï¼Ÿ","slug":"kotlin-grasp-question-mark","date":"2020-02-28T14:01:52.000Z","updated":"2020-03-22T13:50:38.391Z","comments":true,"path":"post/kotlin-grasp-question-mark/","link":"http://ncmon.com/post/kotlin-grasp-question-mark/","permalink":"http://ncmon.com/post/kotlin-grasp-question-mark/","excerpt":"","text":"å‰è¨€å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œéœ€æ±‚æ˜¯å­¦ä¹ çš„æœ€å¤§åŠ¨åŠ›ï¼Œæ¯”å…´è¶£åŠ¨åŠ›éƒ½è¶³ï¼Œä¹‹å‰å¯¹Kotlinä¸€ç›´æ˜¯ä¸€çŸ¥åŠè§£ï¼Œæ²¡æœ‰ç³»ç»Ÿæ€§çš„å­¦ä¹ ï¼Œæœ€è¿‘å¼€å§‹çœ‹å¾ˆå¤šopen sourceéƒ½å¼€å§‹ä½¿ç”¨Kotlinè¯­è¨€æ¥å†™äº†ï¼Œå¾ˆå¤šç¤¾åŒºçš„å¤§ç¥ä»¬ä¹ŸæåŠ›åœ¨æ¨èå­¦ä¹ ï¼Œå†ä¸å­¦ä¹ éƒ½è¦è·Ÿä¸ä¸Šäº†ï¼Œåˆšå¥½æœ€è¿‘æœ‰æ—¶é—´å­¦ä¹ ä¸€ä¸‹ï¼Œæ‰¾äº†ä¸€æœ¬ä¹¦ã€ŠKotlinæ ¸å¿ƒç¼–ç¨‹ã€‹æ„Ÿè§‰è®²çš„è¿˜æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œæˆä½“ç³»ï¼Œæ‰€ä»¥è¦é›†ä¸­ç³»ç»Ÿçš„å­¦ä¹ ä¸€ä¸‹ï¼Œä¸ºä»¥åé˜…è¯»ä»£ç ï¼Œç”šè‡³è½¬å‘Kotliné¡¹ç›®åšäº›å‡†å¤‡ã€‚ æœ¬ç³»åˆ—ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹è‡ªå·±å­¦ä¹ ä¸­æ„Ÿè§‰ä¸Javaç›¸æ¯”ï¼Œæ€æƒ³ä¸Šæ¯”è¾ƒéš¾è½¬æ¢æˆ–è€…è¯´éš¾è®°å¿†çš„ç‚¹ï¼Œä¹Ÿæœ‰ä¸€äº›æ˜¯è§‰å¾—ä¼šå¾ˆå¸¸ç”¨çš„çŸ¥è¯†ç‚¹ï¼ŒåŠ æ·±è®°å¿†å¯ä¾›ä»¥åæŸ¥è¯¢ï¼ŒåŒæ—¶ä¹Ÿæƒ³åˆ†äº«ç»™å¤§å®¶ä¸€ä¸‹ï¼Œå¥½æ¯”ä¸Šå­¦æ—¶æœŸçš„è€å¸ˆåˆ’é‡ç‚¹ï¼Œè¯ä¸å¤šè¯´ï¼Œçœ‹å¥½å°é»‘æ¿~ã€‚ ä¸€. ææœ‰ç‰¹ç‚¹çš„ï¼Ÿ1.1 ï¼Ÿå•ç‹¬çš„ï¼Ÿä»£è¡¨å¯ä»¥ä¸ºç©º@Nullable ï¼ŒKotliné»˜è®¤å®šä¹‰å±æ€§æ—¶ä¸èƒ½ä¸ºnull,å†™åœ¨å®šä¹‰å±æ€§æ—¶ï¼Œè¡¨ç¤ºè¯¥å±æ€§å¯ç©º 1234val type:String = null //è¿™æ ·å®šä¹‰ä¼šæŠ¥é”™ï¼Œé»˜è®¤ä¸å…è®¸ä¸ºnullval type:String? = null //å¢åŠ ï¼Ÿä»£è¡¨å¯ä»¥å®šä¹‰ä¸ºnull//æ‰©å±•ä¸€ä¸‹val type = null //è¿™æ ·ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ— æ„ä¹‰çš„å±æ€§Kotlinä¸­çš„Nothingä¹Ÿä¸èƒ½ä¿®æ”¹ä¸ºå…¶ä»–å€¼ 1.2 ?. å’Œ!!.1seat?.student ç›´æ¥å¯¹åº”Javaä¸­çš„Nullcheck,å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºnullï¼Œç„¶åå†è°ƒç”¨ï¼Œå¦‚æœä¸ºç©ºå°±è¿”å›null åŒJavaä»£ç è¡¨ç¤º 12345if(seat != null)&#123; return seat.student&#125;else&#123; return null&#125; !!.æ˜¯å’Œ?.å¯¹åº”çš„ï¼Œ ?.ç¨‹åºå…è®¸ä¸ºç©º !!.ç¨‹åºä¸å…è®¸ä¸ºç©º 1seat!!.student ç›´æ¥å¯¹åº”Javaä¸­çš„Nullcheck,å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºnullï¼Œç„¶åå†è°ƒç”¨ï¼Œå¦‚æœä¸ºç©ºå°±æŠ›å‡ºå¼‚å¸¸ å¯¹åº”çš„Javaä»£ç è¡¨ç¤º 12345if(seat != null)&#123; return seat.student&#125;else&#123; throw new NullPointerException();&#125; 1.3 ?:1val c = a ?: b // åˆ¤æ–­aæ˜¯å¦ä¸ºnullï¼Œå¦‚æœä¸ä¸ºnullè¿”å›aï¼Œå¦‚æœä¸ºnullè¿”å›b åŒJavaä»£ç è¡¨ç¤º 1a != null ? c = a : c = b 1.4 as?1val x = y as? String å®‰å…¨çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦ï¼Œé»˜è®¤ä¸åŠ ï¼Ÿæ—¶ï¼Œåˆ¤æ–­å¦‚æœxä¸èƒ½è½¬æ¢ä¸ºStringç±»å‹æ˜¯ä¼šè·‘å‡ºjava.lang.ClassCastException å¢åŠ ï¼Ÿåï¼Œxå¦‚æœä¸èƒ½è½¬æ¢ä¸ºStringï¼Œä¼šè¿”å›ä¸€ä¸ªnullå€¼ã€‚ åŒJavaä»£ç  12345if (y instenceof String)&#123; x = (String)y;&#125;else&#123; x = null&#125;","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"},{"name":"Kotlin","slug":"Kotlin","permalink":"http://ncmon.com/tags/Kotlin/"}]},{"title":"åº”ç”¨å¼¹çª—â€œæ­¤åº”ç”¨ä¸“ä¸ºæ—§ç‰ˆAndroidæ‰“é€ ï¼Œå› æ­¤å¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œâ€","slug":"targetsdkversion_error_dialog","date":"2019-12-19T07:36:09.000Z","updated":"2020-01-05T12:41:18.363Z","comments":true,"path":"post/targetsdkversion_error_dialog/","link":"http://ncmon.com/post/targetsdkversion_error_dialog/","permalink":"http://ncmon.com/post/targetsdkversion_error_dialog/","excerpt":"","text":"åº”ç”¨å¼¹çª—â€œæ­¤åº”ç”¨ä¸“ä¸ºæ—§ç‰ˆAndroidæ‰“é€ ï¼Œå› æ­¤å¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œå®‰è£…åœ¨æ–°è®¾å¤‡ä¸Šçš„åº”ç”¨å‡ºç°äº†è¿™ä¸ªè­¦å‘Šå¼¹çª—ï¼š æ˜¾ç„¶æ˜¯ä¸ªç³»ç»Ÿå¼¹çª—ã€‚çœ‹ä¸€ä¸‹åŸå›  Androidæºç åˆ†æè¿½è¸ªåº”ç”¨å¯åŠ¨ä»£ç ï¼Œå¿½ç•¥è¿‡ç¨‹ï¼Œæœ¬æ–‡ä¸æ˜¯é‡ç‚¹ï¼Œç»è¿‡å±‚å±‚è°ƒç”¨ä¼šè¿›å…¥åˆ°AppWarningsæ–¹æ³•ä¸­ï¼Œç›´æ¥å»çœ‹å…³é”®ä¿¡æ¯ï¼š 123456789101112131415161718192021//com/android/server/wm/AppWarnings.java/** * Shows the \"deprecated target sdk\" warning, if necessary. * * @param r activity record for which the warning may be displayed */public void showDeprecatedTargetDialogIfNeeded(ActivityRecord r) &#123; if (r.appInfo.targetSdkVersion &lt; Build.VERSION.MIN_SUPPORTED_TARGET_SDK_INT) &#123; mUiHandler.showDeprecatedTargetDialog(r); &#125;&#125;/** * Called when an activity is being started. * * @param r record for the activity being started */public void onStartActivity(ActivityRecord r) &#123; showUnsupportedCompileSdkDialogIfNeeded(r); showUnsupportedDisplaySizeDialogIfNeeded(r); showDeprecatedTargetDialogIfNeeded(r);&#125; å¯ä»¥çœ‹åˆ°è¯¥å¼¹çª—çš„æ˜¾ç¤ºä½ç½®showDeprecatedTargetDialogIfNeeded(ActivityRecord)åªæœ‰ä¸€ä¸ªæ¡ä»¶ï¼štargetSdkVersion&lt;Build.VERSION.MIN_SUPPORTED_TARGET_SDK_INTç»§ç»­è¿½è¸ªBuild.java 12345678910//android/os/Build.java/** * The current lowest supported value of app target SDK. Applications targeting * lower values may not function on devices running this SDK version. Its possible * values are defined in &#123;@link Build.VERSION_CODES&#125;. * * @hide */public static final int MIN_SUPPORTED_TARGET_SDK_INT = SystemProperties.getInt( \"ro.build.version.min_supported_target_sdk\", 0); æ˜¯è®¾å¤‡ä¸­é…ç½®ä¿¡æ¯ro.build.version.min_supported_target_sdkç›®å‰å‘ç°åœ¨Android P å’ŒAndroid Qä¸­ä¼šå‡ºç°è¯¥é—®é¢˜ï¼ŒæŸ¥çœ‹æµ‹è¯•æœºå‹ä¸­è¯¥é…ç½®çš„å€¼Android Qè®¾å¤‡ä¸­è¯¥å€¼ï¼š Android Pè®¾å¤‡ä¸­è¯¥å€¼ï¼š è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶æ˜¯åœ¨æ¯ä¸ªActivityå¯åŠ¨æ—¶ä¼šè°ƒç”¨AppWarnings.javaçš„onStartActivityæ–¹æ³•ï¼Œé‚£ä¼šä¸ä¼šæ¯æ¬¡æ‰“å¼€æ–°Activityï¼Œéƒ½å¼¹æ­¤å¯¹è¯æ¡†ï¼Ÿ ç­”æ¡ˆï¼šä¸ä¼šçš„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œç¬¬ä¸€æ¬¡å¼¹å‡ºå¯¹è¯æ¡†åï¼Œç”¨æˆ·å¦‚æœé€‰æ‹©â€œç¡®å®šâ€ï¼ŒAMSä¼šç»™æ­¤åº”ç”¨è®¾ç½®ä¸€ä¸ªFlagæ ‡è¯†ï¼šFLAG_HIDE_DEPRECATED_SDKã€‚æ¯æ¬¡å‡†å¤‡å¼¹çª—æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­æ­¤æ ‡è¯†å€¼æ˜¯å¦ä¸ºtrueï¼Œå¦‚æœæ˜¯ï¼Œè¯´æ˜å·²ç»æç¤ºè¿‡ç”¨æˆ·ï¼Œæ— éœ€å†å¼¹çª—ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789 public DeprecatedTargetSdkVersionDialog(final AppWarnings manager, Context context, ApplicationInfo appInfo) &#123;// ...final AlertDialog.Builder builder = new AlertDialog.Builder(context).setPositiveButton(R.string.ok, (dialog, which) -&gt;manager.setPackageFlag(mPackageName, AppWarnings.FLAG_HIDE_DEPRECATED_SDK, true)).setMessage(message).setTitle(label);// ... &#125; é—®é¢˜ç»“è®ºç»“è®ºå¾ˆæ¸…æ™°ï¼šæ–‡ç« å¼€å¤´ä¸­æåˆ°çš„å¼¹çª—ï¼Œåœ¨Android Pè®¾å¤‡ä¸­targetSdkVersion&lt;17çš„åº”ç”¨ä¼šå¼¹å‡ºè¯¥å¼¹çª—ï¼Œåœ¨Android Qè®¾å¤‡ä¸­targetSdkVersion&lt;23çš„åº”ç”¨ä¼šå¼¹å‡ºè¯¥å¼¹çª—ã€‚","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"}]},{"title":"Android WebViewå¿…çŸ¥å¿…ä¼š(4)-Webviewä¸‹è½½æ”¯æŒï¼Œä¸JavaScriptçš„äº¤äº’","slug":"webview-learning-JavaScript","date":"2019-03-25T16:06:30.000Z","updated":"2019-03-25T16:48:21.469Z","comments":true,"path":"post/webview-learning-JavaScript/","link":"http://ncmon.com/post/webview-learning-JavaScript/","permalink":"http://ncmon.com/post/webview-learning-JavaScript/","excerpt":"","text":"ç®€ä»‹å‰é¢å·²ç»ä»‹ç»äº†WebSettings,WebViewClient,WebChromeClient Android WebViewå¿…çŸ¥å¿…ä¼š(1)-WebViewClient Android WebViewå¿…çŸ¥å¿…ä¼š(2)-WebSettings Android WebViewå¿…çŸ¥å¿…ä¼š(3)-WebChromeClient è¿™ä¸€ç¯‡å°±è®°å½•ä¸€ä¸‹WebViewçš„å…¶ä»–é‡è¦åŠŸèƒ½ ä¸‹è½½æ”¯æŒæµè§ˆå™¨ä¸­æœ‰ä¸‹è½½é“¾æ¥çš„å¦‚æœä¸æ·»åŠ æ”¯æŒç‚¹å‡»æ˜¯æ²¡æœ‰åæ˜ çš„ï¼Œå¸¸è§çš„æµè§ˆå™¨éƒ½æœ‰è‡ªå·±çš„ä¸‹è½½ç®¡ç†åŠŸèƒ½ï¼Œæˆ‘ä»¬è¦å®ç°çš„è¯éœ€è¦æ€ä¹ˆåšå‘¢ï¼ŒWebViewæœ‰å…¶å¯¹åº”çš„è®¾ç½®ã€‚ 1234567891011/** * Registers the interface to be used when content can not be handled by * the rendering engine, and should be downloaded instead. This will replace * the current handler. * * @param listener an implementation of DownloadListener */ public void setDownloadListener(DownloadListener listener) &#123; checkThread(); mProvider.setDownloadListener(listener); &#125; é€šè¿‡è®¾ç½®DownloadListenerå°±èƒ½æ•è·åˆ°ä¸‹è½½äº‹ä»¶ï¼Œé’ˆå¯¹ä¸‹è½½é“¾æ¥åšé’ˆå¯¹æ€§çš„å¤„ç†ã€‚ 12345public interface DownloadListener &#123; public void onDownloadStart(String url, String userAgent, String contentDisposition, String mimetype, long contentLength);&#125; DownloadListeneråªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œç‚¹å‡»ä¸‹è½½é“¾æ¥å³å‡ºå‘ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§å¤„ç†æ–¹å¼ï¼Œå¤§å®¶å‚è€ƒä»¥ä¸‹å§ã€‚ ä¼ é€’ç»™æ‰‹æœºæµè§ˆå™¨ç­‰èƒ½å¤„ç†Urlçš„åº”ç”¨å¤„ç†è¿™ç§æœ€ç®€å•ç²—æš´ï¼Œä¼šè·³å‡ºé€‰æ‹©å¯å¤„ç†ACTION_VIEWçš„é€‰æ‹©æ¡†ï¼Œé€‰æ‹©å¸¸è§„çš„æµè§ˆå™¨éƒ½ä¼šæ”¯æŒï¼Œç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨çš„è¯å°±æ˜¯ç›´æ¥è®©æ‰‹æœºè‡ªå¸¦æµè§ˆå™¨APPå¤„ç†è¯¥ä¸‹è½½é“¾æ¥äº†ã€‚ 123456webView.setDownloadListener((url, userAgent, contentDisposition, mimetype, contentLength) -&gt; &#123; Intent intent = new Intent(Intent.ACTION_VIEW); intent.addCategory(Intent.CATEGORY_BROWSABLE); intent.setData(Uri.parse(url)); startActivity(intent);&#125;); ä½¿ç”¨DownloadManagerå¤„ç†å°±æ˜¯ä½¿ç”¨ç³»ç»Ÿçš„DownloadManagerå»å¤„ç†ä¸‹è½½ä»»åŠ¡äº†ï¼Œè¿™æ—¶å°±ç”¨åˆ°äº†å…¶ä»–å‚æ•° @param url ä¸‹è½½é“¾æ¥ @param contentDisposition ä¸‹è½½ä»»åŠ¡æè¿° @param mimetype ä¸‹è½½æ–‡ä»¶åç¼€","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"}]},{"title":"Android WebViewå¿…çŸ¥å¿…ä¼š(3)-WebChromeClient","slug":"webview-learning-WebChromeClient","date":"2019-03-14T14:35:47.000Z","updated":"2019-03-23T06:29:14.825Z","comments":true,"path":"post/webview-learning-WebChromeClient/","link":"http://ncmon.com/post/webview-learning-WebChromeClient/","permalink":"http://ncmon.com/post/webview-learning-WebChromeClient/","excerpt":"ç®€ä»‹ğŸ˜€WebChromeClientï¼šå½“å½±å“â€æµè§ˆå™¨â€çš„äº‹ä»¶åˆ°æ¥æ—¶ï¼Œå°±ä¼šé€šè¿‡WebChromeClientä¸­çš„æ–¹æ³•å›è°ƒé€šçŸ¥ç”¨æ³•,æ‰€ä»¥WebChromeClientéƒ½æ˜¯å’Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨æµè§ˆå™¨éœ€è¦çš„ä¸€äº›äº¤äº’æœ‰å¯†åˆ‡çš„è”ç³»ã€‚","text":"ç®€ä»‹ğŸ˜€WebChromeClientï¼šå½“å½±å“â€æµè§ˆå™¨â€çš„äº‹ä»¶åˆ°æ¥æ—¶ï¼Œå°±ä¼šé€šè¿‡WebChromeClientä¸­çš„æ–¹æ³•å›è°ƒé€šçŸ¥ç”¨æ³•,æ‰€ä»¥WebChromeClientéƒ½æ˜¯å’Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨æµè§ˆå™¨éœ€è¦çš„ä¸€äº›äº¤äº’æœ‰å¯†åˆ‡çš„è”ç³»ã€‚ è·å–ç½‘é¡µçš„åŠ è½½è¿›åº¦ void onProgressChanged(WebView view, int newProgress) ï¼› Tell the host application the current progress of loading a page. newProgress: Current page loading progress, represented by an integer between 0 and 100. å¤§å®¶ä¸€å®šè¦æ³¨æ„ï¼Œåº•å±‚å®ç°æ—¶ï¼Œæ˜¯åˆ©ç”¨handleræ¥å®šæ—¶è½®å¾ªå½“å‰è¿›åº¦çš„ï¼Œæ¯éš”ä¸€å®šæ—¶é—´æŸ¥è¯¢ä¸€æ¬¡ï¼Œæ‰€ä»¥æ¯æ¬¡æ‹¿åˆ°çš„è¿›åº¦æ•°æ®æ˜¯ä¸ä¸€æ ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœé¡µé¢è¾ƒç®€å•ï¼Œå¯èƒ½ä¼šç›´æ¥è¿”å›100ï¼Œè€Œè·³è¿‡ä¸­é—´çš„å„ä¸ªæ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™¤äº†100ï¼Œå…¶å®ƒä»»ä½•ä¸€ä¸ªæ•°å€¼ä¸æ˜¯ä¸€å®šè¿”å›çš„ã€‚æ‰€ä»¥å¤§å®¶å¦‚æœè¦ç”¨åˆ°è¿›åº¦ï¼Œé™¤äº†æ•°å€¼100å¯ä»¥ç”¨ç­‰å·æ¥åˆ¤æ–­ï¼Œå…¶å®ƒä¸€å®šè¦ç”¨å¤§äºå·æˆ–å°äºå·ï¼Œå¦‚æœç”¨äº†ç­‰å·ï¼Œå¯èƒ½æ°¸è¿œä¹Ÿä¸ä¼šæ‰§è¡Œåˆ°ã€‚ è·å–ç½‘é¡µä¸­çš„åŸºæœ¬ä¿¡æ¯ void onReceivedIcon(WebView view, Bitmap icon) icon A Bitmap containing the favicon for the current page.ç½‘é¡µä¸­é¦–éƒ¨å›¾æ ‡ void onReceivedTitle(WebView view, String title) title: A String containing the new title of the document. ç½‘é¡µä¸­æ ‡é¢˜ä¸­çš„æ›´æ”¹ï¼Œé¦–éƒ¨æ ‡é¢˜ è·å–æ ‡é¢˜çš„æ—¶é—´ä¸»è¦å–å†³äºç½‘é¡µå‰ç«¯è®¾ç½®æ ‡é¢˜çš„ä½ç½®ï¼ŒJSä¸­çš„å‡½æ•°è®¾ç½®ä¹Ÿåœ¨è¿™é‡Œæ¥æ”¶ void onReceivedTouchIconUrl(WebView view, String url, boolean precomposed) Notify the host application of the url for an apple-touch-icon(è‹¹æœå›¾æ ‡). è‹¹æœä¸ºiOSè®¾å¤‡é…å¤‡äº†apple-touch-iconç§æœ‰å±æ€§ï¼Œæ·»åŠ è¯¥å±æ€§ï¼Œåœ¨iPhone,iPad,iTouchçš„safariæµè§ˆå™¨ä¸Šå¯ä»¥ä½¿ç”¨æ·»åŠ åˆ°ä¸»å±æŒ‰é’®å°†ç½‘ç«™æ·»åŠ åˆ°ä¸»å±å¹•ä¸Šï¼Œæ–¹ä¾¿ç”¨æˆ·ä»¥åè®¿é—®ã€‚apple-touch-icon æ ‡ç­¾æ”¯æŒsizeså±æ€§ï¼Œå¯ä»¥ç”¨æ¥æ”¾ç½®å¯¹åº”ä¸åŒçš„è®¾å¤‡ã€‚ url: The icon url.å›¾ç‰‡åœ°å€ precomposed: True if the url is for a precomposed touch icon. æ ‡è®°ä¸ºTrueçš„è¯ä½¿ç”¨åŸå›¾ æ‹¦æˆªç½‘é¡µä¸­JSæ§åˆ¶å°æ¶ˆæ¯å½“htmlä¸­è°ƒç”¨consoleç›¸å…³è¾“å‡ºçš„æ—¶å€™ï¼Œå°±ä¼šé€šè¿‡onConsoleMessageè¿›è¡Œé€šçŸ¥ å’Œalert,prompt,confirmä¸åŒï¼Œæˆ‘ä»¬ä¸éœ€è¦å¼ºåˆ¶è®¾ç½®WebChromeClientï¼ˆä½†æ˜¯ä»éœ€è¦setJavaScriptEnabledä¸ºtrueï¼‰ï¼Œå½“ç‚¹å‡»logæŒ‰é’®æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨consoleç›¸åº”çš„å‡½æ•°æŠŠæ—¥å¿—æ‰“å°å‡ºæ¥ã€‚ å¯ä»¥è·å–åˆ°çš„ä¿¡æ¯æœ‰ï¼š 123456789101112131415@Overridepublic boolean onConsoleMessage(ConsoleMessage consoleMessage) &#123; Log.e(\"ncmon\", \"onConsoleMessage : \" + \"\\nmessage=\" + consoleMessage.message() + \"\\nlineNumber=\" + consoleMessage.lineNumber() + \"\\nmessageLevel=\" + consoleMessage.messageLevel() + \"\\nsourceId=\" + consoleMessage.sourceId()); return super.onConsoleMessage(consoleMessage);&#125;ncmon : onConsoleMessage : message=Uncaught TypeError: Cannot read property 'getItem' of null lineNumber=2 messageLevel=ERROR sourceId=https://m.baidu.com/?from=844b&amp;vit=fpschromium: [INFO:CONSOLE(2)] \"Uncaught TypeError: Cannot read property 'getItem' of null\", source: https://m.baidu.com/?from=844b&amp;vit=fps (2) å¯ä»¥çœ‹åˆ°é™¤äº†æ¥¼ä¸»è¾“å‡ºçš„æ—¥å¿—å¤–ï¼Œè¿˜æœ‰chromiumçš„æ—¥å¿—ï¼Œè¿™é‡Œä¹Ÿå°±è¦ä½“ç°è¿”å›å€¼çš„ä½œç”¨ï¼Œå¦‚æœè¿”å›trueæ—¶ï¼Œå°±è¡¨ç¤ºæ‹¦æˆªäº†consoleè¾“å‡ºï¼Œç³»ç»Ÿå°±ä¸å†é€šè¿‡consoleè¾“å‡ºå‡ºæ¥äº†ï¼›å¦‚æœè¿”å›false(é»˜è®¤å€¼)ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰æ‹¦æˆªconsoleè¾“å‡ºï¼Œè°ƒç”¨ç³»ç»Ÿé»˜è®¤å¤„ç† 123456public class ConsoleMessage &#123; private MessageLevel mLevel; private String mMessage; private String mSourceId; private int mLineNumber;&#125; æ‹¦æˆªç½‘é¡µä¸­JSå¼¹æ¡†ä¸‰ç§ç±»å‹çš„å¼¹æ¡† 1234public boolean onJsAlert(WebView view, String url, String message, JsResult result) &#123; return false;&#125; å½“ç½‘é¡µè°ƒç”¨alert()æ¥å¼¹å‡ºalertå¼¹å‡ºæ¡†å‰å›è°ƒï¼Œç”¨ä»¥æ‹¦æˆªalert()å‡½æ•° 1234public boolean onJsConfirm(WebView view, String url, String message, JsResult result) &#123; return false;&#125; å¸¦æœ‰ç¡®å®šå–æ¶ˆæç¤ºï¼Œå½“ç½‘é¡µè°ƒç”¨confirm()æ¥å¼¹å‡ºconfirmå¼¹å‡ºæ¡†å‰å›è°ƒï¼Œç”¨ä»¥æ‹¦æˆªconfirm()å‡½æ•° 1234public boolean onJsPrompt(WebView view, String url, String message, String defaultValue, JsPromptResult result) &#123; return false;&#125; å¸¦æœ‰è¾“å…¥æ¡†çš„å¼¹çª—ï¼Œå½“ç½‘é¡µè°ƒç”¨prompt()æ¥å¼¹å‡ºpromptå¼¹å‡ºæ¡†å‰å›è°ƒï¼Œç”¨ä»¥æ‹¦æˆªprompt()å‡½æ•° å¤„ç†JSå¼¹æ¡†é¦–å…ˆéœ€è¦è®¾ç½®JavaScriptæ”¯æŒï¼Œä¹Ÿå¿…é¡»è®¾ç½®WebChromeClient. å‚æ•° url:page_with_curl:ï¼šå¼¹å‡ºå¯¹è¯æ¡†çš„ç½‘é¡µç½‘å€ message:speech_balloon::å¯¹è¯æ¡†çš„å†…å®¹ result:closed_umbrella:: è¿”å›ç»™JavaScriptçš„å“åº”ï¼ŒJsResult.confirm()è¡¨ç¤ºç‚¹å‡»äº†å¼¹å‡ºæ¡†çš„ç¡®å®šæŒ‰é’®ï¼ŒJsResult.cancel()åˆ™è¡¨ç¤ºç‚¹å‡»äº†å¼¹å‡ºæ¡†çš„å–æ¶ˆæŒ‰é’®ã€‚å…¶ä¸­JsPromptResultä¹Ÿæ˜¯ç»§æ‰¿JsResultçš„ï¼Œåªæ˜¯å¤šäº†è¾“å…¥çš„å†…å®¹å˜é‡ (String mStringResult) è¿”å›å€¼ true Native è‡ªè¡Œå¤„ç†å¼¹çª—é€»è¾‘ï¼Œä¸å¼¹å‡ºalertå¼¹çª—äº† false WebView è‡ªè¡Œå¼¹å‡ºalertå¯¹è¯æ¡†å¤„ç† å¦‚æœæ˜¯return trueï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨è°ƒç”¨JsResultçš„.confirm()æˆ–.cancel()æ–¹æ³•ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰è°ƒç”¨JsResultçš„confirm()æˆ–cancel()æ¥å‘Šè¯‰WebViewä½ çš„å¤„ç†ç»“æœï¼Œåˆ™WebViewå°±ä¼šè®¤ä¸ºè¿™ä¸ªå¼¹å‡ºæ¡†è¿˜ä¸€ç›´å¼¹åœ¨é‚£é‡Œï¼ˆè™½ç„¶æ­¤æ—¶æ ¹æœ¬æ²¡æœ‰å¼¹æ¡†å¼¹å‡ºï¼‰ï¼Œæ‰€ä»¥ä¹‹åä½ å†ç‚¹å‡»alertæŒ‰é’®æ—¶ï¼Œå°†ä¼šæ— æ•ˆã€‚è¿™ä¸€ç‚¹ä¸€å®šè¦æ³¨æ„ã€‚ æ‰“å¼€å’Œå…³é—­Window1234public boolean onCreateWindow(WebView view, boolean isDialog, boolean isUserGesture, Message resultMsg) &#123; return false;&#125; è¿™ä¸ªæ–¹æ³•å›è°ƒçš„å‰æéœ€è¦è®¾ç½®WebViewå¤šçª—å£æ”¯æŒï¼Œå°±æ˜¯æµè§ˆå™¨çš„å¤šä¸ªtab 1webSettings.setSupportMultipleWindows(true);//æ”¯æŒå¤šçª—å£ã€‚å¦‚æœè®¾ç½®ä¸ºtrue åœ¨Htmlä¸­ï¼Œè¶…çº§é“¾æ¥æ ‡ç­¾aé‡Œæœ‰ä¸€ä¸ªtargetå±æ€§ï¼Œå…¶æ„ä¹‰æ˜¯å†³å®šâ€æ˜¯å¦åœ¨æ–°çª—å£/æ ‡ç­¾é¡µä¸­æ‰“å¼€é“¾æ¥â€ï¼Œå¦‚æœä¸å†™target=â€_blankâ€é‚£ä¹ˆå°±æ˜¯åœ¨ç›¸åŒçš„æ ‡ç­¾é¡µæ‰“å¼€ï¼Œå¦‚æœå†™äº†ï¼Œå°±æ˜¯åœ¨æ–°çš„ç©ºç™½æ ‡ç­¾é¡µä¸­æ‰“å¼€ã€‚æ¯”å¦‚ï¼š 1&lt;a href=\"https://www.taobao.com/\" title=\"æ·˜å®\" target=\"_blank\"&gt;æ–°çª—å£æ‰“å¼€é“¾æ¥&lt;/a&gt; WebViewé»˜è®¤æ˜¯ä¸æ”¯æŒtargetï¼Œç‚¹å‡»ä¸Šé¢çš„é“¾æ¥ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ã€‚ å®Œæ•´é€»è¾‘å¦‚ä¸‹ æ²¡æœ‰è®¾ç½®setSupportMultipleWindowså±æ€§ä¸ºtrue æ²¡æœ‰setWebChromeClientï¼šç‚¹å‡»æ­¤é“¾æ¥ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ æœ‰setWebChromeClientï¼šç‚¹å‡»æ­¤é“¾æ¥ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ï¼Œä¸ä¼šå›è°ƒonCreateWindowæ–¹æ³• æœ‰è®¾ç½®setSupportMultipleWindowså±æ€§ä¸ºtrue æ²¡æœ‰setWebChromeClientï¼šç‚¹å‡»æ­¤é“¾æ¥ä¸ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ æœ‰setWebChromeClient æ²¡æœ‰é‡å†™onCreateWindowæ–¹æ³•ï¼šç‚¹å‡»æ­¤é“¾æ¥ä¸ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ï¼Œä¼šå›è°ƒonCreateWindowæ–¹æ³• æœ‰é‡å†™onCreateWindowæ–¹æ³•ï¼šç‚¹å‡»æ­¤é“¾æ¥ä¸ä¼šåœ¨å½“å‰WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ï¼Œä¼šå›è°ƒonCreateWindowæ–¹æ³•ï¼Œä¼šåœ¨ä½ æ–°åˆ›å»ºçš„WebViewä¸­æ‰“å¼€æ­¤é“¾æ¥ 1234567891011121314151617181920@Overridepublic boolean onCreateWindow(WebView webView, boolean isDialog, boolean isUserGesture, Message resultMsg) &#123; Log.i(\"bqt\", \"ã€onCreateWindowã€‘ \" + isDialog + \" \" + isUserGesture + \"\\nè¯¦ç»†ä¿¡æ¯\" + resultMsg.toString()); if (activity != null) &#123; WebView childView = new WebView(activity);//Parent WebView cannot host it's own popup window. childView.setBackgroundColor(Color.GREEN); childView.setWebViewClient(new WebViewClient() &#123; @Override public boolean shouldOverrideUrlLoading(WebView view, String url) &#123; Log.i(\"bqt\", \"ã€shouldOverrideUrlLoading-å­ã€‘\"); activity.startActivity(new Intent(Intent.ACTION_VIEW, Uri.parse(url))); return true; &#125; &#125;); WebView.WebViewTransport transport = (WebView.WebViewTransport) resultMsg.obj; transport.setWebView(childView);//setWebViewå’ŒgetWebViewä¸¤ä¸ªæ–¹æ³• resultMsg.sendToTarget(); return true; &#125; else return super.onCreateWindow(webView, isDialog, isUserGesture, resultMsg);//é»˜è®¤æ˜¯returns false&#125; æ„Ÿè§‰æµè§ˆå™¨æ‰ä¼šç”¨åˆ°è¿™ä¸ªAPI,å¸¸è§„åº”ç”¨åŸºæœ¬éƒ½æ˜¯æ‰“å¼€è‡ªå·±å®šåˆ¶çš„Htmlé¡µé¢ å¯¹åº”çš„è¿˜æœ‰ä¸€ä¸ªå…³é—­Windowçš„APIï¼Œåœ¨JSè°ƒç”¨window.close()æ–¹æ³•æ—¶ä¼šå›è°ƒæ­¤æ–¹æ³•ã€å…³é—­çª—å£ã€‘ 1public void onCloseWindow(WebView window) &#123;&#125; æ–‡ä»¶é€‰æ‹©å™¨è¿™ä¸ªæ–¹æ³•åœ¨é¡¹ç›®ä¸­å¾ˆå¸¸ç”¨ï¼ŒHtmlä¸­å¦‚æœéœ€è¦é€‰æ‹©æœ¬æœºæ–‡ä»¶å°±éœ€è¦æŠŠæ–‡ä»¶ä¼ è¿‡å»ã€‚åŸºæœ¬æ“ä½œä¸ºæ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨å†æŠŠé€‰æ‹©çš„æ–‡ä»¶ä¼ åˆ°ç½‘é¡µä¸­ã€‚æˆ‘ä¹Ÿæœ‰ç”¨åˆ°ï¼Œå°±è´´ä¸€ä¸‹å®Œæ•´çš„ä»£ç ç‰‡æ®µã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364//For Android &gt;= 4.1public void openFileChooser(ValueCallback&lt;Uri&gt; valueCallback, String acceptType, String capture) &#123; uploadMessage = valueCallback; openImageChooserActivity();&#125;// For Android &gt;= 5.0@Overridepublic boolean onShowFileChooser(WebView webView, ValueCallback&lt;Uri[]&gt; filePathCallback, WebChromeClient.FileChooserParams fileChooserParams) &#123; uploadMessageAboveL = filePathCallback; Intent i = new Intent(Intent.ACTION_GET_CONTENT); i.addCategory(Intent.CATEGORY_OPENABLE); if (fileChooserParams != null &amp;&amp; fileChooserParams.getAcceptTypes() != null &amp;&amp; fileChooserParams.getAcceptTypes().length &gt; 0) &#123; i.setType(fileChooserParams.getAcceptTypes()[0]); &#125; else &#123; i.setType(\"*/*\"); &#125; startActivityForResult(Intent.createChooser(i, \"File Chooser\"), FILECHOOSER_RESULTCODE); return true;&#125; @Override protected void onActivityResult(int requestCode, int resultCode, Intent data) &#123; super.onActivityResult(requestCode, resultCode, data); if (requestCode == FILE_CHOOSER_RESULT_CODE) &#123; if (null == uploadMessage &amp;&amp; null == uploadMessageAboveL) &#123; return; &#125; Uri result = data == null || resultCode != RESULT_OK ? null : data.getData(); if (uploadMessageAboveL != null) &#123; onActivityResultAboveL(requestCode, resultCode, data); &#125; else if (uploadMessage != null) &#123; uploadMessage.onReceiveValue(result); uploadMessage = null; &#125; &#125; &#125; @TargetApi(Build.VERSION_CODES.LOLLIPOP) private void onActivityResultAboveL(int requestCode, int resultCode, Intent intent) &#123; if (requestCode != FILE_CHOOSER_RESULT_CODE || uploadMessageAboveL == null) &#123; return; &#125; Uri[] results = null; if (resultCode == Activity.RESULT_OK) &#123; if (intent != null) &#123; String dataString = intent.getDataString(); ClipData clipData = intent.getClipData(); if (clipData != null) &#123; results = new Uri[clipData.getItemCount()]; for (int i = 0; i &lt; clipData.getItemCount(); i++) &#123; ClipData.Item item = clipData.getItemAt(i); results[i] = item.getUri(); &#125; &#125; if (dataString != null) &#123; results = new Uri[]&#123;Uri.parse(dataString)&#125;; &#125; &#125; &#125; uploadMessageAboveL.onReceiveValue(results); uploadMessageAboveL = null; &#125; @params filePathCallback: æä¾›è¦ä¸Šä¼ çš„æ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨, or NULL to cancel. Must only be called if the showFileChooser implementations returns true. @params fileChooserParams: æè¿°è¦æ‰“å¼€çš„æ–‡ä»¶é€‰æ‹©å™¨çš„æ¨¡å¼ï¼Œä»¥åŠä¸ä¹‹ä¸€èµ·ä½¿ç”¨çš„é€‰é¡¹ã€‚ è§†é¢‘(å…¨å±)æ’­æ”¾123public Bitmap getDefaultVideoPoster() &#123; return null;&#125; Htmlä¸­ï¼Œè§†é¢‘ï¼ˆvideoï¼‰æ§ä»¶åœ¨æ²¡æœ‰æ’­æ”¾çš„æ—¶å€™å°†ç»™ç”¨æˆ·å±•ç¤ºä¸€å¼ â€œæµ·æŠ¥â€å›¾ç‰‡ï¼ˆé¢„è§ˆå›¾ï¼‰ã€‚å…¶é¢„è§ˆå›¾æ˜¯ç”±Htmlä¸­videoæ ‡ç­¾çš„posterå±æ€§æ¥æŒ‡å®šçš„ã€‚å¦‚æœå¼€å‘è€…æ²¡æœ‰è®¾ç½®posterå±æ€§, åˆ™å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è®¾ç½®é»˜è®¤çš„é¢„è§ˆå›¾ã€‚ 12345&lt;video controls poster=\"/images/w3school.gif\"&gt; &lt;source src=\"movie.mp4\" type=\"video/mp4\"&gt; &lt;source src=\"movie.ogg\" type=\"video/ogg\"&gt; Your browser does not support the video tag.&lt;/video&gt; 123public View getVideoLoadingProgressView() &#123; return null;&#125; æ’­æ”¾è§†é¢‘æ—¶ï¼Œåœ¨ç¬¬ä¸€å¸§å‘ˆç°ä¹‹å‰ï¼Œéœ€è¦èŠ±ä¸€å®šçš„æ—¶é—´æ¥è¿›è¡Œæ•°æ®ç¼“å†²ã€‚ChromeClientå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥æä¾›ä¸€ä¸ªåœ¨æ•°æ®ç¼“å†²æ—¶æ˜¾ç¤ºçš„è§†å›¾ã€‚ ä¾‹å¦‚,ChromeClientå¯ä»¥åœ¨ç¼“å†²æ—¶æ˜¾ç¤ºä¸€ä¸ªè½¬è½®åŠ¨ç”»ã€‚ 12public void onShowCustomView(View view, CustomViewCallback callback) &#123;&#125;;public void onHideCustomView() &#123;&#125; é€šçŸ¥ä¸»æœºåº”ç”¨webviewéœ€è¦æ˜¾ç¤ºä¸€ä¸ªcustom viewï¼Œä¸»è¦æ˜¯ç”¨åœ¨è§†é¢‘å…¨å± HTML5 Video supportã€‚ ç½‘é¡µä¸­æœ‰H5æ’­æ”¾flash videoçš„æ—¶å€™æŒ‰ä¸‹å…¨å±æŒ‰é’®å°†ä¼šè°ƒç”¨åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œä¸€èˆ¬ç”¨ä½œè®¾ç½®ç½‘é¡µæ’­æ”¾å…¨å±æ“ä½œã€‚ è·å–åœ°ç†ä½ç½®123public void onGeolocationPermissionsShowPrompt(String origin, GeolocationPermissions.Callback callback) &#123;&#125;public void onGeolocationPermissionsHidePrompt() &#123;&#125; 12345678910111213141516171819public class GeolocationPermissions &#123; /** * A callback interface used by the host application to set the Geolocation * permission state for an origin. */ public interface Callback &#123; /** * Sets the Geolocation permission state for the supplied origin. * * @param origin the origin for which permissions are set * @param allow whether or not the origin should be allowed to use the * Geolocation API * @param retain whether the permission should be retained beyond the * lifetime of a page currently being displayed by a * WebView */ public void invoke(String origin, boolean allow, boolean retain); &#125;;&#125; JavaScriptä¸­æœ‰è°ƒç”¨å®šä½çš„APIæ—¶ä¼šè°ƒç”¨æœ¬æ–¹æ³• @param origin æ¥æºï¼Œè°è°ƒç”¨çš„ï¼Œä¼ å›ç»™è° @param allow æ˜¯å¦å…è®¸æœ¬æ¬¡å®šä½ @param retain æ˜¯å¦ä¿æŒå…è®¸å®šä½çŠ¶æ€ï¼Œä¼ é€’äº†trueåï¼Œæœ¬WebViewä¹‹åéƒ½å¯ä»¥è·å¾—å½“å‰ä½ç½®ä¿¡æ¯ã€‚ å¯¹åº”çš„onGeolocationPermissionsHidePromptï¼ˆï¼‰å°±æ˜¯é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåœ°ç†ä½ç½®æƒé™è¯·æ±‚å·²è¢«å–æ¶ˆ è¯·æ±‚æƒé™123456789101112131415161718192021 /** * Notify the host application that web content is requesting permission to * access the specified resources and the permission currently isn't granted * or denied. The host application must invoke &#123;@link PermissionRequest#grant(String[])&#125; * or &#123;@link PermissionRequest#deny()&#125;. * * If this method isn't overridden, the permission is denied. * * @param request the PermissionRequest from current web content. */public void onPermissionRequest(PermissionRequest request) &#123; request.deny();&#125;/** * Notify the host application that the given permission request * has been canceled. Any related UI should therefore be hidden. * * @param request the PermissionRequest that needs be canceled. */public void onPermissionRequestCanceled(PermissionRequest request) &#123;&#125; 1234567891011public abstract class PermissionRequest &#123; public final static String RESOURCE_VIDEO_CAPTURE = \"android.webkit.resource.VIDEO_CAPTURE\"; public final static String RESOURCE_AUDIO_CAPTURE = \"android.webkit.resource.AUDIO_CAPTURE\"; public final static String RESOURCE_PROTECTED_MEDIA_ID = \"android.webkit.resource.PROTECTED_MEDIA_ID\"; public final static String RESOURCE_MIDI_SYSEX = \"android.webkit.resource.MIDI_SYSEX\"; public abstract Uri getOrigin(); public abstract String[] getResources(); public abstract void grant(String[] resources); public abstract void deny();&#125; @method getorigin()è·å–æ¥æº @method getResources()è·å–è¯·æ±‚çš„æƒé™åˆ—è¡¨ @method grant ()å…è®¸çš„æƒé™åˆ—è¡¨ @method deny()æ‹’ç»äº†æƒé™ éœ€è¦çš„å°±æ˜¯PermissRequestä¸­å®šä¹‰çš„å››ä¸ªå¸¸äº®ä»£è¡¨çš„æƒé™ï¼Œå…³äºæƒé™çš„ä½¿ç”¨æ˜¯å…¶ä»–çŸ¥è¯†ç‚¹ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹è¿™ä¸ªæ —å­ã€‚ å…¶ä»–æ–¹æ³•123456789/** *è·å¾—æ‰€æœ‰è®¿é—®å†å²é¡¹ç›®çš„åˆ—è¡¨ï¼Œç”¨äºé“¾æ¥ç€è‰²ã€‚ */public void getVisitedHistory(ValueCallback&lt;String[]&gt; callback) &#123;&#125;/** *webviewè¯·æ±‚å¾—åˆ°ç„¦ç‚¹ï¼Œå‘ç”Ÿè¿™ä¸ªä¸»è¦æ˜¯å½“å‰webviewä¸æ˜¯å‰å°çŠ¶æ€ï¼Œæ˜¯åå°webviewã€‚ */public void onRequestFocus(WebView view) &#123;&#125;","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"}]},{"title":"Android WebViewå¿…çŸ¥å¿…ä¼š(2)-WebSettings","slug":"webview-learning-WebSettings","date":"2019-03-07T15:29:48.000Z","updated":"2019-03-23T06:16:15.385Z","comments":true,"path":"post/webview-learning-WebSettings/","link":"http://ncmon.com/post/webview-learning-WebSettings/","permalink":"http://ncmon.com/post/webview-learning-WebSettings/","excerpt":"ç®€ä»‹WebSettings çœ‹åç§°å°±æ˜æ˜¾äº†ï¼Œæ˜¯å¯¹WebViewçš„ä¸€äº›åŸºç¡€è®¾ç½®ï¼Œç½‘é¡µä¸­éœ€è¦çš„ä¸€äº›æ”¯æŒå‡éœ€è¦åœ¨WebSettings ä¸­è®¾ç½®ã€‚è·å–æ–¹å¼ä¹Ÿå¾ˆç®€å•,é€šè¿‡WebViewçš„æ–¹æ³•è·å¾—å³å¯ã€‚1234public WebSettings getSettings() &#123; checkThread(); return mProvider.getSettings();&#125;","text":"ç®€ä»‹WebSettings çœ‹åç§°å°±æ˜æ˜¾äº†ï¼Œæ˜¯å¯¹WebViewçš„ä¸€äº›åŸºç¡€è®¾ç½®ï¼Œç½‘é¡µä¸­éœ€è¦çš„ä¸€äº›æ”¯æŒå‡éœ€è¦åœ¨WebSettings ä¸­è®¾ç½®ã€‚è·å–æ–¹å¼ä¹Ÿå¾ˆç®€å•,é€šè¿‡WebViewçš„æ–¹æ³•è·å¾—å³å¯ã€‚1234public WebSettings getSettings() &#123; checkThread(); return mProvider.getSettings();&#125; è®°å½•ä¸‹å¯¹åº”çš„APIå«ä¹‰ï¼ŒåŸºæœ¬æ˜¯ç›´æ¥æ‰¾æ¥çš„ï¼Œå¤§éƒ¨åˆ†åœ¨é¡¹ç›®ç”¨æœ‰éªŒè¯ï¼Œå¦‚æœæœ‰ä½¿ç”¨åå·®ä¼šéšæ—¶å›æ¥ä¿®æ”¹ï¼Œå¤§å®¶å‚è€ƒä¸‹ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232/** * æ˜¯å¦æ”¯æŒç¼©æ”¾ï¼Œé…åˆæ–¹æ³•setBuiltInZoomControlsä½¿ç”¨ï¼Œé»˜è®¤true */setSupportZoom(boolean support) /** * æ˜¯å¦éœ€è¦ç”¨æˆ·æ‰‹åŠ¿æ¥æ’­æ”¾Mediaï¼Œé»˜è®¤true */setMediaPlaybackRequiresUserGesture(boolean require) /** * æ˜¯å¦ä½¿ç”¨WebViewå†…ç½®çš„ç¼©æ”¾ç»„ä»¶ï¼Œç”±æµ®åŠ¨åœ¨çª—å£ä¸Šçš„ç¼©æ”¾æ§åˆ¶å’Œæ‰‹åŠ¿ç¼©æ”¾æ§åˆ¶ç»„æˆï¼Œé»˜è®¤false */setBuiltInZoomControls(boolean enabled) /** * æ˜¯å¦æ˜¾ç¤ºçª—å£æ‚¬æµ®çš„ç¼©æ”¾æ§åˆ¶ï¼Œé»˜è®¤true */setDisplayZoomControls(boolean enabled) /** * æ˜¯å¦å…è®¸è®¿é—®WebViewå†…éƒ¨æ–‡ä»¶ï¼Œé»˜è®¤true */setAllowFileAccess(boolean allow) /** * æ˜¯å¦å…è®¸è·å–WebViewçš„å†…å®¹URL ï¼Œå¯ä»¥è®©WebViewè®¿é—®ContentPrividerå­˜å‚¨çš„å†…å®¹ã€‚ é»˜è®¤true */setAllowContentAccess(boolean allow) /** * æ˜¯å¦å¯åŠ¨æ¦‚è¿°æ¨¡å¼æµè§ˆç•Œé¢ï¼Œå½“é¡µé¢å®½åº¦è¶…è¿‡WebViewæ˜¾ç¤ºå®½åº¦æ—¶ï¼Œç¼©å°é¡µé¢é€‚åº”WebViewã€‚é»˜è®¤false */setLoadWithOverviewMode(boolean overview) /** * æ˜¯å¦ä¿å­˜è¡¨å•æ•°æ®ï¼Œé»˜è®¤false */setSaveFormData(boolean save) /** * è®¾ç½®é¡µé¢æ–‡å­—ç¼©æ”¾ç™¾åˆ†æ¯”ï¼Œé»˜è®¤100% */setTextZoom(int textZoom) /** * æ˜¯å¦æ”¯æŒViewPortçš„meta tagå±æ€§ï¼Œå¦‚æœé¡µé¢æœ‰ViewPort meta tag æŒ‡å®šçš„å®½åº¦ï¼Œåˆ™ä½¿ç”¨meta tagæŒ‡å®šçš„å€¼ï¼Œå¦åˆ™é»˜è®¤ä½¿ç”¨å®½å±çš„è§†å›¾çª—å£ */setUseWideViewPort(boolean use) /** * æ˜¯å¦æ”¯æŒå¤šçª—å£ï¼Œå¦‚æœè®¾ç½®ä¸ºtrue ï¼ŒWebChromeClient#onCreateWindowæ–¹æ³•å¿…é¡»è¢«ä¸»ç¨‹åºå®ç°ï¼Œé»˜è®¤false */setSupportMultipleWindows(boolean support) /** * æŒ‡å®šWebViewçš„é¡µé¢å¸ƒå±€æ˜¾ç¤ºå½¢å¼ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ä¼šå¼•èµ·é¡µé¢é‡ç»˜ã€‚é»˜è®¤LayoutAlgorithm#NARROW_COLUMNS */setLayoutAlgorithm(LayoutAlgorithm l) /** * è®¾ç½®æ ‡å‡†çš„å­—ä½“æ—ï¼Œé»˜è®¤â€sans-serifâ€ã€‚font-family è§„å®šå…ƒç´ çš„å­—ä½“ç³»åˆ—ã€‚ * font-family å¯ä»¥æŠŠå¤šä¸ªå­—ä½“åç§°ä½œä¸ºä¸€ä¸ªâ€œå›é€€â€ç³»ç»Ÿæ¥ä¿å­˜ã€‚å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒç¬¬ä¸€ä¸ªå­—ä½“ï¼Œ * åˆ™ä¼šå°è¯•ä¸‹ä¸€ä¸ªã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œfont-family å±æ€§çš„å€¼æ˜¯ç”¨äºæŸä¸ªå…ƒç´ çš„å­—ä½“æ—åç§°æˆ–/åŠç±»æ—åç§°çš„ä¸€ä¸ª * ä¼˜å…ˆè¡¨ã€‚æµè§ˆå™¨ä¼šä½¿ç”¨å®ƒå¯è¯†åˆ«çš„ç¬¬ä¸€ä¸ªå€¼ã€‚ */setStandardFontFamily(String font) /** * è®¾ç½®æ··åˆå­—ä½“æ—ã€‚é»˜è®¤â€monospaceâ€ */setFixedFontFamily(String font) /** * è®¾ç½®SansSerifå­—ä½“æ—ã€‚é»˜è®¤â€sans-serifâ€ */setSansSerifFontFamily(String font) /** * è®¾ç½®SerifFontå­—ä½“æ—ï¼Œé»˜è®¤â€sans-serifâ€ */setSerifFontFamily(String font) /** * è®¾ç½®CursiveFontå­—ä½“æ—ï¼Œé»˜è®¤â€cursiveâ€ */setCursiveFontFamily(String font) /** * è®¾ç½®FantasyFontå­—ä½“æ—ï¼Œé»˜è®¤â€fantasyâ€ */setFantasyFontFamily(String font) /** * è®¾ç½®æœ€å°å­—ä½“ï¼Œé»˜è®¤8. å–å€¼åŒºé—´[1-72]ï¼Œè¶…è¿‡èŒƒå›´ï¼Œä½¿ç”¨å…¶ä¸Šé™å€¼ã€‚ */setMinimumFontSize(int size) /** * è®¾ç½®æœ€å°é€»è¾‘å­—ä½“ï¼Œé»˜è®¤8. å–å€¼åŒºé—´[1-72]ï¼Œè¶…è¿‡èŒƒå›´ï¼Œä½¿ç”¨å…¶ä¸Šé™å€¼ã€‚ */setMinimumLogicalFontSize(int size) /** * è®¾ç½®é»˜è®¤å­—ä½“å¤§å°ï¼Œé»˜è®¤16ï¼Œå–å€¼åŒºé—´[1-72]ï¼Œè¶…è¿‡èŒƒå›´ï¼Œä½¿ç”¨å…¶ä¸Šé™å€¼ã€‚ */setDefaultFontSize(int size) /** * è®¾ç½®é»˜è®¤å¡«å……å­—ä½“å¤§å°ï¼Œé»˜è®¤16ï¼Œå–å€¼åŒºé—´[1-72]ï¼Œè¶…è¿‡èŒƒå›´ï¼Œä½¿ç”¨å…¶ä¸Šé™å€¼ã€‚ */setDefaultFixedFontSize(int size) /** * è®¾ç½®æ˜¯å¦åŠ è½½å›¾ç‰‡èµ„æºï¼Œæ³¨æ„ï¼šæ–¹æ³•æ§åˆ¶æ‰€æœ‰çš„èµ„æºå›¾ç‰‡æ˜¾ç¤ºï¼ŒåŒ…æ‹¬åµŒå…¥çš„æœ¬åœ°å›¾ç‰‡èµ„æºã€‚ * ä½¿ç”¨æ–¹æ³•setBlockNetworkImageåˆ™åªé™åˆ¶ç½‘ç»œèµ„æºå›¾ç‰‡çš„æ˜¾ç¤ºã€‚å€¼è®¾ç½®ä¸ºtrueåï¼Œ * webviewä¼šè‡ªåŠ¨åŠ è½½ç½‘ç»œå›¾ç‰‡ã€‚é»˜è®¤true */setLoadsImagesAutomatically(boolean flag) /** * æ˜¯å¦åŠ è½½ç½‘ç»œå›¾ç‰‡èµ„æºã€‚æ³¨æ„å¦‚æœgetLoadsImagesAutomaticallyè¿”å›falseï¼Œåˆ™è¯¥æ–¹æ³•æ²¡æœ‰æ•ˆæœã€‚ * å¦‚æœä½¿ç”¨setBlockNetworkLoadsè®¾ç½®ä¸ºfalseï¼Œè¯¥æ–¹æ³•è®¾ç½®ä¸ºfalseï¼Œä¹Ÿä¸ä¼šæ˜¾ç¤ºç½‘ç»œå›¾ç‰‡ã€‚ * å½“å€¼ä»trueæ”¹ä¸ºfalseæ—¶ã€‚WebViewä¼šè‡ªåŠ¨åŠ è½½ç½‘ç»œå›¾ç‰‡ã€‚ */setBlockNetworkImage(boolean flag) /** * è®¾ç½®æ˜¯å¦åŠ è½½ç½‘ç»œèµ„æºã€‚æ³¨æ„å¦‚æœå€¼ä»trueåˆ‡æ¢ä¸ºfalseåï¼ŒWebViewä¸ä¼šè‡ªåŠ¨åŠ è½½ï¼Œ * é™¤éè°ƒç”¨WebView#reload().å¦‚æœæ²¡æœ‰android.Manifest.permission#INTERNETæƒé™ï¼Œ * å€¼è®¾ä¸ºfalseï¼Œåˆ™ä¼šæŠ›å‡ºjava.lang.SecurityExceptionå¼‚å¸¸ã€‚ * é»˜è®¤å€¼ï¼šæœ‰android.Manifest.permission#INTERNETæƒé™æ—¶ä¸ºfalseï¼Œå…¶ä»–ä¸ºtrueã€‚ */setBlockNetworkLoads(boolean flag) /** * è®¾ç½®æ˜¯å¦å…è®¸æ‰§è¡ŒJSã€‚ */setJavaScriptEnabled(boolean flag) /** * æ˜¯å¦å…è®¸Jsè®¿é—®ä»»ä½•æ¥æºçš„å†…å®¹ã€‚åŒ…æ‹¬è®¿é—®file schemeçš„URLsã€‚è€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œ * é™åˆ¶Jsè®¿é—®èŒƒå›´é»˜è®¤ç¦ç”¨ã€‚æ³¨æ„ï¼šè¯¥æ–¹æ³•åªå½±å“file schemeç±»å‹çš„èµ„æºï¼Œå…¶ä»–ç±»å‹èµ„æºå¦‚å›¾ç‰‡ç±»å‹çš„ï¼Œ * ä¸ä¼šå—åˆ°å½±å“ã€‚ICE_CREAM_SANDWICH_MR1ç‰ˆæœ¬ä»¥åŠä»¥ä¸‹é»˜è®¤ä¸ºtrueï¼ŒJELLY_BEANç‰ˆæœ¬ * ä»¥ä¸Šé»˜è®¤ä¸ºfalse */setAllowUniversalAccessFromFileURLs(boolean flag) /** * æ˜¯å¦å…è®¸Jsè®¿é—®å…¶ä»–file schemeçš„URLsã€‚åŒ…æ‹¬è®¿é—®file schemeçš„èµ„æºã€‚è€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œ * é™åˆ¶Jsè®¿é—®èŒƒå›´é»˜è®¤ç¦ç”¨ã€‚æ³¨æ„ï¼šè¯¥æ–¹æ³•åªå½±å“file schemeç±»å‹çš„èµ„æºï¼Œå…¶ä»–ç±»å‹èµ„æºå¦‚å›¾ç‰‡ç±»å‹çš„ï¼Œ * ä¸ä¼šå—åˆ°å½±å“ã€‚å¦‚æœgetAllowUniversalAccessFromFileURLsä¸ºtrueï¼Œåˆ™è¯¥æ–¹æ³•è¢«å¿½ç•¥ã€‚ * ICE_CREAM_SANDWICH_MR1ç‰ˆæœ¬ä»¥åŠä»¥ä¸‹é»˜è®¤ä¸ºtrueï¼ŒJELLY_BEANç‰ˆæœ¬ä»¥ä¸Šé»˜è®¤ä¸ºfalse */setAllowFileAccessFromFileURLs(boolean flag) /** * è®¾ç½®å­˜å‚¨å®šä½æ•°æ®åº“çš„ä½ç½®ï¼Œè€ƒè™‘åˆ°ä½ç½®æƒé™å’ŒæŒä¹…åŒ–Cacheç¼“å­˜ï¼ŒApplicationéœ€è¦æ‹¥æœ‰æŒ‡å®šè·¯å¾„çš„ * writeæƒé™ */setGeolocationDatabasePath(String databasePath) /** * æ˜¯å¦å…è®¸Cacheï¼Œé»˜è®¤falseã€‚è€ƒè™‘éœ€è¦å­˜å‚¨ç¼“å­˜ï¼Œåº”è¯¥ä¸ºç¼“å­˜æŒ‡å®šå­˜å‚¨è·¯å¾„setAppCachePath */setAppCacheEnabled(boolean flag) /** * è®¾ç½®Cache APIç¼“å­˜è·¯å¾„ã€‚ä¸ºäº†ä¿è¯å¯ä»¥è®¿é—®Cacheï¼ŒApplicationéœ€è¦æ‹¥æœ‰æŒ‡å®šè·¯å¾„çš„writeæƒé™ã€‚ * è¯¥æ–¹æ³•åº”è¯¥åªè°ƒç”¨ä¸€æ¬¡ï¼Œå¤šæ¬¡è°ƒç”¨è‡ªåŠ¨å¿½ç•¥ã€‚ */setAppCachePath(String appCachePath) /** * æ˜¯å¦å…è®¸æ•°æ®åº“å­˜å‚¨ã€‚é»˜è®¤falseã€‚æŸ¥çœ‹setDatabasePath API å¦‚ä½•æ­£ç¡®è®¾ç½®æ•°æ®åº“å­˜å‚¨ã€‚ * è¯¥è®¾ç½®æ‹¥æœ‰å…¨å±€ç‰¹æ€§ï¼ŒåŒä¸€è¿›ç¨‹æ‰€æœ‰WebViewå®ä¾‹å…±ç”¨åŒä¸€é…ç½®ã€‚æ³¨æ„ï¼šä¿è¯åœ¨åŒä¸€è¿›ç¨‹çš„ä»»ä¸€WebView * åŠ è½½é¡µé¢ä¹‹å‰ä¿®æ”¹è¯¥å±æ€§ï¼Œå› ä¸ºåœ¨è¿™ä¹‹åè®¾ç½®WebViewå¯èƒ½ä¼šå¿½ç•¥è¯¥é…ç½® */setDatabaseEnabled(boolean flag) /** * æ˜¯å¦å­˜å‚¨é¡µé¢DOMç»“æ„ï¼Œé»˜è®¤falseã€‚ */setDomStorageEnabled(boolean flag) /** * æ˜¯å¦å…è®¸å®šä½ï¼Œé»˜è®¤trueã€‚æ³¨æ„ï¼šä¸ºäº†ä¿è¯å®šä½å¯ä»¥ä½¿ç”¨ï¼Œè¦ä¿è¯ä»¥ä¸‹å‡ ç‚¹ï¼š * Application éœ€è¦æœ‰android.Manifest.permission#ACCESS_COARSE_LOCATIONçš„æƒé™ * Application éœ€è¦å®ç°WebChromeClient#onGeolocationPermissionsShowPromptçš„å›è°ƒï¼Œ * æ¥æ”¶Jså®šä½è¯·æ±‚è®¿é—®åœ°ç†ä½ç½®çš„é€šçŸ¥ */setGeolocationEnabled(boolean flag) /** * æ˜¯å¦å…è®¸JSè‡ªåŠ¨æ‰“å¼€çª—å£ã€‚é»˜è®¤false */setJavaScriptCanOpenWindowsAutomatically(boolean flag) /** * è®¾ç½®é¡µé¢çš„ç¼–ç æ ¼å¼ï¼Œé»˜è®¤UTF-8 */setDefaultTextEncodingName(String encoding) /** * è®¾ç½®WebViewä»£ç†ï¼Œé»˜è®¤ä½¿ç”¨é»˜è®¤å€¼ */setUserAgentString(String ua) /** * é€šçŸ¥WebViewæ˜¯å¦éœ€è¦è®¾ç½®ä¸€ä¸ªèŠ‚ç‚¹è·å–ç„¦ç‚¹å½“ * WebView#requestFocus(int,android.graphics.Rect)è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œé»˜è®¤true */setNeedInitialFocus(boolean flag) /** * åŸºäºWebViewå¯¼èˆªçš„ç±»å‹ä½¿ç”¨ç¼“å­˜ï¼šæ­£å¸¸é¡µé¢åŠ è½½ä¼šåŠ è½½ç¼“å­˜å¹¶æŒ‰éœ€åˆ¤æ–­å†…å®¹æ˜¯å¦éœ€è¦é‡æ–°éªŒè¯ã€‚ * å¦‚æœæ˜¯é¡µé¢è¿”å›ï¼Œé¡µé¢å†…å®¹ä¸ä¼šé‡æ–°åŠ è½½ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­æ¢å¤ã€‚setCacheModeå…è®¸å®¢æˆ·ç«¯æ ¹æ®æŒ‡å®šçš„æ¨¡å¼æ¥ * ä½¿ç”¨ç¼“å­˜ã€‚ * LOAD_DEFAULT é»˜è®¤åŠ è½½æ–¹å¼ * LOAD_CACHE_ELSE_NETWORK æŒ‰ç½‘ç»œæƒ…å†µä½¿ç”¨ç¼“å­˜ * LOAD_NO_CACHE ä¸ä½¿ç”¨ç¼“å­˜ * LOAD_CACHE_ONLY åªä½¿ç”¨ç¼“å­˜ */setCacheMode(int mode) /** * è®¾ç½®åŠ è½½ä¸å®‰å…¨èµ„æºçš„WebViewåŠ è½½è¡Œä¸ºã€‚KITKATç‰ˆæœ¬ä»¥åŠä»¥ä¸‹é»˜è®¤ä¸ºMIXED_CONTENT_ALWAYS_ALLOWæ–¹ * å¼ï¼ŒLOLLIPOPé»˜è®¤MIXED_CONTENT_NEVER_ALLOWã€‚å¼ºçƒˆå»ºè®®ï¼šä½¿ç”¨MIXED_CONTENT_NEVER_ALLOW */setMixedContentMode(int mode)","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"}]},{"title":"Android WebViewå¿…çŸ¥å¿…ä¼š(1)-WebViewClient","slug":"webview-learning-WebViewClient","date":"2019-02-23T06:27:48.000Z","updated":"2019-03-20T14:37:20.444Z","comments":true,"path":"post/webview-learning-WebViewClient/","link":"http://ncmon.com/post/webview-learning-WebViewClient/","permalink":"http://ncmon.com/post/webview-learning-WebViewClient/","excerpt":"é¡¹ç›®ä¸­é‡åˆ°äº†æ··åˆå¼€å‘æ€ä¹ˆåŠï¼Œä¸éœ€è¦æ…Œï¼ŒAndroidæä¾›çš„WebViewå·²ç»éå¸¸å¼ºå¤§ï¼Œå¯ä»¥å’Œå‰ç«¯åŒå­¦é…åˆå¥½å®Œæˆéå¸¸å¤šçš„äº‹æƒ…ã€‚é…åˆä¹‹å‰å‘¢å°±éœ€è¦å¯¹WebViewåšä¸€ä¸ªå…¨é¢çš„äº†è§£ï¼Œçœ‹çœ‹WebViewèƒ½åšäº›ä»€ä¹ˆï¼Œåˆæ€ä¹ˆå»åšè¿™äº›äº‹æƒ…ï¼Œåˆä¼šé‡åˆ°å“ªäº›é—®é¢˜ã€‚ WebViewç®€ä»‹ä»Android4.4ç³»ç»Ÿå¼€å§‹ï¼ŒChromiumå†…æ ¸å–ä»£äº†Webkitå†…æ ¸ï¼Œæ­£å¼åœ°æ¥ç®¡äº†WebViewçš„æ¸²æŸ“å·¥ä½œã€‚Chromiumæ˜¯ä¸€ä¸ªå¼€æºçš„æµè§ˆå™¨å†…æ ¸é¡¹ç›®ï¼ŒåŸºäºChromiumå¼€æºé¡¹ç›®ä¿®æ”¹å®ç°çš„æµè§ˆå™¨éå¸¸å¤šï¼ŒåŒ…æ‹¬æœ€è‘—åçš„Chromeæµè§ˆå™¨ï¼Œä»¥åŠä¸€ä¼—å›½å†…æµè§ˆå™¨ï¼ˆ360æµè§ˆå™¨ã€QQæµè§ˆå™¨ç­‰ï¼‰ã€‚å…¶ä¸­Chromiumåœ¨Androidä¸Šé¢çš„å®ç°æ˜¯Android System WebViewã€‚","text":"é¡¹ç›®ä¸­é‡åˆ°äº†æ··åˆå¼€å‘æ€ä¹ˆåŠï¼Œä¸éœ€è¦æ…Œï¼ŒAndroidæä¾›çš„WebViewå·²ç»éå¸¸å¼ºå¤§ï¼Œå¯ä»¥å’Œå‰ç«¯åŒå­¦é…åˆå¥½å®Œæˆéå¸¸å¤šçš„äº‹æƒ…ã€‚é…åˆä¹‹å‰å‘¢å°±éœ€è¦å¯¹WebViewåšä¸€ä¸ªå…¨é¢çš„äº†è§£ï¼Œçœ‹çœ‹WebViewèƒ½åšäº›ä»€ä¹ˆï¼Œåˆæ€ä¹ˆå»åšè¿™äº›äº‹æƒ…ï¼Œåˆä¼šé‡åˆ°å“ªäº›é—®é¢˜ã€‚ WebViewç®€ä»‹ä»Android4.4ç³»ç»Ÿå¼€å§‹ï¼ŒChromiumå†…æ ¸å–ä»£äº†Webkitå†…æ ¸ï¼Œæ­£å¼åœ°æ¥ç®¡äº†WebViewçš„æ¸²æŸ“å·¥ä½œã€‚Chromiumæ˜¯ä¸€ä¸ªå¼€æºçš„æµè§ˆå™¨å†…æ ¸é¡¹ç›®ï¼ŒåŸºäºChromiumå¼€æºé¡¹ç›®ä¿®æ”¹å®ç°çš„æµè§ˆå™¨éå¸¸å¤šï¼ŒåŒ…æ‹¬æœ€è‘—åçš„Chromeæµè§ˆå™¨ï¼Œä»¥åŠä¸€ä¼—å›½å†…æµè§ˆå™¨ï¼ˆ360æµè§ˆå™¨ã€QQæµè§ˆå™¨ç­‰ï¼‰ã€‚å…¶ä¸­Chromiumåœ¨Androidä¸Šé¢çš„å®ç°æ˜¯Android System WebViewã€‚ ä»Android5.0ç³»ç»Ÿå¼€å§‹ï¼ŒWebViewç§»æ¤æˆäº†ä¸€ä¸ªç‹¬ç«‹çš„apkï¼Œå¯ä»¥ä¸ä¾èµ–ç³»ç»Ÿè€Œç‹¬ç«‹å­˜åœ¨å’Œæ›´æ–°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿ-&gt;è®¾ç½®-&gt;Android System WebViewçœ‹åˆ°WebViewçš„å½“å‰ç‰ˆæœ¬ã€‚ ä»Android7.0ç³»ç»Ÿå¼€å§‹ï¼Œå¦‚æœç³»ç»Ÿå®‰è£…äº†Chrome (version&gt;51)ï¼Œé‚£ä¹ˆChromeå°†ä¼šç›´æ¥ä¸ºåº”ç”¨çš„WebViewæä¾›æ¸²æŸ“ï¼ŒWebViewç‰ˆæœ¬ä¼šéšç€Chromeçš„æ›´æ–°è€Œæ›´æ–°ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€‰æ‹©WebViewçš„æœåŠ¡æä¾›æ–¹ï¼ˆåœ¨å¼€å‘è€…é€‰é¡¹-&gt;WebView Implementationé‡Œï¼‰ï¼ŒWebViewå¯ä»¥è„±ç¦»åº”ç”¨ï¼Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ²™ç›’è¿›ç¨‹ä¸­æ¸²æŸ“é¡µé¢ï¼ˆéœ€è¦åœ¨å¼€å‘è€…é€‰é¡¹é‡Œæ‰“å¼€ï¼‰ã€‚ ä»Android8.0ç³»ç»Ÿå¼€å§‹ï¼Œé»˜è®¤å¼€å¯WebViewå¤šè¿›ç¨‹æ¨¡å¼ï¼Œå³WebViewè¿è¡Œåœ¨ç‹¬ç«‹çš„æ²™ç›’è¿›ç¨‹ä¸­ã€‚ WebViewClientæŠ›ç –WebViewåŠ è½½åœ¨çº¿ç½‘é¡µå¿…å¤‡ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œä¼šç›´æ¥è·³è½¬æ‰“å¼€æµè§ˆå™¨åº”ç”¨åŠ è½½ç½‘é¡µï¼åŒæ—¶åŒ…å«å¾ˆå¤šæœ‰ç”¨çš„å›è°ƒå‡½æ•°ã€‚ ä¸¾ä¸€ä¸ªå°æ —å­ï¼š é€šå¸¸åŠ è½½ä¸€ä¸ªç½‘é¡µéƒ½éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¸€ä¸ªloadingå‹å¥½æç¤ºä¸€ä¸‹ç”¨æˆ·ï¼Œæ­£åœ¨åŠ è½½ï¼ŒåŠ è½½å®Œæˆåéšè—å®ƒã€‚è¿™ä¸ªæ€ä¹ˆå®ç°å‘¢ï¼Œå°±éœ€è¦ç”¨åˆ°WebViewClientäº†ï¼ŒWebViewClientåŒ…å«äº†å¾ˆå¤šç½‘é¡µåŠ è½½éœ€è¦ç”¨åˆ°çš„å›è°ƒã€‚ 12345678910111213mWebView.setWebViewClient(new WebViewClient()&#123; @Override public void onPageStarted(WebView view, String url, Bitmap favicon) &#123; super.onPageStarted(view, url, favicon); Log.d(TAG,\"onPageStarted\"); &#125; @Override public void onPageFinished(WebView view, String url) &#123; super.onPageFinished(view, url); Log.d(TAG,\"onPageFinished\"); &#125;&#125;); WebView.setWebViewClientæ–¹æ³•è®¾ç½®WebViewClientå›è°ƒï¼Œé‡å†™äº†ä¸¤ä¸ªæ–¹æ³•ï¼ŒonPageStartedä¼šåœ¨åŠ è½½ç½‘é¡µæ—¶è°ƒç”¨ï¼ŒonPageFinishedå°±ä»£è¡¨åŠ è½½å®Œæˆäº†ã€‚åˆ©ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•å°±èƒ½å®Œæˆloadingçš„æ§åˆ¶ã€‚åœ¨onPageFinishedä¸­ä¹Ÿå¯ä»¥é€šè¿‡WebView.getTitleï¼ˆï¼‰å¯è·å¾—å½“å‰ç½‘é¡µåŠ è½½å®Œæ—¶çš„title(è¿™é‡ŒæŒ‡Htmlæ–‡ä»¶ä¸­headä¸­çš„title)ç­‰ï¼Œå½“ç„¶å¯¹æŸäº›ç½‘é¡µæ—¶ä¸å‡†çš„ï¼Œå› ä¸ºç½‘é¡µä¸­å¯èƒ½ä¼šé€šè¿‡JSä»£ç åŠ¨æ€çš„ä¿®æ”¹title,è¿™ä¸ªæ“ä½œæ˜¯åœ¨onPageFinish()ä¹‹åè¿›è¡Œçš„ï¼Œè¿™ä¸ªtitleåœ¨å¦å¤–çš„å‡½æ•°å¯ä»¥è·å–åˆ°ï¼Œæ€»ç»“WebChromeClientçš„æ—¶å€™ä¼šè®²åˆ°ã€‚ å¸¸ç”¨å‡½æ•°ç®€ä»‹ä¸ä¸€å®šå…¨éƒ½ä¼šç”¨åˆ°ï¼Œå…ˆå­¦ä¹ ä¸€ä¸‹ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ï¼Œä¼šæŒ‘å‡ ä¸ªéå¸¸å¸¸ç”¨çš„æ€»ç»“ä¸‹ä½¿ç”¨åœºæ™¯ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273/** * åœ¨å¼€å§‹åŠ è½½ç½‘é¡µæ—¶ä¼šå›è°ƒ */public void onPageStarted(WebView view, String url, Bitmap favicon) /** * åœ¨ç»“æŸåŠ è½½ç½‘é¡µæ—¶ä¼šå›è°ƒ */public void onPageFinished(WebView view, String url)/** * æ‹¦æˆª url è·³è½¬,åœ¨é‡Œè¾¹æ·»åŠ ç‚¹å‡»é“¾æ¥è·³è½¬æˆ–è€…æ“ä½œ */@Deprecatedpublic boolean shouldOverrideUrlLoading(WebView view, String url)//sdk&gt;=24 public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request)/** * åœ¨æ¯ä¸€æ¬¡è¯·æ±‚èµ„æºæ—¶ï¼Œéƒ½ä¼šé€šè¿‡è¿™ä¸ªå‡½æ•°æ¥å›è°ƒ,è¯·æ±‚èµ„æºçš„ä¸»æœºåº”ç”¨ç¨‹åºå…è®¸åº”ç”¨ç¨‹åºè¿”å›æ•°æ®ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å› * nullï¼ŒWebViewå°†ä¼šæŒ‰ç…§å¹³å¸¸ä¸€æ ·ç»§ç»­åŠ è½½ï¼›å¦åˆ™ï¼Œè¿”å›çš„å†…å®¹å°†ä¼šè¢«ä½¿ç”¨ã€‚è¯¥æ–¹æ³•åœ¨ç‹¬ç«‹çº¿ç¨‹è€ŒéUIçº¿ç¨‹ä¸­å› * è°ƒï¼Œå› æ­¤è®¿é—®ç§æœ‰æ•°æ®æˆ–ç³»ç»Ÿè§†å›¾æ—¶åº”è¯¥è°¨æ…è¡Œäº‹ã€‚ */@Deprecatedpublic WebResourceResponse shouldInterceptRequest(WebView view,String url) &#123; return null;&#125;public WebResourceResponse shouldInterceptRequest(WebView view,WebResourceRequest request) &#123; return shouldInterceptRequest(view, request.getUrl().toString());&#125;/** *åŠ è½½èµ„æºå®Œæˆï¼ˆä¸shouldInterceptRequestå¯¹åº”ï¼‰ */ public void onLoadResource(WebView view, String url) /** * åŠ è½½é”™è¯¯çš„æ—¶å€™ä¼šå›è°ƒï¼Œåœ¨å…¶ä¸­å¯åšé”™è¯¯å¤„ç†ï¼Œæ¯”å¦‚å†è¯·æ±‚åŠ è½½ä¸€æ¬¡ï¼Œæˆ–è€…æç¤ºè‡ªå®šä¹‰çš„ç½‘è·¯é—®é¢˜é¡µé¢ */@Deprecatedpublic void onReceivedError(WebView view, int errorCode,String description, String failingUrl)//sdk&gt;=23 public void onReceivedError(WebView view, WebResourceRequest request, WebResourceError error)/** * å½“æ¥æ”¶åˆ°httpsé”™è¯¯æ—¶ï¼Œä¼šå›è°ƒæ­¤å‡½æ•°ï¼Œåœ¨å…¶ä¸­å¯ä»¥åšé”™è¯¯å¤„ç† */public void onReceivedSslError(WebView view, SslErrorHandler handler,SslError error)/** * å›è°ƒè¯¥æ–¹æ³•ï¼Œå¤„ç†SSLè®¤è¯è¯·æ±‚ */public void onReceivedClientCertRequest(WebView view, ClientCertRequest request)/** * é¡µé¢å¤§å°æ”¹å˜åå›è°ƒè¯¥æ–¹æ³•ï¼Œè·å–ç¼©æ”¾å‰åå¤§å° */public void onScaleChanged(WebView view, float oldScale, float newScale)/** * æ›´æ–°å†å²è®°å½• * @param isReload ä»£è¡¨Urlæ˜¯é‡æ–°è½½å…¥çš„ */public void doUpdateVisitedHistory(WebView view, String url, boolean isReload)/** * è´¦æˆ·è‡ªåŠ¨ç™»å½• */public void onReceivedLoginRequest(WebView view, String realm,String account, String args) /** * é€šçŸ¥ä¸»ç¨‹åºè¾“å…¥äº‹ä»¶ä¸æ˜¯ç”±WebViewè°ƒç”¨ã€‚æ˜¯å¦è®©ä¸»ç¨‹åºå¤„ç†WebViewæœªå¤„ç†çš„Input Eventã€‚ * é™¤äº†ç³»ç»ŸæŒ‰é”®ï¼ŒWebViewæ€»æ˜¯æ¶ˆè€—æ‰è¾“å…¥äº‹ä»¶æˆ–shouldOverrideKeyEventè¿”å›trueã€‚ * è¯¥æ–¹æ³•ç”±event åˆ†å‘å¼‚æ­¥è°ƒç”¨ã€‚æ³¨æ„ï¼šå¦‚æœäº‹ä»¶ä¸ºMotionEventï¼Œåˆ™äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªå­˜åœ¨æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œ * å¦‚æœWebViewClientæƒ³è¦ä½¿ç”¨è¿™ä¸ªEventï¼Œåˆ™éœ€è¦å¤åˆ¶Eventå¯¹è±¡ã€‚ */onUnhandledInputEvent(WebView view, InputEvent event)/** * å¦‚æœæµè§ˆå™¨éœ€è¦é‡æ–°å‘é€POSTè¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ—¶æœºæ¥å¤„ç†ã€‚é»˜è®¤æ˜¯ä¸é‡æ–°å‘é€æ•°æ®ã€‚ å‚æ•°è¯´æ˜ * @param dontResend æµè§ˆå™¨ä¸éœ€è¦é‡æ–°å‘é€çš„å‚æ•° * @param resendæµè§ˆå™¨éœ€è¦é‡æ–°å‘é€çš„å‚æ•° */@Overridepublic void onFormResubmission(WebView view, Message dontResend,Message resend)ï¼ shouldOverrideUrlLoadingéå¸¸é‡è¦çš„æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå°±éœ€è¦è¯´æ˜ï¼Œé‡å®šå‘ï¼Œè¶…é“¾æ¥éƒ½ä¼šç”¨çš„æ–¹æ³•ï¼Œè¿™ä¸ªå‡½æ•°åœ¨åŠ è½½è¶…é“¾æ¥æ—¶ä¼šå›è°ƒï¼Œç”±äºè¿™ä¸ªå‡½æ•°æ˜¯åœ¨åŠ è½½Urlä¹‹å‰è°ƒç”¨ï¼Œè¿”å›å€¼trueä»£è¡¨æ‹¦æˆªå¤„ç†å°±ä¸å†ç»§ç»­åŠ è½½äº†ï¼Œè¿”å›falseåˆ™ç»§ç»­åŠ è½½ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦åšä¸€äº›ç™½åå•é»‘åå•æ“ä½œå¯ä»¥åœ¨è¿™é‡Œå¤„ç†å®ƒä»¬ã€‚ 123public boolean shouldOverrideUrlLoading(WebView view, String url) &#123; return false;&#125; é»˜è®¤æ—¢è¿”å›falseã€‚æ‰€ä»¥å¦‚æœæ²¡æœ‰å…¶ä»–è®¾ç½®éœ€æ±‚å¯ä»¥é‡‡ç”¨è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„WebViewClientæ—¢èƒ½ä¿æŒæ­£å¸¸åŠ è½½ç½‘é¡µã€‚ 1mWebView.setWebViewClient(new WebViewClient()); æœ‰é‡è½½æ–¹æ³•ï¼Œåœ¨SDK&gt;=24è°ƒç”¨ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦å¤„ç†ï¼Œéœ€è¦ä¸¤ä¸ªå‡½æ•°éƒ½é‡å†™ 1public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) onReceivedErroræ¥æ”¶ç½‘ç»œé”™è¯¯ï¼Œå…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯åŠ è½½404é¡µé¢ 12345678public void onReceivedError(WebView view, WebResourceRequest request, WebResourceError error) &#123; //å¦‚æœæ˜¯ä¸»frameçš„è¯å°±æ‰§è¡Œæ–¹æ³•ï¼Œè¦æ˜¯åœ¨å…¶ä»–æ¯”å¦‚iframeså°±ä¼šä¸æ‰§è¡Œ if (request.isForMainFrame()) &#123; onReceivedError(view,error.getErrorCode(), rror.getDescription().toString(),request.getUrl().toString()); &#125; //å¤„ç†åŠ è½½æœ¬åœ°é”™è¯¯é¡µé¢ mWebView.loadUrl(\"file:///android_asset/http_error.html\")&#125; WebResourceErroråŒ…å«äº†é”™è¯¯ä¿¡æ¯,å…¶ä¸­çš„ErrorCodeå¯¹åº”WebViewClientä¸­çš„å¸¸é‡ERROR_*å¯ä»¥åšå¯¹åº”å¤„ç† 123456public abstract class WebResourceError &#123; public abstract int getErrorCode(); public abstract CharSequence getDescription(); @SystemApi public WebResourceError() &#123;&#125;&#125; onReceivedSslErrorå¾ˆå¤šå¸–å­éƒ½ä»‹ç»äº†è¿™ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ä¸å¤„ç†SSLé”™è¯¯æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯å¤„ç†httpsçš„è¯·æ±‚æ—¶éªŒè¯å‡ºé”™ï¼Œçœ‹åˆ°çš„å¾ˆå¤šä¾‹å­éƒ½æ˜¯ä»¥ä»¥å‰çš„12306ç½‘ç«™ä¸ºä¾‹ï¼Œä»¥å‰çš„12306æ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œæ‰€ä»¥ç”¨chromeæ‰“å¼€æ—¶ä¼šå‡ºç°è­¦å‘Šï¼Œå¦‚æœç”¨WebViewåŠ è½½è¿™é‡Œå°±ä¼šå›è°ƒonReceivedSslErrorå‡½æ•°ï¼Œç¬”è€…å†™è¿™ç¯‡ç¬”è®°æ—¶12306å·²ç»æ˜¯å…¬å…±è¯ä¹¦äº†ï¼Œä¹Ÿå°±æ²¡æœ‰è¿™ä¸ªé”™è¯¯éªŒè¯äº†ã€‚æš‚æ—¶ä½¿ç”¨è‡ªå·±çš„ç†è§£ä»‹ç»ä¸€ä¸‹ï¼Œä»¥åå‘ç°å¯ç”¨ç½‘ç«™å†éªŒè¯ï¼š è¯¥å‡½æ•°çš„é»˜è®¤å®ç°ä¸º 123public void onReceivedSslError(WebView view, SslErrorHandler handler,SslError error) &#123; handler.cancel();&#125; SslErrorHandler.cancel()å°±æ˜¯ç»“æŸäº†Sslå¤„ç†ï¼Œä¹Ÿå°±ä¸ä¼šç»§ç»­åŠ è½½äº†ï¼Œè¿™é‡Œå­ç±»å¯ä»¥é‡å†™å¤„ç†é€»è¾‘ä¸ºï¼š 1234public void onReceivedSslError(WebView view, SslErrorHandler handler,SslError error) &#123; //super.onReceivedSslError(view, handler, error); handler.proceed();&#125; æ”¹å˜äº†SslErrorHandlerçš„å¤„ç†ï¼Œä½¿å…¶èƒ½ç»§ç»­éªŒè¯è¯ä¹¦ï¼Œæ­£å¸¸æ‰“å¼€è¯¥ç½‘é¡µã€‚ éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæœ‰å›è°ƒäº†onReceivedSslErrorï¼Œæ˜¯ä¸ä¼šåŒæ—¶å›è°ƒonReceivedErrorçš„ WebViewClientè¿˜æœ‰å¾ˆå¤šæ²¡æœ‰ä»‹ç»åˆ°çš„æ–¹æ³•ï¼Œæœ‰æœºä¼šè¿˜æ˜¯æ‰¾ä¸€äº›åº”ç”¨åœºæ™¯è¯•éªŒä¸‹å†è¡Œè¡¥å……ï¼Œè¿™ç¯‡æ–‡ç« å…ˆåˆ°è¿™é‡Œå§ï¼Œä¹‹åå†æ€»ç»“ä¸‹å¸¸ç”¨è®¾ç½®å’ŒWebChromeClientç›¸å…³ã€‚","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"},{"name":"WebView","slug":"WebView","permalink":"http://ncmon.com/tags/WebView/"}]},{"title":"å¾®åšç™»é™†ï¼ŒQQç™»å½•é”™è¯¯ç ","slug":"threee-way-login-errorcode","date":"2018-12-20T14:37:09.000Z","updated":"2019-03-23T06:28:39.193Z","comments":true,"path":"post/threee-way-login-errorcode/","link":"http://ncmon.com/post/threee-way-login-errorcode/","permalink":"http://ncmon.com/post/threee-way-login-errorcode/","excerpt":"è®°å½•ä¸€ä¸‹ç¬¬ä¸‰æ–¹ç™»å½•çš„é”™è¯¯ç ï¼Œé‡åˆ°çš„æ€»ç»“èµ·æ¥ï¼Œä»¥ä¾¿æ’æŸ¥é—®é¢˜ã€‚","text":"è®°å½•ä¸€ä¸‹ç¬¬ä¸‰æ–¹ç™»å½•çš„é”™è¯¯ç ï¼Œé‡åˆ°çš„æ€»ç»“èµ·æ¥ï¼Œä»¥ä¾¿æ’æŸ¥é—®é¢˜ã€‚ Weibo Login OAuth2.0 é”™è¯¯ç (error) é”™è¯¯ç¼–å·(error_code) é”™è¯¯æè¿°(error_description) redirect_uri_mismatch 21322 é‡å®šå‘åœ°å€ä¸åŒ¹é… invalid_request 21323 è¯·æ±‚ä¸åˆæ³• invalid_client 21324 client_idæˆ–client_secretå‚æ•°æ— æ•ˆ invalid_grant 21325 æä¾›çš„Access Grantæ˜¯æ— æ•ˆçš„ã€è¿‡æœŸçš„æˆ–å·²æ’¤é”€çš„ unauthorized_client 21326 å®¢æˆ·ç«¯æ²¡æœ‰æƒé™ expired_token 21327 tokenè¿‡æœŸ unsupported_grant_type 21328 ä¸æ”¯æŒçš„ GrantType unsupported_response_type 21329 ä¸æ”¯æŒçš„ ResponseType access_denied 21330 ç”¨æˆ·æˆ–æˆæƒæœåŠ¡å™¨æ‹’ç»æˆäºˆæ•°æ®è®¿é—®æƒé™ temporarily_unavailable 21331 æœåŠ¡æš‚æ—¶æ— æ³•è®¿é—® appkey permission denied 21337 åº”ç”¨æƒé™ä¸è¶³ QQ Login OAuth2.0 é”™è¯¯ç  å«ä¹‰è¯´æ˜ 0 æˆåŠŸã€‚ 100000 ç¼ºå°‘å‚æ•°response_typeæˆ–response_typeéæ³•ã€‚ 100001 ç¼ºå°‘å‚æ•°client_idã€‚100002ç¼ºå°‘å‚æ•°client_secretã€‚ 100003 http headä¸­ç¼ºå°‘Authorizationã€‚ 100004 ç¼ºå°‘å‚æ•°grant_typeæˆ–grant_typeéæ³•ã€‚ 100005 ç¼ºå°‘å‚æ•°codeã€‚ 100006 ç¼ºå°‘refresh tokenã€‚ 100007 ç¼ºå°‘access tokenã€‚ 100008 è¯¥appidä¸å­˜åœ¨ã€‚ 100009 client_secretï¼ˆå³appkeyï¼‰éæ³•ã€‚ 100010 å›è°ƒåœ°å€ä¸åˆæ³•ï¼Œå¸¸è§åŸå› è¯·è§ï¼šå›è°ƒåœ°å€å¸¸è§é—®é¢˜åŠä¿®æ”¹æ–¹æ³•100011APPä¸å¤„äºä¸Šçº¿çŠ¶æ€ã€‚ 100012 HTTPè¯·æ±‚épostæ–¹å¼ã€‚ 100013 access tokenéæ³•ã€‚ 100014 access tokenè¿‡æœŸã€‚ tokenè¿‡æœŸæ—¶é—´ä¸º3ä¸ªæœˆã€‚å¦‚æœå­˜å‚¨çš„access tokenè¿‡æœŸï¼Œè¯·é‡æ–°èµ°ç™»å½•æµç¨‹ï¼Œæ ¹æ®ä½¿ç”¨Authorization_Codeè·å–Access_Tokenæˆ–ä½¿ç”¨Implicit_Grantæ–¹å¼è·å–Access_Tokenè·å–æ–°çš„access tokenå€¼ã€‚ 100015 access tokenåºŸé™¤ã€‚ tokenè¢«å›æ”¶ï¼Œæˆ–è€…è¢«ç”¨æˆ·åˆ é™¤ã€‚è¯·é‡æ–°èµ°ç™»å½•æµç¨‹ï¼Œæ ¹æ®ä½¿ç”¨Authorization_Codeè·å–Access_Tokenæˆ–ä½¿ç”¨Implicit_Grantæ–¹å¼è·å–Access_Tokenè·å–æ–°çš„access tokenå€¼ã€‚ 100016 access tokenéªŒè¯å¤±è´¥ã€‚ 100017 è·å–appidå¤±è´¥ã€‚ 100018 è·å–codeå€¼å¤±è´¥ã€‚ 100019 ç”¨codeæ¢å–access tokenå€¼å¤±è´¥ã€‚ 100020 codeè¢«é‡å¤ä½¿ç”¨ã€‚ 100021 è·å–access tokenå€¼å¤±è´¥ã€‚ 100022 è·å–refresh tokenå€¼å¤±è´¥ã€‚ 100023 è·å–appå…·æœ‰çš„æƒé™åˆ—è¡¨å¤±è´¥ã€‚ 100024 è·å–æŸOpenIDå¯¹æŸappidçš„æƒé™åˆ—è¡¨å¤±è´¥ã€‚ 100025 è·å–å…¨é‡apiä¿¡æ¯ã€å…¨é‡åˆ†ç»„ä¿¡æ¯ã€‚ 100026 è®¾ç½®ç”¨æˆ·å¯¹æŸappæˆæƒapiåˆ—è¡¨å¤±è´¥ã€‚ 100027 è®¾ç½®ç”¨æˆ·å¯¹æŸappæˆæƒæ—¶é—´å¤±è´¥ã€‚ 100028 ç¼ºå°‘å‚æ•°whichã€‚ 100029 é”™è¯¯çš„httpè¯·æ±‚ã€‚ 100030 ç”¨æˆ·æ²¡æœ‰å¯¹è¯¥apiè¿›è¡Œæˆæƒï¼Œæˆ–ç”¨æˆ·åœ¨è…¾è®¯ä¾§åˆ é™¤äº†è¯¥apiçš„æƒé™ã€‚è¯·ç”¨æˆ·é‡æ–°èµ°ç™»å½•ã€æˆæƒæµç¨‹ï¼Œå¯¹è¯¥apiè¿›è¡Œæˆæƒã€‚ 100031 ç¬¬ä¸‰æ–¹åº”ç”¨æ²¡æœ‰å¯¹è¯¥apiæ“ä½œçš„æƒé™ã€‚è¯·å‘é€é‚®ä»¶è¿›è¡ŒOpenAPIæƒé™ç”³è¯·ã€‚ 100032 è¿‡è½½ï¼Œä¸€å¼€å§‹æœªç»†åˆ†æ—¶å¯ä»¥ç”¨ã€‚ 100033 ç¼ºå°‘UINå‚æ•°ã€‚ 100034 ç¼ºå°‘skeyå‚æ•° 100035 ç”¨æˆ·æœªç™»é™†ã€‚ 100036 RefreshTokenå¤±æ•ˆã€‚ 100037 RefreshTokenå·²è¿‡æœŸ 100038 RefreshTokenå·²åºŸé™¤ 100039 RefreshTokenåˆ°è¾¾è°ƒç”¨ä¸Šé™ã€‚ 100040 RefreshTokençš„AppKeyéæ³•ã€‚ 100041 RefreshToken,AppIDéæ³•ã€‚ 100042 RefreshTokenéæ³•ã€‚ 100043 APPå¤„äºæš‚åœçŠ¶æ€ã€‚ 100044 é”™è¯¯çš„signï¼ŒMd5æ ¡éªŒå¤±è´¥ï¼Œè¯·æ±‚ç­¾åä¸å®˜ç½‘å¡«å†™çš„ç­¾åä¸ä¸€è‡´ã€‚ 100045 ç”¨æˆ·æ”¹å¯†tokenå¤±æ•ˆã€‚ 100046 g_tkæ ¡éªŒå¤±è´¥ã€‚ 100048 æ²¡æœ‰è®¾ç½®companyIDã€‚ 100049 APPIDæ²¡æœ‰æƒé™(get_unionid)ã€‚ 100050 OPENIDè§£å¯†å¤±è´¥ï¼Œä¸€èˆ¬æ˜¯openidå’Œappidä¸åŒ¹é…ã€‚ 100051 è°ƒè¯•æ¨¡å¼æ— æƒé™ã€‚ 110401 è¯·æ±‚çš„åº”ç”¨ä¸å­˜åœ¨ã€‚ 110404 è¯·æ±‚å‚æ•°ç¼ºå°‘appidã€‚ 110405 ç™»å½•è¯·æ±‚è¢«é™åˆ¶ï¼Œè¯·ç¨ååœ¨ç™»å½•ã€‚ 110406 åº”ç”¨æ²¡æœ‰é€šè¿‡å®¡æ ¸ã€‚ 110500 è·å–ç”¨æˆ·æˆæƒä¿¡æ¯å¤±è´¥ã€‚ 110501 è·å–åº”ç”¨çš„æˆæƒä¿¡æ¯å¤±è´¥ 110502 è®¾ç½®ç”¨æˆ·æˆæƒå¤±è´¥ 110503 è·å–tokenå¤±è´¥ 110504 ç³»ç»Ÿå†…éƒ¨é”™è¯¯ 110505 å‚æ•°é”™è¯¯ 110506 è·å–APP infoä¿¡æ¯å¤±è´¥ 110506 æ ¡éªŒAPP info ç­¾åä¿¡æ¯å¤±è´¥ 110508 è·å–codeå¤±è´¥ 110509 SKEYæ ¡éªŒå¤±è´¥ 110510 Disable","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"}]},{"title":"NestedScrollViewåµŒå¥—RecyclerViewæ»‘åŠ¨å†²çª","slug":"design-clear-of-mines-2","date":"2018-11-21T15:09:46.000Z","updated":"2018-11-21T15:31:11.128Z","comments":true,"path":"post/design-clear-of-mines-2/","link":"http://ncmon.com/post/design-clear-of-mines-2/","permalink":"http://ncmon.com/post/design-clear-of-mines-2/","excerpt":"é—®é¢˜æè¿°Androidä½¿ç”¨disign ä¸­æ§ä»¶NestedScrollView+RecyclerViewåµŒå¥—æ—¶ä¸Šä¸‹æ»‘åŠ¨ä¼šæœ‰æ˜æ˜¾çš„é˜»å¡æ„Ÿï¼Œæ˜¾ç„¶æ˜¯é‡åˆ°äº†æ»‘åŠ¨å†²çª","text":"é—®é¢˜æè¿°Androidä½¿ç”¨disign ä¸­æ§ä»¶NestedScrollView+RecyclerViewåµŒå¥—æ—¶ä¸Šä¸‹æ»‘åŠ¨ä¼šæœ‰æ˜æ˜¾çš„é˜»å¡æ„Ÿï¼Œæ˜¾ç„¶æ˜¯é‡åˆ°äº†æ»‘åŠ¨å†²çª12345678910111213&lt;android.support.v4.widget.NestedScrollView android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:fillViewport=\"true\" app:layout_behavior=\"@string/appbar_scrolling_view_behavior\"&gt; &lt;android.support.v7.widget.RecyclerView android:id=\"@+id/recycler_view\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:layout_marginTop=\"2dp\" app:layout_constraintTop_toBottomOf=\"@id/space1\"/&gt;&lt;/android.support.v4.widget.NestedScrollView&gt; è§£å†³æ–¹æ¡ˆåœ¨XMLä¸­ å¯ä»¥å¯¹RecyclerView è®¾ç½® android:nestedScrollingEnabled=â€falseâ€ä¸è¿‡è¿™æ ·åªæ”¯æŒAndroid 21ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå¯¹åº”çš„è®¾ç½®RecyclerViewçš„å±æ€§mRecyclerView.setNestedScrollingEnabled(false)ç”±äºæ˜¯supportæ”¯æŒåº“ä¸­çš„æ–¹æ³•å³å¯å…¼å®¹ä½ç‰ˆæœ¬ã€‚","categories":[{"name":"é”™è¯¯å¿—","slug":"é”™è¯¯å¿—","permalink":"http://ncmon.com/categories/é”™è¯¯å¿—/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"},{"name":"Design","slug":"Design","permalink":"http://ncmon.com/tags/Design/"},{"name":"error","slug":"error","permalink":"http://ncmon.com/tags/error/"}]},{"title":"NestedScrollViewåµŒå¥—ViewPager æ˜¾ç¤ºå†²çª","slug":"design-clear-of-mines-1","date":"2018-11-21T15:04:11.000Z","updated":"2018-11-21T15:41:36.686Z","comments":true,"path":"post/design-clear-of-mines-1/","link":"http://ncmon.com/post/design-clear-of-mines-1/","permalink":"http://ncmon.com/post/design-clear-of-mines-1/","excerpt":"é—®é¢˜æè¿°Androidä½¿ç”¨disignä¸­è‡ªå¸¦æ§ä»¶CoordinatorLayout+TabLayout+NestedScrollView+ViewPageræ¥å®ç°å¯æŠ˜å å¤´éƒ¨çš„ä¹Ÿå¯æ¨ªä¸‹æ»‘åŠ¨çš„åˆ—è¡¨çš„é¡µé¢NestedScrollViewä¸­åµŒå¥—äº†ViewPageræ¥å±•ç¤ºä¸åŒçš„Tabæ»‘åŠ¨å±•ç¤ºï¼ŒViewPageræ˜¾ç¤ºçš„é«˜åº¦ä¸º0ï¼Œä»AndroidStudioé¢„è§ˆé¡µé¢å³å¯çœ‹åˆ°ã€‚","text":"é—®é¢˜æè¿°Androidä½¿ç”¨disignä¸­è‡ªå¸¦æ§ä»¶CoordinatorLayout+TabLayout+NestedScrollView+ViewPageræ¥å®ç°å¯æŠ˜å å¤´éƒ¨çš„ä¹Ÿå¯æ¨ªä¸‹æ»‘åŠ¨çš„åˆ—è¡¨çš„é¡µé¢NestedScrollViewä¸­åµŒå¥—äº†ViewPageræ¥å±•ç¤ºä¸åŒçš„Tabæ»‘åŠ¨å±•ç¤ºï¼ŒViewPageræ˜¾ç¤ºçš„é«˜åº¦ä¸º0ï¼Œä»AndroidStudioé¢„è§ˆé¡µé¢å³å¯çœ‹åˆ°ã€‚ è§£å†³æ–¹æ¡ˆä¸ºNestedScrollViewè®¾ç½® android:fillViewport=â€trueâ€ è§£å†³1234567891011&lt;android.support.v4.widget.NestedScrollView android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:fillViewport=\"true\" app:layout_behavior=\"@string/appbar_scrolling_view_behavior\"&gt; &lt;android.support.v4.view.ViewPager android:id=\"@+id/viewpager\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" /&gt;&lt;/android.support.v4.widget.NestedScrollView&gt;","categories":[{"name":"é”™è¯¯å¿—","slug":"é”™è¯¯å¿—","permalink":"http://ncmon.com/categories/é”™è¯¯å¿—/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"},{"name":"Design","slug":"Design","permalink":"http://ncmon.com/tags/Design/"},{"name":"error","slug":"error","permalink":"http://ncmon.com/tags/error/"}]},{"title":"Android Jetpack Architectureä¹‹ViewModel","slug":"Jetpack-Architecture-ViewModel","date":"2018-09-26T12:40:11.000Z","updated":"2018-10-27T06:02:35.102Z","comments":true,"path":"post/Jetpack-Architecture-ViewModel/","link":"http://ncmon.com/post/Jetpack-Architecture-ViewModel/","permalink":"http://ncmon.com/post/Jetpack-Architecture-ViewModel/","excerpt":"å‰è¨€&ensp;&ensp;Jetpackå·²ç»å‡ºäº†å¾ˆä¹…å¾ˆä¹…äº†ï¼Œè¿‘å‡ å¹´çš„GDDå‡ ä¹æ¯æ¬¡éƒ½ä¼šä»‹ç»æ–°çš„ç»„ä»¶ï¼Œè¯´æ¥æƒ­æ„§ï¼Œä¸€ç›´æ²¡æœ‰å¥½å¥½å­¦ä¹ ï¼Œçœ‹è¿‘å¹´çš„Google çš„å¾ˆå¤šDemoä¸­å…¶å®éƒ½æœ‰æ‰€ä½“ç°ï¼Œä¹‹å‰éƒ½æ˜¯å¤§æ¦‚çš„äº†è§£äº†ä¸€éã€‚æœ€è¿‘å†³å®šï¼Œå¥½å¥½æ¢³ç†ä¸€éï¼Œæ—¢å­¦ä¹ å…¶ç”¨æ³•ï¼Œä¹Ÿå°è¯•å­¦ä¹ ä¸‹å…¶è®¾è®¡æ€æƒ³ã€‚ä¹Ÿæ˜¯æ—¶å€™è¯¥è¡¥å……ä¸€ä¸‹äº†ã€‚è¿›å…¥æ­£é¢˜â€“ViewModel&ensp;&ensp;é¦–å…ˆéƒ½æ˜¯çœ‹å®˜æ–¹çš„ä¾‹å­ï¼ŒViewModelå®˜æ–¹çš„çš„ä¾‹å­æ˜¯ä¼šå’Œå¦ä¸€ä¸ªæ¶æ„åº“LiveDataå†™åœ¨ä¸€èµ·ï¼Œå¾ˆå¤šçš„åšå®¢ä¹Ÿæ˜¯ç…§å®˜æ–¹çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå¼€å§‹æ¥è§¦æ—¶ç”šè‡³ç»™äº†æˆ‘ä¸€ç§å‡è±¡ï¼šViewModeléƒ½æ˜¯å’ŒLiveDataä¸€èµ·ä½¿ç”¨çš„ã€‚åæ¥é˜…è¯»æ‰äº†è§£ï¼ŒViewModelå’ŒLiveDataèŒè´£åˆ†å·¥è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä½¿ç”¨LiveData Demoä¸»è¦ä½¿ç”¨å…¶observeåŠŸèƒ½ï¼ŒLiveDateçš„ä½¿ç”¨åŠåŸç†ä¹‹åå†åˆ†æï¼Œç”šè‡³åœ¨appcompat-v7:27.1.1ä¸­ç›´æ¥å•ç‹¬é›†æˆäº†ViewModel.æ‰€ä»¥ï¼Œæ•…ä¸ºæ’é™¤å¹²æ‰°ï¼Œä»Šå¤©ä¸ä¼šä½¿ç”¨å®˜æ–¹çš„ä¸»æµDemoç”¨æ³•ï¼Œå…ˆæ¥çœ‹ViewModelã€‚","text":"å‰è¨€&ensp;&ensp;Jetpackå·²ç»å‡ºäº†å¾ˆä¹…å¾ˆä¹…äº†ï¼Œè¿‘å‡ å¹´çš„GDDå‡ ä¹æ¯æ¬¡éƒ½ä¼šä»‹ç»æ–°çš„ç»„ä»¶ï¼Œè¯´æ¥æƒ­æ„§ï¼Œä¸€ç›´æ²¡æœ‰å¥½å¥½å­¦ä¹ ï¼Œçœ‹è¿‘å¹´çš„Google çš„å¾ˆå¤šDemoä¸­å…¶å®éƒ½æœ‰æ‰€ä½“ç°ï¼Œä¹‹å‰éƒ½æ˜¯å¤§æ¦‚çš„äº†è§£äº†ä¸€éã€‚æœ€è¿‘å†³å®šï¼Œå¥½å¥½æ¢³ç†ä¸€éï¼Œæ—¢å­¦ä¹ å…¶ç”¨æ³•ï¼Œä¹Ÿå°è¯•å­¦ä¹ ä¸‹å…¶è®¾è®¡æ€æƒ³ã€‚ä¹Ÿæ˜¯æ—¶å€™è¯¥è¡¥å……ä¸€ä¸‹äº†ã€‚è¿›å…¥æ­£é¢˜â€“ViewModel&ensp;&ensp;é¦–å…ˆéƒ½æ˜¯çœ‹å®˜æ–¹çš„ä¾‹å­ï¼ŒViewModelå®˜æ–¹çš„çš„ä¾‹å­æ˜¯ä¼šå’Œå¦ä¸€ä¸ªæ¶æ„åº“LiveDataå†™åœ¨ä¸€èµ·ï¼Œå¾ˆå¤šçš„åšå®¢ä¹Ÿæ˜¯ç…§å®˜æ–¹çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå¼€å§‹æ¥è§¦æ—¶ç”šè‡³ç»™äº†æˆ‘ä¸€ç§å‡è±¡ï¼šViewModeléƒ½æ˜¯å’ŒLiveDataä¸€èµ·ä½¿ç”¨çš„ã€‚åæ¥é˜…è¯»æ‰äº†è§£ï¼ŒViewModelå’ŒLiveDataèŒè´£åˆ†å·¥è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä½¿ç”¨LiveData Demoä¸»è¦ä½¿ç”¨å…¶observeåŠŸèƒ½ï¼ŒLiveDateçš„ä½¿ç”¨åŠåŸç†ä¹‹åå†åˆ†æï¼Œç”šè‡³åœ¨appcompat-v7:27.1.1ä¸­ç›´æ¥å•ç‹¬é›†æˆäº†ViewModel.æ‰€ä»¥ï¼Œæ•…ä¸ºæ’é™¤å¹²æ‰°ï¼Œä»Šå¤©ä¸ä¼šä½¿ç”¨å®˜æ–¹çš„ä¸»æµDemoç”¨æ³•ï¼Œå…ˆæ¥çœ‹ViewModelã€‚ ViewModelç®€ä»‹&ensp;&ensp;Androidçš„UIæ§åˆ¶å™¨ï¼ˆActivityå’ŒFragmentï¼‰ä»åˆ›å»ºåˆ°é”€æ¯æ‹¥æœ‰è‡ªå·±å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“ç³»ç»Ÿé…ç½®å‘ç”Ÿæ”¹å˜æ—¶ï¼ˆ(Configuration changes)ï¼‰ï¼Œç³»ç»Ÿå°±ä¼šé”€æ¯Activityå’Œä¸ä¹‹å…³è”çš„Fragmentç„¶åå†æ¬¡é‡å»ºï¼ˆå¯é€šè¿‡åœ¨AndroidManifast.xmlä¸­é…ç½®android:configChangesä¿®æ”¹æŸäº›è¡Œä¸ºï¼Œè¿™é‡Œä¸è®¨è®ºï¼‰,é‚£ä¹ˆå­˜å‚¨åœ¨å½“å‰UIä¸­çš„ä¸´æ—¶æ•°æ®ä¹Ÿä¼šè¢«æ¸…ç©ºï¼Œä¾‹å¦‚ï¼Œç™»é™†è¾“å…¥æ¡†ï¼Œè¾“å…¥è´¦å·æˆ–å¯†ç åæ—‹è½¬å±å¹•ï¼Œè§†å›¾è¢«é‡å»ºï¼Œè¾“å…¥è¿‡çš„æ•°æ®ä¹Ÿæ¸…ç©ºäº†ï¼Œè¿™æ— ç–‘æ˜¯ä¸€ç§ä¸å‹å¥½çš„ç”¨æˆ·ä½“éªŒã€‚å¯¹äºå°‘é‡çš„å¯åºåˆ—åŒ–æ•°æ®å¯ä»¥ä½¿ç”¨onSaveInstanceState()æ–¹æ³•ä¿å­˜ç„¶ååœ¨onCreate()æ–¹æ³•ä¸­é‡æ–°æ¢å¤ï¼Œæ­£å¦‚æ‰€è¯´onSaveInstanceStateå¯¹äºå¤§é‡çš„æ•°æ®ç¼“å­˜æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå¤§é‡çš„æ•°æ®ç¼“å­˜åˆ™å¯ä»¥ä½¿ç”¨Fragment.setRetainInstance(true)æ¥ä¿å­˜æ•°æ®ã€‚ViewModelä¹Ÿæ˜¯æä¾›äº†ç›¸åŒçš„åŠŸèƒ½ï¼Œç”¨æ¥å­˜å‚¨å’Œç®¡ç†ä¸UIç›¸å…³çš„æ•°æ®ï¼Œå…è®¸æ•°æ®åœ¨ç³»ç»Ÿé…ç½®å˜åŒ–åå­˜æ´»ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹è¿™ä¸ªViewModelçš„ç¼“å­˜æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ ViewModelä½¿ç”¨æ–¹å¼å…ˆä¸Šæ•ˆæœå›¾1234567891011121314public class MyViewModel extends ViewModel &#123; String name; public String getName()&#123; return name; &#125; public void setName(String name)&#123; this.name = name; &#125; @Override protected void onCleared() &#123; super.onCleared(); name = null; &#125; &#125; &nbsp;1234567891011121314151617181920212223242526272829303132public class ViewModelActivity extends AppCompatActivity implements View.OnClickListener &#123; private static final String TAG = \"ViewModelActivity\"; TextView textView; private MyViewModel myViewModel; @Override protected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_viewmodel); textView = findViewById(R.id.textView); textView.setOnClickListener(this); ViewModelProvider.Factory factory = ViewModelProvider.AndroidViewModelFactory.getInstance(getApplication()); /* *è¿™é‡Œçš„thisæ˜¯ViewModelStoreOwneræ¥å£åœ¨appcompat-v7:27.1.1æ”¯æŒåº“ä¸­AppCompatActivityå·²ç»å®ç°äº†ï¼Œ *å¦‚æœæ˜¯è¾ƒä½ç‰ˆæœ¬ï¼Œéœ€è¦æ›´æ–°æ”¯æŒåŒ…æˆ–è€…å‚è€ƒå…¶å®ç°å¯¹æœ¬æ¥ç»§æ‰¿çš„Activityåšå¯¹åº”å®ç°ã€‚ */ ViewModelProvider provider = new ViewModelProvider(this, factory);// myViewModel = provider.get(MyViewModel.class); Log.e(TAG, \"onCreate: \" + myViewModel.getName() ); if (myViewModel.getName() != null) &#123; textView.setText(myViewModel.getName()); &#125; &#125; @Override public void onClick(View v) &#123; switch (v.getId())&#123; case R.id.textView: myViewModel.setName(\"MyViewModel Test\"); textView.setText(myViewModel.getName()); break; &#125; &#125;&#125; &nbsp;123456789101112131415161718192021222324&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:app=\"http://schemas.android.com/apk/res-auto\" xmlns:tools=\"http://schemas.android.com/tools\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;TextView android:id=\"@+id/textView\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_marginStart=\"8dp\" android:layout_marginTop=\"8dp\" android:layout_marginEnd=\"8dp\" android:layout_marginBottom=\"8dp\" android:text=\"default\" app:layout_constraintBottom_toBottomOf=\"parent\" app:layout_constraintEnd_toEndOf=\"parent\" app:layout_constraintStart_toStartOf=\"parent\" app:layout_constraintTop_toTopOf=\"parent\" /&gt;&lt;/android.support.constraint.ConstraintLayout&gt; éå¸¸ç®€å•çš„ä¸€ä¸ªä¾‹å­ï¼Œè¿™å°±æ˜¯ViewModelæœ€ç®€å•çš„ä½¿ç”¨äº†ï¼Œå°±æ˜¯TextViewä¸­æ˜¾ç¤ºViewModelçš„æ•°æ®ã€‚ViewModeléœ€è¦ç”±ViewModelProvider.get(Class)æ¥å–å¾—ï¼Œæ—‹è½¬å±å¹•é”€æ¯åï¼Œä¹‹å‰æ”¹å˜çš„æ•°æ®è¿˜åœ¨ã€‚æ¥ä¸‹æ¥å°±æ˜¯è¿›å…¥ä¸»é¢˜åˆ†æä¸‹ViewModelåˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿå¸¦ç€é—®é¢˜çœ‹æºç ï¼š å¸¦ç»™æˆ‘ä»¬çš„ç–‘é—® ViewModelProvideræ˜¯å¹²å•¥çš„ï¼Ÿ AndroidViewModelFactory è¿™å‘½åä¸€çœ‹å°±æ˜¯åº”è¯¥æ˜¯å·¥å‚æ¨¡å¼ï¼Œå·¥å‚åˆ›å»ºäº†ä»€ä¹ˆï¼Ÿ provider.get(MyViewModel.class) è¿™é‡Œç›´æ¥ä½¿ç”¨çš„getå‘½åå°±å¾—åˆ°äº†éœ€è¦çš„å”¯ä¸€æ•°æ® æ³¨é‡Šä¸­ViewModelStoreOwneråˆæ˜¯ä»€ä¹ˆè§’è‰²ï¼Ÿå…ˆçœ‹ViewModelç±»ï¼Œæ²¡ä»€ä¹ˆè¯´çš„ï¼Œå°±æ˜¯ä¸€ä¸ªä¹ˆæœ‰ä»»ä½•çœŸæ­£å®ç°çš„æŠ½è±¡ç±»ï¼Œåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•onCleared() åŸç†åˆ†æ1234567891011public abstract class ViewModel &#123; /** * This method will be called when this ViewModel is no longer used and will be destroyed. * &lt;p&gt; * It is useful when ViewModel observes some data and you need to clear this subscription to * prevent a leak of this ViewModel. */ @SuppressWarnings(\"WeakerAccess\") protected void onCleared() &#123; &#125;&#125; æ¥ç€çœ‹ä¸‹ViewModelFactoryï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åˆ¶é€ ViewModelçš„ã€‚AndroidViewModelFactoryçš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹: android.arch.lifecycle.ViewModelProvider.Factory android.arch.lifecycle.ViewModelProvider.NewInstanceFactory android.arch.lifecycle.ViewModelProvider.AndroidViewModelFactory Factoryæ˜¯ä¸€ä¸ªåªåŒ…å«ä¸€ä¸ªcreateçš„interfaceï¼ŒNewInstanceFactoryå®ç°äº†è¯¥æ–¹æ³•ä¼ å…¥Classä¼šåˆ©ç”¨ViewModelçš„é»˜è®¤æ— å‚æ„é€ å™¨åˆ›å»ºä¸€ä¸ªå¯¹åº”ViewModelçš„å®ä¾‹ï¼Œè€ŒAndroidViewModelFactoryå¢åŠ äº†ä¸€ä¸ªå±æ€§å°±æ˜¯åº”ç”¨çš„Applicaion,åŒæ—¶é‡å†™createæ–¹æ³•ï¼ŒæŸ¥çœ‹ViewModelæ˜¯å¦æœ‰åŒ…å«Applicaionå‚æ•°çš„æ„é€ æ–¹æ³•ä»è€Œä½¿ç”¨ï¼Œå¯¹åº”çš„å…¶å®è¿˜æœ‰ä¸€ä¸ªAndroidViewModelæ˜¯ViewModelçš„å­ç±»ï¼Œé»˜è®¤å·²ç»å®ç°äº†å¸¦æœ‰Applicationå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œéœ€è¦ä½¿ç”¨åœ¨ViewModelä¸­ä½¿ç”¨applicationçš„ç›´æ¥ç»§æ‰¿AndroidViewModelå°±å¯ä»¥ï¼Œçœ‹åˆ°è¿™é‡Œå…¶å®æœ€ä¸Šé¢çš„ä¾‹å­æœ‰ä¸ªä¸æ˜¯é—®é¢˜çš„é—®é¢˜ï¼Œå…¶å®ä¸Šé¢çš„Factoryç›´æ¥ä½¿ç”¨NewInstanceFactoryå°±å¯ä»¥åˆ›å»ºå‡ºå¯¹åº”çš„ViewModelå®ä¾‹äº†ã€‚123456789101112131415/** * Implementations of &#123;@code Factory&#125; interface are responsible to instantiate ViewModels. */public interface Factory &#123; /** * Creates a new instance of the given &#123;@code Class&#125;. * &lt;p&gt; * * @param modelClass a &#123;@code Class&#125; whose instance is requested * @param &lt;T&gt; The type parameter for the ViewModel. * @return a newly created ViewModel */ @NonNull &lt;T extends ViewModel&gt; T create(@NonNull Class&lt;T&gt; modelClass);&#125; 12345678910111213141516171819/** * Simple factory, which calls empty constructor on the give class. */public static class NewInstanceFactory implements Factory &#123; @SuppressWarnings(\"ClassNewInstance\") @NonNull @Override public &lt;T extends ViewModel&gt; T create(@NonNull Class&lt;T&gt; modelClass) &#123; //noinspection TryWithIdenticalCatches try &#123; return modelClass.newInstance(); &#125; catch (InstantiationException e) &#123; throw new RuntimeException(\"Cannot create an instance of \" + modelClass, e); &#125; catch (IllegalAccessException e) &#123; throw new RuntimeException(\"Cannot create an instance of \" + modelClass, e); &#125; &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * &#123;@link Factory&#125; which may create &#123;@link AndroidViewModel&#125; and * &#123;@link ViewModel&#125;, which have an empty constructor. */public static class AndroidViewModelFactory extends ViewModelProvider.NewInstanceFactory &#123; private static AndroidViewModelFactory sInstance; /** * Retrieve a singleton instance of AndroidViewModelFactory. * * @param application an application to pass in &#123;@link AndroidViewModel&#125; * @return A valid &#123;@link AndroidViewModelFactory&#125; */ @NonNull public static AndroidViewModelFactory getInstance(@NonNull Application application) &#123; if (sInstance == null) &#123; sInstance = new AndroidViewModelFactory(application); &#125; return sInstance; &#125; private Application mApplication; /** * Creates a &#123;@code AndroidViewModelFactory&#125; * * @param application an application to pass in &#123;@link AndroidViewModel&#125; */ public AndroidViewModelFactory(@NonNull Application application) &#123; mApplication = application; &#125; @NonNull @Override public &lt;T extends ViewModel&gt; T create(@NonNull Class&lt;T&gt; modelClass) &#123; if (AndroidViewModel.class.isAssignableFrom(modelClass)) &#123; //noinspection TryWithIdenticalCatches try &#123; return modelClass.getConstructor(Application.class).newInstance(mApplication); &#125; catch (NoSuchMethodException e) &#123; throw new RuntimeException(\"Cannot create an instance of \" + modelClass, e); &#125; catch (IllegalAccessException e) &#123; throw new RuntimeException(\"Cannot create an instance of \" + modelClass, e); &#125; catch (InstantiationException e) &#123; throw new RuntimeException(\"Cannot create an instance of \" + modelClass, e); &#125; catch (InvocationTargetException e) &#123; throw new RuntimeException(\"Cannot create an instance of \" + modelClass, e); &#125; &#125; return super.create(modelClass); &#125;&#125; ä¹‹åé€šè¿‡ViewModelStoreOwnerå’Œåˆšåˆšåˆ›å»ºçš„Factoryåˆ›å»ºå‡ºViewModelPrividerå®ä¾‹12345678910111213141516171819202122232425/** * Creates &#123;@code ViewModelProvider&#125;, which will create &#123;@code ViewModels&#125; via the given * &#123;@code Factory&#125; and retain them in a store of the given &#123;@code ViewModelStoreOwner&#125;. * * @param owner a &#123;@code ViewModelStoreOwner&#125; whose &#123;@link ViewModelStore&#125; will be used to * retain &#123;@code ViewModels&#125; * @param factory a &#123;@code Factory&#125; which will be used to instantiate * new &#123;@code ViewModels&#125; */public ViewModelProvider(@NonNull ViewModelStoreOwner owner, @NonNull Factory factory) &#123; this(owner.getViewModelStore(), factory);&#125;/** * Creates &#123;@code ViewModelProvider&#125;, which will create &#123;@code ViewModels&#125; via the given * &#123;@code Factory&#125; and retain them in the given &#123;@code store&#125;. * * @param store &#123;@code ViewModelStore&#125; where ViewModels will be stored. * @param factory factory a &#123;@code Factory&#125; which will be used to instantiate * new &#123;@code ViewModels&#125; */public ViewModelProvider(@NonNull ViewModelStore store, @NonNull Factory factory) &#123; mFactory = factory; this.mViewModelStore = store;&#125; 1234567891011121314151617/** * A scope that owns &#123;@link ViewModelStore&#125;. * &lt;p&gt; * A responsibility of an implementation of this interface is to retain owned ViewModelStore * during the configuration changes and call &#123;@link ViewModelStore#clear()&#125;, when this scope is * going to be destroyed. */@SuppressWarnings(\"WeakerAccess\")public interface ViewModelStoreOwner &#123; /** * Returns owned &#123;@link ViewModelStore&#125; * * @return a &#123;@code ViewModelStore&#125; */ @NonNull ViewModelStore getViewModelStore();&#125; ViewModelStoreOwner ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£æ˜¯FragmentActivityå®ç°äº†è¯¥æ¥å£å¹¶å®ç°äº†å…¶ä¸­çš„getViewModelStore()æ–¹æ³•1234567891011121314151617181920212223242526272829303132public class FragmentActivity extends BaseFragmentActivityApi16 implements ViewModelStoreOwner...&#123; private ViewModelStore mViewModelStore; @Override protected void onCreate(@Nullable Bundle savedInstanceState) &#123; mFragments.attachHost(null /*parent*/); super.onCreate(savedInstanceState); NonConfigurationInstances nc = (NonConfigurationInstances) getLastNonConfigurationInstance(); if (nc != null) &#123; mViewModelStore = nc.viewModelStore; &#125; /** * Returns the &#123;@link ViewModelStore&#125; associated with this activity * * @return a &#123;@code ViewModelStore&#125; */ @NonNull @Override public ViewModelStore getViewModelStore() &#123; if (getApplication() == null) &#123; throw new IllegalStateException(\"Your activity is not yet attached to the \" + \"Application instance. You can't request ViewModel before onCreate call.\"); &#125; if (mViewModelStore == null) &#123; mViewModelStore = new ViewModelStore(); &#125; return mViewModelStore; &#125;&#125; è¿™ä¸ªViewModelStoreåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Œå…¶å®å°±æ˜¯çœŸæ­£åˆ©ç”¨HashMapå­˜å‚¨ViewModelçš„åœ°æ–¹äº†ï¼Œçœ‹ä¸‹ä»£ç åœ¨å­˜å‚¨å’ŒclearåŒæ—¶ä¼šè°ƒç”¨ViewModeléœ€è¦å®ç°çš„æŠ½è±¡æ–¹æ³•onClear()12345678910111213141516171819202122232425public class ViewModelStore &#123; private final HashMap&lt;String, ViewModel&gt; mMap = new HashMap&lt;&gt;(); final void put(String key, ViewModel viewModel) &#123; ViewModel oldViewModel = mMap.put(key, viewModel); if (oldViewModel != null) &#123; oldViewModel.onCleared(); &#125; &#125; final ViewModel get(String key) &#123; return mMap.get(key); &#125; /** * Clears internal storage and notifies ViewModels that they are no longer used. */ public final void clear() &#123; for (ViewModel vm : mMap.values()) &#123; vm.onCleared(); &#125; mMap.clear(); &#125;&#125; è¿™æ ·ViewModelProviderå°±æ˜¯æœ‰äº†ä¸€ä¸ªViewModelçš„å®¹å™¨ï¼Œè¿™æ—¶å»è°ƒç”¨ViewModelProviderçš„get(Class)æ–¹æ³•å°±æ˜¯å»è°ƒç”¨mViewModelStoreçš„get()æ–¹æ³•å–å‡ºå¯¹åº”çš„ViewModelæ‰€ä»¥è¿™é‡Œåªè¦æŒæœ‰çš„ViewModelStoreæ˜¯æœ‰ç¼“å­˜çš„ï¼Œé‚£ä¹ˆå–å‡ºçš„ViewModelå°±æ˜¯ç›¸åŒçš„ç¼“å­˜äº†ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243/** * Returns an existing ViewModel or creates a new one in the scope (usually, a fragment or * an activity), associated with this &#123;@code ViewModelProvider&#125;. * &lt;p&gt; * The created ViewModel is associated with the given scope and will be retained * as long as the scope is alive (e.g. if it is an activity, until it is * finished or process is killed). * * @param modelClass The class of the ViewModel to create an instance of it if it is not * present. * @param &lt;T&gt; The type parameter for the ViewModel. * @return A ViewModel that is an instance of the given type &#123;@code T&#125;. */@NonNull@MainThreadpublic &lt;T extends ViewModel&gt; T get(@NonNull Class&lt;T&gt; modelClass) &#123; String canonicalName = modelClass.getCanonicalName(); if (canonicalName == null) &#123; throw new IllegalArgumentException(\"Local and anonymous classes can not be ViewModels\"); &#125; return get(DEFAULT_KEY + \":\" + canonicalName, modelClass);&#125;@NonNull@MainThreadpublic &lt;T extends ViewModel&gt; T get(@NonNull String key, @NonNull Class&lt;T&gt; modelClass) &#123; ViewModel viewModel = mViewModelStore.get(key); if (modelClass.isInstance(viewModel)) &#123; //noinspection unchecked return (T) viewModel; &#125; else &#123; //noinspection StatementWithEmptyBody if (viewModel != null) &#123; // TODO: log a warning. &#125; &#125; viewModel = mFactory.create(modelClass); mViewModelStore.put(key, viewModel); //noinspection unchecked return (T) viewModel;&#125; çœ‹åˆ°è¿™é‡Œå°±ä¼šå‘ç°ViewModelStoreçš„ç¼“å­˜å…¶å®æ˜¯é€šè¿‡NonConfigurationInstancesçš„ç¼“å­˜æ¥å®ç°çš„ï¼Œè¿™æ ·å°±å®Œæˆäº†Activityé”€æ¯é‡å»ºåViewModelè¿˜ä¿å­˜åŸæ¥çš„æ•°æ®çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆNonConfigurationInstances æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæœ‰äº†è§£è¿‡ä½¿ç”¨åœ¨Activityä¸­ä½¿ç”¨onRetainNonConfigurationInstance()ä¿å­˜ç¼“å­˜æ•°æ®ï¼Œåœ¨onCreate()ä¸­é€šè¿‡getLastNonConfigurationInstance()æ¢å¤ä¹‹å‰çš„æ•°æ®çŠ¶æ€çš„åŒå­¦å¯èƒ½ä¼šå¾ˆç†Ÿæ‚‰è¿™é‡Œçš„å†™æ³•ï¼Œæ˜¯çš„ï¼Œè¿™é‡ŒFragmentActivityå°±æ˜¯ä½¿ç”¨çš„è¿™ç§æ–¹å¼æ¥ä¿å­˜ä¹‹å‰çš„ViewModelStore,çœ‹ä¸‹FragmentActivityçš„onRetainNonConfigurationInstance()æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425/** * Retain all appropriate fragment state. You can NOT * override this yourself! Use &#123;@link #onRetainCustomNonConfigurationInstance()&#125; * if you want to retain your own state. */@Overridepublic final Object onRetainNonConfigurationInstance() &#123; if (mStopped) &#123; doReallyStop(true); &#125; Object custom = onRetainCustomNonConfigurationInstance(); FragmentManagerNonConfig fragments = mFragments.retainNestedNonConfig(); if (fragments == null &amp;&amp; mViewModelStore == null &amp;&amp; custom == null) &#123; return null; &#125; NonConfigurationInstances nci = new NonConfigurationInstances(); nci.custom = custom; nci.viewModelStore = mViewModelStore;//å°±æ˜¯è¿™é‡Œäº†ï¼Œä¼šæŠŠä¹‹å‰çš„VeiwmodelStroeå­˜å‚¨åˆ°NonConfigurationInstancesä¸­ä»¥ä¾›åç»­æ¢å¤ä½¿ç”¨ nci.fragments = fragments; return nci;&#125; è¿™é‡Œå…¶å®å†æ¬¡å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ onRetainNonConfigurationInstance()å’ŒgetLastNonConfigurationInstance()åˆæ˜¯æ€ä¹ˆæ¢å¤æ•°æ®å‘¢?â€¦è¿™ä¸ªå…¶å®å’ŒActivityçš„å¯åŠ¨æµç¨‹ç›¸å…³ï¼Œè¿™é‡Œä¹Ÿä»‹ç»ä¸€ä¸‹å§ï¼Œä¹‹åçš„å†…å®¹å…¶å®æ˜¯Activityçš„å†…å®¹äº†ï¼Œè¶è¿™æ¬¡çœ‹ViwModelä¹Ÿè·Ÿç€çœ‹äº†ä¸€éï¼Œæœ‰äº†è§£è¿‡Activityå¯åŠ¨æµç¨‹çš„åŒå­¦æ›´å®¹æ˜“ç†è§£çš„å¤šï¼Œå¤§å®¶é…Œæƒ…è§‚çœ‹ã€‚ ä¹Ÿä¸èƒ½ä»å¤´å¼€å§‹è¯´èµ·ï¼Œå†ä»å¤´å°±è¦è¶Šæ‰¯è¶Šè¿œäº†ï¼Œå°±ä»ActivityThread.javaä¸­çš„scheduleLaunchActivityå¼€å§‹1234567891011121314151617181920212223242526272829303132333435@Overridepublic final void scheduleLaunchActivity(Intent intent, IBinder token, int ident, ActivityInfo info, Configuration curConfig, Configuration overrideConfig, CompatibilityInfo compatInfo, String referrer, IVoiceInteractor voiceInteractor, int procState, Bundle state, PersistableBundle persistentState, List&lt;ResultInfo&gt; pendingResults, List&lt;ReferrerIntent&gt; pendingNewIntents, boolean notResumed, boolean isForward, ProfilerInfo profilerInfo) &#123; updateProcessState(procState, false); ActivityClientRecord r = new ActivityClientRecord(); r.token = token; r.ident = ident; r.intent = intent; r.referrer = referrer; r.voiceInteractor = voiceInteractor; r.activityInfo = info; r.compatInfo = compatInfo; r.state = state; r.persistentState = persistentState; r.pendingResults = pendingResults; r.pendingIntents = pendingNewIntents; r.startsNotResumed = notResumed; r.isForward = isForward; r.profilerInfo = profilerInfo; r.overrideConfig = overrideConfig; updatePendingConfiguration(curConfig); sendMessage(H.LAUNCH_ACTIVITY, r);&#125; ä»ActivityThread.javaä¸­Hï¼ˆextents Handlerï¼‰æ¥æ”¶åˆ°LAUNCH_ACTIVITYï¼Œå¹¶ä¸”ä¼šæ¥æ”¶ActivityClientRecordï¼Œå…¶ä¸­ä¼šè°ƒç”¨ActivityThreadçš„handleLaunchActivityæ–¹æ³•ï¼š1234567891011121314//ActivityThread.java//æ²¡æœ‰å‰åæ–‡çš„Hä¸­çš„handleMessage~~~ public void handleMessage(Message msg) &#123; if (DEBUG_MESSAGES) Slog.v(TAG, \"&gt;&gt;&gt; handling: \" + codeToString(msg.what)); switch (msg.what) &#123; case LAUNCH_ACTIVITY: &#123; Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, \"activityStart\"); final ActivityClientRecord r = (ActivityClientRecord) msg.obj; //ActivityClientRecord æ˜¯apkè¿›ç¨‹ä¸­ä¸€ä¸ªActivityçš„ä»£è¡¨ï¼Œè¿™ä¸ªå¯¹è±¡çš„activityæˆå‘˜å¼•ç”¨çœŸæ­£çš„Activityç»„ä»¶,åé¢çš„éƒ½å’Œå®ƒæœ‰å…³ç³» r.packageInfo = getPackageInfoNoCheck( r.activityInfo.applicationInfo, r.compatInfo); handleLaunchActivity(r, null, \"LAUNCH_ACTIVITY\");///è¿™é‡Œ~è¿™é‡Œ~ Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER); &#125; break; 1234567891011121314151617181920212223242526272829private void handleLaunchActivity(ActivityClientRecord r, Intent customIntent, String reason) &#123; ... Activity a = performLaunchActivity(r, customIntent); ...&#125;private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;... if (activity != null) &#123; CharSequence title = r.activityInfo.loadLabel(appContext.getPackageManager()); Configuration config = new Configuration(mCompatConfiguration); if (r.overrideConfig != null) &#123; config.updateFrom(r.overrideConfig); &#125; if (DEBUG_CONFIGURATION) Slog.v(TAG, \"Launching activity \" + r.activityInfo.name + \" with config \" + config); Window window = null; if (r.mPendingRemoveWindow != null &amp;&amp; r.mPreserveWindow) &#123; window = r.mPendingRemoveWindow; r.mPendingRemoveWindow = null; r.mPendingRemoveWindowManager = null; &#125; appContext.setOuterContext(activity); activity.attach(appContext, this, getInstrumentation(), r.token, r.ident, app, r.intent, r.activityInfo, title, r.parent, r.embeddedID, r.lastNonConfigurationInstances, config, //çœ‹åˆ°è¿™ä¸ªr.lastNonConfigurationInstances å°±æ˜¯åœ¨Activityæ–¹æ³•ä¸­è°ƒç”¨getLastNonConfigurationInstance()è·å–åˆ°çš„Objectäº†ã€‚ r.referrer, r.voiceInteractor, window, r.configCallback);...&#125; æ³¨é‡Šä¸­çš„åœ°æ–¹å°±æ˜¯lastNonConfigurationInstancesçš„èµ‹å€¼çš„åœ°æ–¹ï¼Œå¯èƒ½ä¼šå‘ç°åœ¨scheduleLaunchActivityå¹¶æ²¡æœ‰å¯¹lastNonConfigurationInstancesèµ‹å€¼ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡å¯åŠ¨Activityæ—¶ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯nullçš„ï¼Œé‚£ä¹ˆèµ‹å€¼çš„åœ°æ–¹åœ¨å“ªé‡Œå‘¢ï¼Œæ—¢ç„¶æ˜¯é”€æ¯åä¼šæ¢å¤æ•°æ®ï¼Œè¿½è¸ªå‘ç°åœ¨performDestroyActivity()ä¹Ÿå°±æ˜¯åœ¨è°ƒç”¨onDestroyç”Ÿå‘½å‘¨æœŸä¹‹å‰æœ‰è¿™æ ·ä¸€æ®µä»£ç 1234567891011121314151617181920212223private ActivityClientRecord performDestroyActivity(IBinder token, boolean finishing, int configChanges, boolean getNonConfigInstance) &#123; ActivityClientRecord r = mActivities.get(token); ...æ— å…³ä»£ç çœç•¥ if (getNonConfigInstance) &#123; try &#123; r.lastNonConfigurationInstances = r.activity.retainNonConfigurationInstances();///å°±æ˜¯è¿™é‡Œå‡ºç°äº†æƒ³è¦æ‰¾çš„NonConfigurationInstances &#125; catch (Exception e) &#123; if (!mInstrumentation.onException(r.activity, e)) &#123; throw new RuntimeException( \"Unable to retain activity \" + r.intent.getComponent().toShortString() + \": \" + e.toString(), e); &#125; &#125; &#125; try &#123; r.activity.mCalled = false; mInstrumentation.callActivityOnDestroy(r.activity); ...æ— å…³ä»£ç çœç•¥ return r; &#125; åœ¨performDestroyActivity()è°ƒç”¨äº†Activity.retainNonConfigurationInstances()æ–¹æ³•äº†ï¼Œæ‰€ä»¥é€»è¾‘åˆ‡æ¢å›Activityä¸­â€¦1234567891011121314151617181920212223242526272829303132333435363738394041 /** * This method is similar to &#123;@link #onRetainNonConfigurationInstance()&#125; except that * it should return either a mapping from child activity id strings to arbitrary objects, * or null. This method is intended to be used by Activity framework subclasses that control a * set of child activities, such as ActivityGroup. The same guarantees and restrictions apply * as for &#123;@link #onRetainNonConfigurationInstance()&#125;. The default implementation returns null. */@NullableHashMap&lt;String,Object&gt; onRetainNonConfigurationChildInstances() &#123; return null;&#125;NonConfigurationInstances retainNonConfigurationInstances() &#123; Object activity = onRetainNonConfigurationInstance();///ç†Ÿæ‚‰çš„ä»£ç ï¼ŒåŸæ¥çš„é…æ–¹ï¼Œå’Œåˆ†æActivityThreadä¹‹å‰è”ç³»èµ·æ¥äº†ï¼Œåœ¨Activityä¸­æ˜¯ç©ºå®ç°ï¼Œè¿™é‡Œå°±æ˜¯è·å–å­ç±»çš„NonConfigurationInstance()ï¼Œä¹‹å‰çš„ä¾‹å­å°±æ˜¯çš„å¾—FragmentActivityä¸­çš„å…·ä½“å®ç°ï¼Œä¸Šæ–‡ä¸­å·²ç»åœ¨åˆ†æActivityThread.javaå·²ç»æŒ‡å‡ºã€‚ HashMap&lt;String, Object&gt; children = onRetainNonConfigurationChildInstances(); FragmentManagerNonConfig fragments = mFragments.retainNestedNonConfig(); // We're already stopped but we've been asked to retain. // Our fragments are taken care of but we need to mark the loaders for retention. // In order to do this correctly we need to restart the loaders first before // handing them off to the next activity. mFragments.doLoaderStart(); mFragments.doLoaderStop(true); ArrayMap&lt;String, LoaderManager&gt; loaders = mFragments.retainLoaderNonConfig(); if (activity == null &amp;&amp; children == null &amp;&amp; fragments == null &amp;&amp; loaders == null &amp;&amp; mVoiceInteractor == null) &#123; return null; &#125; NonConfigurationInstances nci = new NonConfigurationInstances(); nci.activity = activity; nci.children = children; nci.fragments = fragments; nci.loaders = loaders; if (mVoiceInteractor != null) &#123; mVoiceInteractor.retainInstance(); nci.voiceInteractor = mVoiceInteractor; &#125; return nci;//è¿™é‡Œè¿”å›çš„æ˜¯Activityä¸­çš„NonConfigurationInstanceså°±ä¿å­˜åœ¨äº†ActivityClientRecordä¸­äº†&#125; è‡³æ­¤ï¼ŒActivityClientRecordå°±ä¸å†æ·±å…¥äº†ï¼Œå¯ä»¥çœ‹åˆ°åœ¨Activityä¸­æ˜¯ä»¥ä¸€ä¸ªArrayMapæ¥ä¿å­˜Activityçš„è®°å½•ï¼Œè®°å½•çš„å°±æ˜¯Activityçš„çŠ¶æ€ï¼Œæ‰€ä»¥è¿™é‡Œå°±å®ç°äº†å¯¹NonConfigurationInstancesçš„ä¿å­˜ã€‚ ç»“è¯­ï¼šè‡³æ­¤å°±åŸºæœ¬çœ‹å®Œäº†ViewModelåœ¨Activityä¸­çš„ä½¿ç”¨å’ŒåŸç†ï¼Œåœ¨Fragmentä¸­çš„å®ç°ä¸»è¦æ˜¯ä½¿ç”¨setRetainInstance(true)çš„æ–¹å¼å»ä¿å­˜ï¼Œè·Ÿä»Šå¤©çš„åˆ†æä¹Ÿæœ‰å…³è”ï¼Œåˆ†ææºç çš„è¿‡ç¨‹æ€»æ˜¯çœ‹ç€å°±æœ‰æ–°çš„é—®é¢˜ï¼Œå†æ¬¡å¸¦ç€é—®é¢˜å»è§£å†³ä¼šå†æ¬¡æœ‰ä¸åŒçš„æ”¶è·ï¼Œæœ¬æ–‡çš„ç†è§£ä¹Ÿå¯èƒ½æœ‰åå·®ï¼Œå¦‚æœ‰é”™è¯¯å’Œæƒ³è¦äº¤æµçš„ä¹Ÿæ¬¢è¿æŒ‡æ­£æ²Ÿé€šã€‚","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"},{"name":"Jetpack","slug":"Jetpack","permalink":"http://ncmon.com/tags/Jetpack/"}]},{"title":"Ubuntuæ­å»ºNginxå›¾ç‰‡æœåŠ¡å™¨","slug":"build-an-image-server","date":"2018-01-11T12:40:11.000Z","updated":"2018-10-26T14:54:02.067Z","comments":true,"path":"post/build-an-image-server/","link":"http://ncmon.com/post/build-an-image-server/","permalink":"http://ncmon.com/post/build-an-image-server/","excerpt":"ä¹Ÿè®¸ç®—ä½œæ˜¯å»ºç«™ä»¥æ¥çš„ç¬¬ä¸€ç¯‡çœŸæ­£æ„ä¹‰ä¸Šçš„æ€»ç»“åšå®¢ã€‚ é¦–å…ˆæ„Ÿè°¢å¼€æºæœ¬ä¸»é¢˜çš„vioseyåŒå­¦å’Œè¾›è‹¦ç»´æŠ¤æœ¬ä¸»é¢˜çš„neoFelhzåŒå­¦ï¼Œå¯¹æ­¤ä¸»é¢˜æä¸ºå–œæ¬¢ã€‚ æ–°å‘ç°äº†å½“å‰çš„è¿™ä¸ªMeterialä¸»é¢˜åå‘ç°å±…ç„¶æœ‰ä¸€ä¸ªGalleryæ¨¡æ¿å¯ä»¥å±•ç¤ºç…§ç‰‡ï¼Œå¹³æ—¶çš„åšå®¢ä½¿ç”¨å›¾ç‰‡éœ€è¦å­˜æ”¾åœ¨ä¸€ä¸ªä½ç½®ä¸Šï¼Œå¹³æ—¶ä¹Ÿæœ‰ä¸€äº›ä¸šä½™çš„æ‘„å½±çˆ±å¥½éœ€è¦åˆšå¥½å¯ä»¥å­˜æ”¾ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨å¦‚ä¹‹å‰ä½¿ç”¨è¿‡çš„ä¸ƒç‰›äº‘ç­‰äº‘å¯¹è±¡å­˜å‚¨å¹³å°å­˜å‚¨ä½¿ç”¨ï¼Œæˆ‘è¿™é‡Œä¹Ÿæ˜¯åˆšå¥½æœ‰ä¸ªäº‘æœåŠ¡å™¨å¯ä»¥åšå­˜å‚¨å°±æƒ³ç€è‡ªå·±æ­å»ºä¸€ä¸ªå›¾ç‰‡æœåŠ¡å™¨æ–¹ä¾¿ç®¡ç†ï¼Œä¹Ÿåˆšå¥½èƒ½å­¦ä¹ ä¸€ä¸‹æœåŠ¡å™¨æ–¹é¢çš„ä¸€äº›çŸ¥è¯†ï¼Œç»å¤šæ¬¡å°è¯•ï¼Œæ•…æ€»ç»“ä¸€ä¸‹,è¯ä¸å¤šè¯´ï¼Œå¼€å§‹è¡ŒåŠ¨.","text":"ä¹Ÿè®¸ç®—ä½œæ˜¯å»ºç«™ä»¥æ¥çš„ç¬¬ä¸€ç¯‡çœŸæ­£æ„ä¹‰ä¸Šçš„æ€»ç»“åšå®¢ã€‚ é¦–å…ˆæ„Ÿè°¢å¼€æºæœ¬ä¸»é¢˜çš„vioseyåŒå­¦å’Œè¾›è‹¦ç»´æŠ¤æœ¬ä¸»é¢˜çš„neoFelhzåŒå­¦ï¼Œå¯¹æ­¤ä¸»é¢˜æä¸ºå–œæ¬¢ã€‚ æ–°å‘ç°äº†å½“å‰çš„è¿™ä¸ªMeterialä¸»é¢˜åå‘ç°å±…ç„¶æœ‰ä¸€ä¸ªGalleryæ¨¡æ¿å¯ä»¥å±•ç¤ºç…§ç‰‡ï¼Œå¹³æ—¶çš„åšå®¢ä½¿ç”¨å›¾ç‰‡éœ€è¦å­˜æ”¾åœ¨ä¸€ä¸ªä½ç½®ä¸Šï¼Œå¹³æ—¶ä¹Ÿæœ‰ä¸€äº›ä¸šä½™çš„æ‘„å½±çˆ±å¥½éœ€è¦åˆšå¥½å¯ä»¥å­˜æ”¾ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨å¦‚ä¹‹å‰ä½¿ç”¨è¿‡çš„ä¸ƒç‰›äº‘ç­‰äº‘å¯¹è±¡å­˜å‚¨å¹³å°å­˜å‚¨ä½¿ç”¨ï¼Œæˆ‘è¿™é‡Œä¹Ÿæ˜¯åˆšå¥½æœ‰ä¸ªäº‘æœåŠ¡å™¨å¯ä»¥åšå­˜å‚¨å°±æƒ³ç€è‡ªå·±æ­å»ºä¸€ä¸ªå›¾ç‰‡æœåŠ¡å™¨æ–¹ä¾¿ç®¡ç†ï¼Œä¹Ÿåˆšå¥½èƒ½å­¦ä¹ ä¸€ä¸‹æœåŠ¡å™¨æ–¹é¢çš„ä¸€äº›çŸ¥è¯†ï¼Œç»å¤šæ¬¡å°è¯•ï¼Œæ•…æ€»ç»“ä¸€ä¸‹,è¯ä¸å¤šè¯´ï¼Œå¼€å§‹è¡ŒåŠ¨. ç¯å¢ƒå‡†å¤‡Ubuntuç‰ˆæœ¬Ubuntu 16.04.3 å®‰è£…Nginxé¦–å…ˆæ˜¯å‡†å¤‡ç¼–è¯‘Nginxçš„å‰æœŸå‡†å¤‡å·¥ä½œ å…ˆæ›´æ–°ä¸€ä¸‹æº&gt; apt-get update å®‰è£…gcc g++ä¾èµ–åº“&gt; apt-get install build-essential &gt; apt-get install libtool å®‰è£…prceä¾èµ–åº“&gt; apt-get install libpcre3 libpcre3-dev å®‰è£… zlibä¾èµ–åº“&gt; apt-get install zlib1g-dev å®‰è£… sslä¾èµ–åº“&gt; apt-get install openssl ç¼–è¯‘Nginxä¸‹è½½Nginxæœ‰å¯¹åº”çš„ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œä¸‹è½½æ˜¯å½“å‰çš„æœ€æ–°ç‰ˆæœ¬1.13.8 &gt; #è§£å‹ä¸‹è½½ä¸‹æ¥çš„å‹ç¼©åŒ… &gt; tar -zxvf nginx-1.13.8.tar.gz &gt; #è¿›å…¥è§£å‹ç›®å½• &gt; cd nginx-1.13.8 &gt; #é…ç½®å¹¶ç”Ÿæˆmakefile &gt; ./configure --prefix=/usr/local/nginx &gt; #ç¼–è¯‘ &gt; make &gt; #å®‰è£… &gt; make install &gt; #å¯åŠ¨Nginx &gt; /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf æ­¤æ—¶Nginxå°±å®‰è£…å®Œæˆäº†ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„80ç«¯å£å¯åŠ¨ï¼Œå¦‚æœæœ‰å¯åŠ¨apache2æœåŠ¡çš„è¿™é‡Œä¼šç”¨å†²çªï¼Œè¿™é‡Œä¸æ˜¯é‡ç‚¹ï¼Œå¯æŸ¥è¯¢è§£å†³ï¼Œå¯åŠ¨å®Œæˆå¯ç›´æ¥é€šè¿‡æœåŠ¡å™¨ipæˆ–è€…äº‘è§£æçš„åŸŸåæŸ¥çœ‹é»˜è®¤ç½‘é¡µ é»˜è®¤çš„ç½‘é¡µé•¿è¿™ä¸ªæ ·å­ å®‰è£…ä¸é…ç½®vsftpdå®‰è£…vsftpd&gt; apt-get install vsftpd å¯åŠ¨vsftpdæœåŠ¡&gt;service vsftpd start æ–°å»ºftpuserç›®å½•ä½œä¸ºftpä¸»ç›®å½• ï¼ˆftpuserä¸ºç›®å½•åï¼Œéšä¸ªäººå–œå¥½åˆ›å»ºï¼‰&gt;mkdir /home/ftpuser æ–°å»ºftpuserç”¨æˆ·æŒ‡å®šç”¨æˆ·ä¸»ç›®å½•å’Œè®¾ç½®ç”¨æˆ·å¯†ç  ï¼ˆftpuserä¸ºç”¨æˆ·åï¼Œéšä¸ªäººå–œå¥½åˆ›å»ºï¼‰&gt;useradd -d /home/ftpuser -s /bin/bash ftpuser &gt;passwd ftpuser åˆ¶å®šç”¨æˆ·ç»„&gt;chown ftpuser:ftpuser /home/ftpuser æ–°å»ºæ–‡ä»¶/etc/vsftpd.user_listï¼Œç”¨äºå­˜æ”¾å…è®¸è®¿é—®ftpçš„ç”¨æˆ·&gt;vim /etc/vsftpd.user_list ç¼–è¾‘vsftpdé…ç½®æ–‡ä»¶&gt;vim /etc/vsftpd.conf åšå¦‚ä¸‹ä¿®æ”¹ï¼š æ‰“å¼€æ³¨é‡Š write_enable=YES æ·»åŠ ä¿¡æ¯ userlist_file=/etc/vsftpd.user_list æ·»åŠ ä¿¡æ¯ userlist_enable=YES æ·»åŠ ä¿¡æ¯ userlist_deny=NO ä¿®æ”¹å®Œæˆåä¿å­˜é€€å‡ºã€‚ é‡å¯vsftpdæœåŠ¡&gt;service vsftpd restart è¿™æ˜¯å¯ä»¥ä½¿ç”¨filezillaç­‰ftpè½¯ä»¶ä½¿ç”¨åˆšåˆšæ–°å»ºçš„ç”¨æˆ·åå’Œå¯†ç è®¿é—®æµ‹è¯•æ˜¯å¦æˆåŠŸ OKï¼Œå‡†å¤‡å·¥ä½œå®Œæˆå¼€å§‹ä¸Šä¼ å›¾ç‰‡ï¼Œå¼€å§‹æ­£å¼å›¾ç‰‡æœåŠ¡å™¨å·¥ä½œ åˆ›å»ºå­˜å‚¨å›¾ç‰‡çš„æ ¹ç›®å½• ï¼ˆåœ¨ftpuserç›®å½•ä¸‹,æˆ‘è¿™é‡Œä½¿ç”¨www/imagesï¼‰&gt;cd /home/ftpuser &gt;mkdir -p www/images åœ¨nginxç›®å½•ä¸‹åˆ›å»ºimagesç›®å½•&gt;mkdir /usr/local/nginx/html/images ä¿®æ”¹nginx/conf/nginx.confåœ¨é»˜è®¤çš„serveré‡Œå†æ·»åŠ ä¸€ä¸ªlocationå¹¶æŒ‡å®šå®é™…è·¯å¾„:location /images/ { root /home/ftpuser/www/; autoindex on; } ä¿®æ”¹ç”¨æˆ·è®¿é—®æƒé™&gt;chmod 755 /home/ftpuser/www/images ä½¿ç”¨filezilla ç­‰ftpå·¥å…·ä½¿ç”¨ftpuserç”¨æˆ·ç™»å½•å³å¯ä¸Šä¼ å›¾ç‰‡ æµ‹è¯•é€ä¸Šä¸€å¼ æœ€è¿‘çš„é•¿å®‰è¡—æ…¢é—¨æ•ˆæœç…§ç‰‡â˜…,Â°:.â˜†(ï¿£â–½ï¿£)/$:.Â°â˜…ã€‚å¤§åŠŸå‘Šæˆï¼ æ’’èŠ±ï¼","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://ncmon.com/tags/Linux/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"http://ncmon.com/tags/Ubuntu/"},{"name":"FTP","slug":"FTP","permalink":"http://ncmon.com/tags/FTP/"}]},{"title":"Android Studio import project å‡ºç°Erroré”™è¯¯ ç¨‹åºåŒ…org.apache.httpä¸å­˜åœ¨","slug":"Android-Studio-Error-2","date":"2018-01-07T15:01:52.000Z","updated":"2018-11-18T16:09:19.530Z","comments":true,"path":"post/Android-Studio-Error-2/","link":"http://ncmon.com/post/Android-Studio-Error-2/","permalink":"http://ncmon.com/post/Android-Studio-Error-2/","excerpt":"","text":"é—®é¢˜æè¿°é‡åˆ°æ–°çš„äº§å“å½¢æ€ã€æ ·å¼éœ€æ±‚æˆ‘ä»¬ç»å¸¸ä¼šåœ¨Githubæœç´¢å¼€æºé¡¹ç›®ï¼Œæœ‰äº›é¡¹ç›®æ˜¯æ—©æœŸAndroidç‰ˆæœ¬ä¸­å¼€å‘è€Œæˆï¼Œåç»­Googleä¼šæœ‰éƒ¨åˆ†APIåœ¨æ–°ç‰ˆæœ¬ä¸­çš„SDKæ”¾å¼ƒé›†æˆï¼Œè¿™æ¬¡æˆ‘å¯¼å…¥ä¸€ä¸ªé¡¹ç›®æ—¶å°±é‡åˆ°è¿™æ ·ä¸€ä¸ªé”™è¯¯ è§£å†³åŠæ³•å¦‚æœç»å†è¿‡Android 4.4 æ—¶æœŸçš„åŒå­¦åº”è¯¥ä¼šè§‰å¾—org.apache.httpè¿™ä¸ªåŒ…å¾ˆç†Ÿæ‚‰ï¼Œè¿™é‡Œæ˜¾ç¤ºé”™è¯¯æ˜¯å› ä¸ºåœ¨targetsdkï¼š23ä»¥ä¸Šç‰ˆæœ¬SDKä¸­å·²ç»ä¸å†é›†æˆæ­¤åŒ…ï¼Œå¦‚éœ€ä½¿ç”¨å¯æ·»åŠ useLibrary â€œorg.apache.http.legacyâ€ä¾èµ–å³å¯ ã€‚ 1234567apply plugin: 'com.android.application'android &#123; compileSdkVersion 23 buildToolsVersion \"23.0.3\" useLibrary \"org.apache.http.legacy\" ...&#125;","categories":[{"name":"é”™è¯¯å¿—","slug":"é”™è¯¯å¿—","permalink":"http://ncmon.com/categories/é”™è¯¯å¿—/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"},{"name":"IDEError","slug":"IDEError","permalink":"http://ncmon.com/tags/IDEError/"}]},{"title":"RecyclerViewæ’é›·--notifyItemRemovedä¸‹æ ‡ï¼ˆpositionï¼‰ä¸èƒ½æ›´æ–°","slug":"RecyclerView-clear-of-mines-1","date":"2017-10-29T15:48:52.000Z","updated":"2018-11-09T00:43:47.005Z","comments":true,"path":"post/RecyclerView-clear-of-mines-1/","link":"http://ncmon.com/post/RecyclerView-clear-of-mines-1/","permalink":"http://ncmon.com/post/RecyclerView-clear-of-mines-1/","excerpt":"","text":"é—®é¢˜æè¿°ç”¨ä»¥æ˜¾ç¤ºåˆ—è¡¨ç±»å‹çš„UIæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ListViewï¼ŒGridViewï¼ŒGoogleæ¨å‡ºRecyclerViewä¹‹åï¼Œå¤§éƒ¨åˆ†çš„ä½¿ç”¨å‡è½¬æ¢åˆ°äº†RecyclerViewä¸­ï¼Œå¯å®šåˆ¶åŒ–ååˆ†å¼ºï¼Œä½†æ˜¯ä½¿ç”¨è¿‡ç¨‹ä¸­éš¾å…ç¢°åˆ°ä¸€äº›é—®é¢˜ï¼Œä»¥å‰ä½¿ç”¨ListViewå¤šæ˜¯ä½¿ç”¨notifyDataSetChangedï¼ˆï¼‰æ›´æ–°æ•°æ®ï¼Œä½¿ç”¨RecyclerViewåˆ é™¤æ—¶ï¼Œä¸ºäº†ä½¿ç”¨å…¶è‡ªèº«çš„åˆ é™¤è¿‡æ¸¡åŠ¨ç”»ä½¿ç”¨notifyItemRemovedåˆ é™¤ï¼Œé‚£ä¹ˆå°±ç¢°åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå†onBindViewHolderä¸­è®¾ç½®äº†setTagï¼ˆpositionï¼‰123456@Overridepublic void onBindViewHolder(RecyclerView.ViewHolder holder,int position)&#123; ... holder.itemView.setTag(position) ...&#125; ç›´æ¥ä½¿ç”¨notifyItemRemoved(posiaon)åˆ é™¤ä¼šå¯¼è‡´è¯¥ä¸‹æ ‡ä¸èƒ½æ›´æ–°å°±å¯¼è‡´ä¸€ç³»åˆ—çš„Bugï¼ˆ/è¡°ï¼‰ è§£å†³æ–¹æ¡ˆæŸ¥è¯¢åˆ°äº†è§£å†³åŠæ³•ç‰¹æ­¤è®°å½•ä¸€ä¸‹:ä¸ºäº†ä¿®å¤è¯¥é—®é¢˜åˆ é™¤ä¹‹åéœ€è¦è°ƒç”¨notifyItenRangeChangedæ–¹æ³•ï¼Œä½¿ä¸‹é¢çš„itemviewé‡æ–°onBind:1234567public void deleteItem(int position)&#123; mDataList.remove(position); notifyItemRemoved(position); if(position != mDataList.size())&#123; // å¦‚æœç§»é™¤çš„æ˜¯æœ€åä¸€ä¸ªï¼Œå¿½ç•¥ notifyItemRangeChanged(position, mDataList.size() - position); &#125;&#125; å¦‚æœä¸éœ€è¦ä½¿ç”¨åŠ¨ç”»æˆ–æ›´æ”¹è‡ªå®šä¹‰çš„åŠ¨ç”»æ•ˆæœå¯ä»¥æ·»åŠ ä¸€ä¸‹ä»£ç 1mRecyclerView.setItemAnimator(newDefaultItemAnimator());","categories":[{"name":"æŠ€æœ¯æ ˆ","slug":"æŠ€æœ¯æ ˆ","permalink":"http://ncmon.com/categories/æŠ€æœ¯æ ˆ/"}],"tags":[]},{"title":"Android Studio æ›´æ–°åå‡ºç°Error:No service of type Factory  available in ProjectScopeServices.è§£å†³åŠæ³•","slug":"Android-Studio-Error-1","date":"2017-03-15T17:01:52.000Z","updated":"2018-11-18T16:09:20.539Z","comments":true,"path":"post/Android-Studio-Error-1/","link":"http://ncmon.com/post/Android-Studio-Error-1/","permalink":"http://ncmon.com/post/Android-Studio-Error-1/","excerpt":"","text":"é—®é¢˜æè¿°ä»Šå¤©æ›´æ–°Android Studioå ä¹‹å‰èƒ½è¿è¡Œçš„é¡¹ç›®å‡ºç°é”™è¯¯: è§£å†³åŠæ³•æŸ¥æ‰¾åˆ°è§£å†³æ–¹æ¡ˆåœ¨æ­¤è®°å½•ä¸€ä¸‹ï¼šæ˜¯githubçš„ è‡ªåŠ¨åŒ–æ‰“åŒ…æ’ä»¶maven ç‰ˆæœ¬éœ€è¦æ›´æ–°å¯¼è‡´","categories":[{"name":"é”™è¯¯å¿—","slug":"é”™è¯¯å¿—","permalink":"http://ncmon.com/categories/é”™è¯¯å¿—/"}],"tags":[{"name":"Android","slug":"Android","permalink":"http://ncmon.com/tags/Android/"},{"name":"IDEError","slug":"IDEError","permalink":"http://ncmon.com/tags/IDEError/"}]}]}