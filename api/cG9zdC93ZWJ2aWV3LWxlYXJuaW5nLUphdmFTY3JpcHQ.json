{"title":"Android WebView必知必会(4)-Webview下载支持，与JavaScript的交互","date":"2019-03-25T16:06:30.000Z","slug":"webview-learning-JavaScript","comments":true,"tags":["Android","WebView"],"categories":["技术栈"],"updated":"2020-03-22T15:43:47.174Z","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>前面已经介绍了WebSettings,WebViewClient,WebChromeClient</p>\n<p><a href=\"http://ncmon.com/post/webview-learning-WebViewClient\">Android WebView必知必会(1)-WebViewClient</a></p>\n<p><a href=\"http://ncmon.com/post/webview-learning-WebSettings\">Android WebView必知必会(2)-WebSettings</a></p>\n<p><a href=\"http://ncmon.com/post/webview-learning-WebChromeClient\">Android WebView必知必会(3)-WebChromeClient</a></p>\n<p>这一篇就记录一下WebView的其他重要功能</p>\n<h3 id=\"下载支持\"><a href=\"#下载支持\" class=\"headerlink\" title=\"下载支持\"></a>下载支持</h3><p>浏览器中有下载链接的如果不添加支持点击是没有反映的，常见的浏览器都有自己的下载管理功能，我们要实现的话需要怎么做呢，WebView有其对应的设置。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * Registers the interface to be used when content can not be handled by</div><div class=\"line\">     * the rendering engine, and should be downloaded instead. This will replace</div><div class=\"line\">     * the current handler.</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> listener an implementation of DownloadListener</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setDownloadListener</span><span class=\"params\">(DownloadListener listener)</span> </span>&#123;</div><div class=\"line\">        checkThread();</div><div class=\"line\">        mProvider.setDownloadListener(listener);</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>通过设置DownloadListener就能捕获到下载事件，针对下载链接做针对性的处理。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">DownloadListener</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onDownloadStart</span><span class=\"params\">(String url, String userAgent,</span></span></div><div class=\"line\">            String contentDisposition, String mimetype, <span class=\"keyword\">long</span> contentLength);</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>DownloadListener只有一个方法，点击下载链接即出发，通常有以下几种处理方式，大家参考以下吧。</p>\n<h4 id=\"传递给手机浏览器等能处理Url的应用处理\"><a href=\"#传递给手机浏览器等能处理Url的应用处理\" class=\"headerlink\" title=\"传递给手机浏览器等能处理Url的应用处理\"></a>传递给手机浏览器等能处理Url的应用处理</h4><p>这种最简单粗暴，会跳出选择可处理ACTION_VIEW的选择框，选择常规的浏览器都会支持，用户点击浏览器的话就是直接让手机自带浏览器APP处理该下载链接了。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">webView.setDownloadListener((url, userAgent, contentDisposition, mimetype, contentLength) -&gt; &#123;</div><div class=\"line\">    Intent intent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_VIEW);</div><div class=\"line\">    intent.addCategory(Intent.CATEGORY_BROWSABLE);</div><div class=\"line\">    intent.setData(Uri.parse(url));</div><div class=\"line\">    startActivity(intent);</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<h4 id=\"使用DownloadManager处理\"><a href=\"#使用DownloadManager处理\" class=\"headerlink\" title=\"使用DownloadManager处理\"></a>使用DownloadManager处理</h4><p>就是使用系统的DownloadManager去处理下载任务了，这时就用到了其他参数</p>\n<p>@param url 下载链接</p>\n<p>@param contentDisposition 下载任务描述</p>\n<p>@param mimetype 下载文件后缀</p>\n","prev":{"title":"应用弹窗“此应用专为旧版Android打造，因此可能无法正常运行”","slug":"targetsdkversion_error_dialog"},"next":{"title":"Android WebView必知必会(3)-WebChromeClient","slug":"webview-learning-WebChromeClient"},"link":"http://ncmon.com/post/webview-learning-JavaScript/","toc":[{"title":"简介","id":"简介","index":"1","children":[{"title":"下载支持","id":"下载支持","index":"1.1","children":[{"title":"传递给手机浏览器等能处理Url的应用处理","id":"传递给手机浏览器等能处理Url的应用处理","index":"1.1.1"},{"title":"使用DownloadManager处理","id":"使用DownloadManager处理","index":"1.1.2"}]}]}],"copyright":{"author":"ncmon","link":"<a href=\"http://ncmon.com/post/webview-learning-JavaScript/\" title=\"Android WebView必知必会(4)-Webview下载支持，与JavaScript的交互\">http://ncmon.com/post/webview-learning-JavaScript/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"},"reward":true}