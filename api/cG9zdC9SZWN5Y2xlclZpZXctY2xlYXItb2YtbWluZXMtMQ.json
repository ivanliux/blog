{"title":"RecyclerView排雷--notifyItemRemoved下标（position）不能更新","date":"2017-10-29T15:48:52.000Z","slug":"RecyclerView-clear-of-mines-1","comments":true,"categories":["技术栈"],"updated":"2018-11-09T00:41:33.692Z","content":"<h2 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h2><p>用以显示列表类型的UI我们经常使用ListView，GridView，Google推出RecyclerView之后，大部分的使用均转换到了RecyclerView中，可定制化十分强，但是使用过程中难免碰到一些问题，以前使用ListView多是使用notifyDataSetChanged（）更新数据，使用RecyclerView删除时，为了使用其自身的删除过渡动画使用notifyItemRemoved删除，那么就碰到了一个问题，再onBindViewHolder中设置了setTag（position）<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onBindViewHolder</span><span class=\"params\">(RecyclerView.ViewHolder holder,<span class=\"keyword\">int</span> position)</span></span>&#123;</div><div class=\"line\">\t...</div><div class=\"line\">\tholder.itemView.setTag(position)</div><div class=\"line\">\t...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>直接使用notifyItemRemoved(posiaon)删除会导致该下标不能更新就导致一系列的Bug（/衰）</p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><p>查询到了解决办法特此记录一下:为了修复该问题删除之后需要调用notifyItenRangeChanged方法，使下面的itemview重新onBind:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deleteItem</span><span class=\"params\">(<span class=\"keyword\">int</span> position)</span></span>&#123;</div><div class=\"line\">  mDataList.remove(position);</div><div class=\"line\">  notifyItemRemoved(position);</div><div class=\"line\">  <span class=\"keyword\">if</span>(position != mDataList.size())&#123; <span class=\"comment\">// 如果移除的是最后一个，忽略</span></div><div class=\"line\">      notifyItemRangeChanged(position, mDataList.size() - position);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>如果不需要使用动画或更改自定义的动画效果可以添加一下代码<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">mRecyclerView.setItemAnimator(newDefaultItemAnimator());</div></pre></td></tr></table></figure></p>\n","prev":{"title":"Android Studio import project 出现Error错误 程序包org.apache.http不存在","slug":"Android-Studio-Error-2"},"next":{"title":"Android Studio 更新后出现Error:No service of type Factory  available in ProjectScopeServices.解决办法","slug":"Android-Studio-Error-1"},"link":"http://ncmon.com/post/RecyclerView-clear-of-mines-1/","toc":[{"title":"问题描述","id":"问题描述","index":"1"},{"title":"解决方案","id":"解决方案","index":"2"}],"copyright":{"author":"ncmon","link":"<a href=\"http://ncmon.com/post/RecyclerView-clear-of-mines-1/\" title=\"RecyclerView排雷--notifyItemRemoved下标（position）不能更新\">http://ncmon.com/post/RecyclerView-clear-of-mines-1/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"},"reward":true}